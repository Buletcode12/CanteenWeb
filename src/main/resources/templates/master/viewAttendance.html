
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/master}">
<head>
<style>
body {
    background: #fff;
    margin: 0;
    overflow-x: hidden;
}
.modal-content-md {
	padding: 15px 14px;
	position: relative;
	display: -ms-flexbox;
	display: flex;
	-ms-flex-direction: column;
	flex-direction: column;
	background-color: #fff;
	background-clip: padding-box;
	border: 1px solid rgba(0, 0, 0, .2);
	border-radius: .3rem;
	outline: 0;
}

.picker_calendar {
	cursor: pointer;
	position: absolute;
	top: 10px;
	right: 18px;
}

/*Slimselect ends*/
.blueClsWT {
	background: #0076ba !important;
	color: #fff !important;
}

.blueCls {
	background: #0076ba;
	color: #fff;
}

.blueClsWT::before {
	font-size: 8px;
	color: #FFF;
	content: '\e64c';
	font-family: 'themify';
	padding-right: 7px;
}

.tptCls {
	background: transparnt;
}
</style>
<style type="text/css">

.trwidth {
	width: 145px;
}

.total-present {
    font-size: 13px!important;
    text-align: center;
}

.total-leave {
    font-size: 13px!important;
    text-align: center;
}

.total-holiday {
    font-size: 13px!important;
    text-align: center;
}

.total-weekoff {
    font-size: 13px!important;
    text-align: center;
}
.total-empWorkday {
    font-size: 13px!important;
    text-align: center;
}
.total-compWorkday {
    font-size: 13px!important;
    text-align: center;
}
.calendar_box > .form-control[readonly] {
    background-color: #FFF;
    opacity: 1;
    text-align: left!important;
}
.dtxt{
text-align: center!important;
font-size:15px!important;
}

.tbl-scrl .table thead th {
	white-space: nowrap !important;
	position: sticky;
	top: 0px; 
	/* background:#eee; 
	border:1px solid #000;*/
}

.tbl-scrl .table td {
	white-space: nowrap !important;
}	
.tbl-scrl {
    width: 100%;
    height: 350px;
    overflow: scroll;
}

table 
{
    border-collapse: collapse; /* make the table borders collapse to each other */
    width: 100%;
    border:3px solid #333;
  }
  th,
  td {
    padding: 8px 16px;
    border: 1px solid #ccc;
  }
  th {
    background: #eee;
  }
  .table>thead {
	vertical-align: bottom;
	background: #eee;
	position: sticky;
    top: -4px;
}
.edit-input {
	width: 35px;
	text-align: center;
}
.l {
	color: #00ff00;
	width: 35px;
	text-align: center;
}
.p {
	color: blue;
	width: 35px;
	text-align: center;
}
.h {
	color: #17f5f8;
	width: 35px;
	text-align: center;
}

.a {
	color: #f70505;
	width: 35px;
	text-align: center;
}

.wo {
	color: #f8d802;
	width: 35px;
	text-align: center;
}
</style>

<script>
	$(document).ready(function() {

		
	/* 	  $("#quickFilter").on("keyup", function() {
			    var value = $(this).val().toLowerCase();
			    $("#table_atten tr").filter(function() {
			    	$('#theadBody').show(); 
			    	$('#table_atten tbody tr[data-no-results-found]').remove();
			      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
			    });
			    if($('#table_atten tbody tr:visible').length === 0) {
			    	$('#theadBody').show(); 
			        $('#table_atten tbody').append('<tr data-no-results-found><td colspan="50" class="dtxt">NO RESULTS FOUND</td></tr>');
			    }
			  });  */
		  
		
		
		var gridDiv = document.querySelector('#myGrid');
		new agGrid.Grid(gridDiv, gridOptions);
		  
		
		$.ajax({
			type : "GET",
			url : "view-goal-attendance-type",
			success : function(response) {
				if (response.message == "Success") {
				
					if (response.body.length > 0) {
						$(".slidearrow").show();
					} else {
						$(".slidearrow").hide();
					}

					$(".roomListDiv").empty();
					var act_cls = 0;
					$(".roombtn").removeClass(
							"topbtnactive");

					var Count = 0;
					shiftid = $("shiftid").val();
					for (var i = 0; i < response.body.length; i++) {

						Count = Count+response.body[i].key;
						var Count1 = 0;

						if (response.body[i].Count1 != null) {
							Count1 = response.body[i].key;
						}
						var div = "";
						div = div + '<div id="'+response.body[i].key+'" class="roombtn topbtnactive  cp " ><span>'+response.body[i].name+'</span>  <br> '+response.body[i].code+' </div>';
	 
						var tbl = div;
						$(".roomListDiv").append(tbl);
					}

					$('.loader').hide();
					$("body").removeClass("overlay");

				}
			},
			error : function(data) {
				
				$(".roomListDiv").empty();
				//$("#locCount").text(' (0)');
				$(".section_counter").text(' (0)');

				$('.loader').hide();
				$("body").removeClass("overlay");
			}
		});


	})

	var gridOptions = {
		//columnDefs : columnDefs,
		//rowData: rowData,
		defaultColDef : {
			sortable : true,
			filter : true,
			resizable : true,
			width : 410,
			height : 20
		},
		onCellValueChanged : function(param) {
			

			if (param.data.id21 == 'P') {
				var totPresent = parseInt(param.data.totalPresent) + 1;
				param.data.totalPresent = totPresent;
				param.data.workday = parseInt(param.data.totalPresent)
						+ parseInt(param.data.leave);
			}

			param.api.refreshCells({
				columns : [ "totalPresent", "workday" ]
			});
		},
		rowSelection : 'multiple',
		suppressRowClickSelection : true,

	};

	function openNav() {

		$("#myModalEducation").modal('show');

	}

	function closeNav() {
		$("#myModalEducation").modal('hide');

	}

	$(document)
			.ready(
					function() {
						var curdate = new Date();
						var date = curdate.getDate();
						var mnth = curdate.getMonth();
						$("#attndyear").val(curdate.getFullYear())
						var sday = $("#startDayForAtten").val();
						if (parseInt(sday) > 1) {
							if (parseInt(date) > parseInt(sday)) {
								var month = (curdate.getMonth() + 1);
								var year = curdate.getFullYear();
							} else {
								var month = curdate.getMonth();
								if (month == 0) {
									var year = curdate.getFullYear() - 1;
									month = 12;
								} else {
									var month = curdate.getMonth();
									var year = curdate.getFullYear();
								}
							}
						} else {
							var month = (curdate.getMonth() + 1);
							var year = curdate.getFullYear();
						}

						var nextmonth = month + 1;
						if (parseInt(sday) > 1) {
							$("#attndmonth").val(month + 1);
						} else {
							$("#attndmonth").val(month);
						}

						var fromdate = sday + "-"
								+ String(month).padStart(2, '0') + "-" + year;
						const lastDayOfMonth = new Date(year, month, 0)
								.getDate();
						if (sday > 1) {
							if (month == "12") {
								var todate = (parseInt(sday) - 1) + "-"
										+ String(1).padStart(2, '0') + "-"
										+ (year + 1);
							} else {
								var todate = (parseInt(sday) - 1) + "-"
										+ String(nextmonth).padStart(2, '0')
										+ "-" + year;
							}
						} else { 
							var todate = lastDayOfMonth + "-"
									+ String(month).padStart(2, '0') + "-"
									+ year;
						}

						$("#fromDate").val(fromdate);
						$("#fromDateCalendar").val(fromdate);
						$("#endDate").val(todate);
						$("#endDateCalendar").val(todate);

						getApproverStatus();
						
						

						var band = $("#attndband").val();
						month = $("#attndmonth").val();
						var fromDate = $("#fromDate").val();
						var toDate = $("#endDate").val();
						var userId = $("#sessionId").val();
						var userrole = $("#sessionRole").val();
						
						
						
						var obj = {};
						obj.key = month;
						obj.name = year;
					
						//console.log("obj====" + JSON.stringify(obj))
						$('.loader').show();
						$.ajax({
									type : "POST",
									url : "view-goal-attendance-get-attnd-date",
									dataType : "json",
									contentType : "application/json",
									data : JSON.stringify(obj),
									success : function(response) {
										if (response.message == "success") {
											$('.loader').show();
											$("#theadBody").empty();
											var div2 = "";
											var div3 = "";
											var div4 = "";
											var data='<tr id="theadBody">'
												 	  +'<th id="eid" width="200">Employee Id</th>'
												  	  +'<th id="ename" width="200">Name</th>'
												  	  +'<th id="edept" width="200">Department</th>'
												  	  +'<th id="esub" width="200">Sub Department</th>'
												  	  +'<th id="edeptid" width="200" style = "display:none">Department Id</th>'
												  	  +'<th id="esubid" width="200" style = "display:none">Sub Department Id</th>'
												  	  +'<th id="eband" width="200" style = "display:none">Band</th>'
												  	  +'<th id="attendType" width="200" style = "display:none">AttendType</th>'
											for (var i = 0; i < response.body.length; i++) {
												div3=div3+'<th>'
												+ response.body[i].name
												+'</th>';
											} 
												      var data13=div3+'<th id="totalpresent" width="200">Present</th>'
												          +'<th id="totalleave" width="200">Leave</th>'
												          +'<th id="totalweekoff" width="200">WeekOff</th>'
												          +'<th id="holiday" width="200">Holiday</th>'
												          +'<th id="compworkday" width="200">Company WorkDay</th>'
												          +'<th id="eworkingday" width="200">Employee WorkDay</th>'
												          +'<th id="approvalsts" width="200">Approval Status</th>'
														  +'</tr>';
														  var data15=data+data13;
													  $("#thids").append(data15)  
											
													  var monthlen=response.body.length;
														
														$.ajax({
															type : "GET",
															url : 'view-goal-attendance-get-listing-data?fromDate='
																+ fromDate
																+ '&toDate='
																+ toDate
																+ "&band=" + band,
																success : function(response) {
																if (response.message == "Success") 
																{
																	console.log(response.body)
																	   var len = response.body.length;
																		$('#totalEmp').find('span').html(len);
																	for (var i = 0; i < response.body.length; i++) {
																		var div5 =
																			'<tr class="statuscheck_'+i+'"><td id="empId_'+i+'" value="'+response.body[i].empId+'">'
																				+ response.body[i].empId
																				+ '</td>'
																				+ '<td>'
																				+ response.body[i].name
																				+ '</td>'
																				+ '<td>'
																				+ response.body[i].dept
																				+ '</td>'
																				+ '<td>'
																				+ response.body[i].subDept
																				+ '</td>'
																				+ '<td id="deptId_'+i+'" value="'+response.body[i].deptId+'" style = "display:none">'
																				+ response.body[i].deptId
																				+ '</td>'
																				+ '<td id="subDeptId_'+i+'" value="'+response.body[i].subDeptId+'" style = "display:none">'
																				+ response.body[i].subDeptId
																				+ '</td>'
																				+ '<td id="bandid_'+i+'" value="'+response.body[i].bandid+'" style = "display:none">'
																				+ response.body[i].bandid
																				+ '</td>'
																				+ '</td>'
																				+ '<td id="attendType_'+i+'" value="'+response.body[i].attendType+'" style = "display:none">'
																				+ response.body[i].attendType
																				+ '</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+'<input type="text" id="id1_'+i+'" value="'+response.body[i].id1+'"  onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box1_'+i+'" class="sugg-cls"></div>'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id2_'+i+'" value='+response.body[i].id2+'  onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly readonly><div id="suggesstion-box2_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id3_'+i+'" value='+response.body[i].id3+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box3_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id4_'+i+'" value='+response.body[i].id4+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box4_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id5_'+i+'" value='+response.body[i].id5+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box5_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id6_'+i+'" value='+response.body[i].id6+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box6_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id7_'+i+'" value='+response.body[i].id7+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box7_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id8_'+i+'" value='+response.body[i].id8+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box8_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id9_'+i+'" value='+response.body[i].id9+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box9_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id10_'+i+'" value='+response.body[i].id10+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box10_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id11_'+i+'" value='+response.body[i].id11+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box11_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id12_'+i+'" value='+response.body[i].id12+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box12_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id13_'+i+'" value='+response.body[i].id13+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box13_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id14_'+i+'" value='+response.body[i].id14+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box14_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id15_'+i+'" value='+response.body[i].id15+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box15_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id16_'+i+'" value='+response.body[i].id16+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box16_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id17_'+i+'" value='+response.body[i].id17+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box17_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id18_'+i+'" value='+response.body[i].id18+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box18_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id19_'+i+'" value='+response.body[i].id19+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box19_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id20_'+i+'" value='+response.body[i].id20+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box20_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id21_'+i+'" value='+response.body[i].id21+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box21_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id22_'+i+'" value='+response.body[i].id22+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box22_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id23_'+i+'" value='+response.body[i].id23+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box23_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id24_'+i+'" value='+response.body[i].id24+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box24_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id25_'+i+'" value='+response.body[i].id25+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box25_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id26_'+i+'" value='+response.body[i].id26+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box26_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id27_'+i+'" value='+response.body[i].id27+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box27_'+i+'" class="sugg-cls">'
																				+'</td>'
																				+'<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id28_'+i+'" value='+response.body[i].id28+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box28_'+i+'" class="sugg-cls">'
																				+'</td>';
																				 div6='<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id29_'+i+'" value='+response.body[i].id29+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box29_'+i+'" class="sugg-cls">'
																				+'</td>';
																				 div7='<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id30_'+i+'" value='+response.body[i].id30+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box30_'+i+'" class="sugg-cls">'
																				+'</td>';
																				 div8='<td onmouseleave="onmouseoutList();">'
																				+ '<input type="text" id="id31_'+i+'" value='+response.body[i].id31+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box31_'+i+'" class="sugg-cls">'
																				+'</td>';
																					var div51 =	'<td id="totalPresent_'+i+'" class="total-present" value="'+response.body[i].totalPresent+'">'
																					+ response.body[i].totalPresent
																					+ '</td>'
																					+'<td id="leave_'+i+'" class="total-leave" value="'+response.body[i].leave+'">'
																					+response.body[i].leave
																					+ '</td>'
																					+'<td id="weekoff_'+i+'" class="total-weekoff" value="'+response.body[i].weekoff+'">'
																					+response.body[i].weekoff
																					+ '</td>'
																					+'<td id="holiday_'+i+'" class="total-holiday" value="'+response.body[i].holiday+'">'
																					+ response.body[i].holiday
																					+ '</td>'
																					+'<td id="workday_'+i+'" class="total-compWorkday" value="'+response.body[i].workday+'">'
																					+response.body[i].workday
																					+ '</td>'
																					+'<td id="workingday_'+i+'" class="total-empWorkday" value="'+response.body[i].workingday+'">'
																					+response.body[i].workingday
																					+ '</td>' 
																					+'<td id="approveStatus_'+i+'" value="'+response.body[i].approveStatus+'">'
																					+ response.body[i].approveStatus
																					+'</td></tr>';
																					
																					var div33=div5+div51;
																					var div9=div5+div6+div51;
																					var div10=div5+div6+div7+div51;	
																					var div11=div5+div6+div7+div8+div51;
																					if(monthlen==29){
																						$("#tbodyId").append(div9);	
																					}else if(monthlen==30){
																						$("#tbodyId").append(div10);	
																					}else if(monthlen==31){
																						$("#tbodyId").append(div11);	
																					}else{
																						$("#tbodyId").append(div33);
																					}
																					if(response.body[i].approveStatus=="Approved"){
																						 $("tr.statuscheck_"+i+" input").prop('disabled', true);
																					}else{
																						$("tr.statuscheck_"+i+" input").prop('disabled', false);
																					}
																					$("[class=edit-input]").filter("[value='P']").prop("class",'p');
																					$("[class=edit-input]").filter("[value='L']").prop("class",'l');
																					$("[class=edit-input]").filter("[value='H']").prop("class",'h');
																					$("[class=edit-input]").filter("[value='WO']").prop("class",'wo');
																					$("[class=edit-input]").filter("[value='A']").prop("class",'a');
																		}
																						
																	
																}
																$('.loader').hide();
																
															     var len = response.body.length;
												                	  if(len > 0) {
												                		  $("#assignBtn").append('<button class="approve-btn" id="save" onclick="approve('+len+');" style="display:block">Approve</button>');
												                		  $("#saveBtn").append('<button class="save-btn" id="save" onclick="saveAsDraft('+len+');" style="display:block">Save As Draft</button>');
												  		              }else{
												  		    			var divND ='<tr><td colspan="40" class="dtxt">No Data Found!</td></tr>';
												  		    			 $("#tbodyId").append(divND);
													  		            	 $("#assignBtn").empty();
																			 $("#saveBtn").empty();
												                	  }
															},
														});
										}
										
									},
									error : function(response) {
										//console.log(response);
									}
								});

	$("#attndmonth,#attndband,#attndyear").change(function(){
		$("#quickFilter").val("");
		filterData();
				var curdate = new Date();
				var attnyear = $("#attndyear").val();
			 
				if(attnyear>curdate.getFullYear()){
					//$("#table_atten").show();
					$("#messageParagraph").text("Please Choose Current Year Or Previous Year!");
					$("#msgOkModal").removeClass("btn3");
					$("#msgOkModal").addClass("btn1");
					$("#msgModal").modal('show');
					$("#attndyear").val(curdate.getFullYear())
					var curdate = new Date();
					var date = curdate.getDate();
					var mnth = curdate.getMonth();
					var sday = $("#startDayForAtten").val();
					if (parseInt(sday) > 1) {
						if (parseInt(date) > parseInt(sday)) {
							var month = (curdate.getMonth() + 1);
							var year = curdate.getFullYear();
						} else {
							var month = curdate.getMonth();
							if (month == 0) {
								var year = curdate.getFullYear() - 1;
								month = 12;
							} else {
								var month = curdate.getMonth();
								var year = curdate.getFullYear();
							}
						}
					} else {
						var month = (curdate.getMonth() + 1);
						var year = curdate.getFullYear();
					}

					var nextmonth = month + 1;
					if (parseInt(sday) > 1) {
						$("#attndmonth").val(month + 1);
					} else {
						$("#attndmonth").val(month);
					}

					var fromdate = sday + "-"
							+ String(month).padStart(2, '0') + "-" + year;
					const lastDayOfMonth = new Date(year, month, 0)
							.getDate();
					if (sday > 1) {
						if (month == "12") {
							var todate = (parseInt(sday) - 1) + "-"
									+ String(1).padStart(2, '0') + "-"
									+ (year + 1);
						} else {
							var todate = (parseInt(sday) - 1) + "-"
									+ String(nextmonth).padStart(2, '0')
									+ "-" + year;
						}
					} else { 
						var todate = lastDayOfMonth + "-"
								+ String(month).padStart(2, '0') + "-"
								+ year;
					}

					$("#fromDate").val(fromdate);
					$("#fromDateCalendar").val(fromdate);
					$("#endDate").val(todate);
					$("#endDateCalendar").val(todate);
					allAttendanceData();
				}else{
					//allAttendanceData();
					
				var month = $("#attndmonth").val();
				var mt=month-1;
				if(attnyear==curdate.getFullYear()){
					if(mt>curdate.getMonth()){
						$("#messageParagraph").text("Please Choose Current month Or Previous month!");
						$("#msgOkModal").removeClass("btn3");
						$("#msgOkModal").addClass("btn1");
						$("#msgModal").modal('show');
						
						var curdate = new Date();
						var date = curdate.getDate();
						var mnth = curdate.getMonth();
						var sday = $("#startDayForAtten").val();
						if (parseInt(sday) > 1) {
							if (parseInt(date) > parseInt(sday)) {
								var month = (curdate.getMonth() + 1);
								var year = attnyear;
							} else {
								var month = curdate.getMonth();
								if (month == 0) {
									var year = attnyear - 1;
									month = 12;
								} else {
									var month = curdate.getMonth();
									var year = attnyear;
								}
							}
						} else {
							var month = (curdate.getMonth() + 1);
							var year = attnyear;
						}

						var nextmonth = month + 1;
						if (parseInt(sday) > 1) {
							$("#attndmonth").val(month + 1);
						} else {
							$("#attndmonth").val(month);
						}

						var fromdate = sday + "-"
								+ String(month).padStart(2, '0') + "-" + year;
						const lastDayOfMonth = new Date(year, month, 0)
								.getDate();
						if (sday > 1) {
							if (month == "12") {
								var todate = (parseInt(sday) - 1) + "-"
										+ String(1).padStart(2, '0') + "-"
										+ (year + 1);
							} else {
								var todate = (parseInt(sday) - 1) + "-"
										+ String(nextmonth).padStart(2, '0')
										+ "-" + year;
							}
						} else { 
							var todate = lastDayOfMonth + "-"
									+ String(month).padStart(2, '0') + "-"
									+ year;
						}

						$("#fromDate").val(fromdate);
						$("#fromDateCalendar").val(fromdate);
						$("#endDate").val(todate);
						$("#endDateCalendar").val(todate);
					}else{
						getAttendanceYrMtData()
					}
				}else{
					getAttendanceYrMtData()
				}

			  }
			})

		})
function getAttendanceYrMtData(){
		var sday = $("#startDayForAtten").val();
		var month = $("#attndmonth").val();
		var attnyear = $("#attndyear").val();
		if (parseInt(sday) > 1) {
			if (month == 1) {
				var year = attnyear - 1;
				month = 12;
			} else {
				var year = attnyear;
				month = month - 1;
			}
		} else {
			var year = attnyear;
		}

		var nextmonth = parseInt(month) + 1;

		var fromdate = sday
				+ "-"
				+ String(month).padStart(2,
						'0') + "-" + year;
		const lastDayOfMonth = new Date(year, month, 0).getDate();
		if (sday > 1) {
			if (month == "12") {
				var todate = (parseInt(sday) - 1)
						+ "-"
						+ String(1).padStart(2,'0')
						+ "-" + (year + 1);
			} else {
				var todate = (parseInt(sday) - 1)
						+ "-"
						+ String(nextmonth).padStart(2,'0')
						+ "-" + year;
			}
		} else {
			var todate = lastDayOfMonth
					+ "-"
					+ String(month).padStart(2,'0')
					+ "-" + year;
		}

		$("#fromDate").val(fromdate);
		$("#fromDateCalendar").val(fromdate);
		$("#endDate").val(todate);
		$("#endDateCalendar").val(todate);
		allAttendanceData();
	}

function allAttendanceData(){
		getApproverStatus();
		var month = $("#attndmonth").val();
		var year = $("#attndyear").val();
		var fromDate = $("#fromDate").val();
		var toDate = $("#endDate").val();
		var band = $("#attndband").val();
		
		var obj = {};
		obj.key = month;
		obj.name = year;
		$('.loader').show();
		$.ajax({
			type : "POST",
			url : "view-goal-attendance-get-attnd-date",
			dataType : "json",
			contentType : "application/json",
			data : JSON.stringify(obj),
			success : function(response) {
				if (response.message == "success") {
					
					$("#eid").empty();
					  $("#ename").empty();
					  $("#totalpresent").empty();
					  $("#totalleave").empty();
					  $("#holiday").empty();
					  $("#compworkday").empty();
					  $("#eworkingday").empty();
					  $("#approvalsts").empty();
					  $("#remark").empty();
					  $("#thids").empty();
					  $("#tbodyId").empty();
					  $("#assignBtn").empty();
					  $("#saveBtn").empty();
					  $("#theadBody").empty();
					var div2 = "";
					var div3 = "";
					var div4 = "";
					var data='<tr id="theadBody">'
					 	  +'<th id="eid" width="200">Employee Id</th>'
					  	  +'<th id="ename" width="200">Name</th>'
					  	  +'<th id="edept" width="200">Department</th>'
					  	  +'<th id="esub" width="200">Sub Department</th>'
					  	  +'<th id="edeptid" width="200" style = "display:none">Department Id</th>'
					  	  +'<th id="esubid" width="200" style = "display:none">Sub Department Id</th>'
					  	  +'<th id="eband" width="200" style = "display:none">Band</th>'
					  	  +'<th id="attendType" width="200" style = "display:none">Attendance Type</th>'
				     
				for (var i = 0; i < response.body.length; i++) {
					div3=div3+'<th>'
					+ response.body[i].name
					+'</th>';
				} 
					      var data13=div3+'<th id="totalpresent" width="200">Present</th>'
					          +'<th id="totalleave" width="200">Leave</th>'
					          +'<th id="totalweekoff" width="200">WeekOff</th>'
					          +'<th id="holiday" width="200">Holiday</th>'
					          +'<th id="compworkday" width="200">Company WorkDay</th>'
					          +'<th id="eworkingday" width="200">Employee WorkDay</th>'
					          +'<th id="approvalsts" width="200">Approval Status</th>'
							  +'</tr>';
								  var data15=data+data13;
							  $("#thids").append(data15)  
							  var monthlen=response.body.length;
					
					$.ajax({
						type : "GET",
						url : 'view-goal-attendance-get-listing-data?fromDate='
							+ fromDate
							+ '&toDate='
							+ toDate
							+ "&band=" + band,
							success : function(response) {
							if (response.message == "Success") {
								console.log("RESPNSE_DATA"+response.body)
							var len = response.body.length;
								
							$('#totalEmp').find('span').html(len);								
								for (var i = 0; i < response.body.length; i++) {
									var div5 =
										'<tr class="statuscheck_'+i+'" ><td id="empId_'+i+'" value="'+response.body[i].empId+'">'
											+ response.body[i].empId
											+ '</td>'
											+ '<td>'
											+ response.body[i].name
											+ '</td>'
											+ '<td>'
											+ response.body[i].dept
											+ '</td>'
											+ '<td>'
											+ response.body[i].subDept
											+ '</td>'
											+ '<td id="deptId_'+i+'" value="'+response.body[i].deptId+'" style = "display:none">'
											+ response.body[i].deptId
											+ '</td>'
											+ '<td id="subDeptId_'+i+'" value="'+response.body[i].subDeptId+'" style = "display:none">'
											+ response.body[i].subDeptId
											+ '</td>'
											+ '<td id="bandid_'+i+'" value="'+response.body[i].bandid+'" style = "display:none">'
											+ response.body[i].bandid
											+ '</td>'
											+ '<td id="attendType_'+i+'" value="'+response.body[i].attendType+'" style = "display:none">'
											+ response.body[i].attendType
											+ '</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+'<input type="text" id="id1_'+i+'" value="'+response.body[i].id1+'"  onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box1_'+i+'" class="sugg-cls"></div>'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id2_'+i+'" value='+response.body[i].id2+'  onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box2_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id3_'+i+'" value='+response.body[i].id3+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box3_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id4_'+i+'" value='+response.body[i].id4+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box4_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id5_'+i+'" value='+response.body[i].id5+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box5_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id6_'+i+'" value='+response.body[i].id6+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box6_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id7_'+i+'" value='+response.body[i].id7+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box7_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id8_'+i+'" value='+response.body[i].id8+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box8_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id9_'+i+'" value='+response.body[i].id9+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box9_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id10_'+i+'" value='+response.body[i].id10+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box10_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id11_'+i+'" value='+response.body[i].id11+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box11_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id12_'+i+'" value='+response.body[i].id12+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box12_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id13_'+i+'" value='+response.body[i].id13+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box13_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id14_'+i+'" value='+response.body[i].id14+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box14_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id15_'+i+'" value='+response.body[i].id15+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box15_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id16_'+i+'" value='+response.body[i].id16+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box16_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id17_'+i+'" value='+response.body[i].id17+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box17_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id18_'+i+'" value='+response.body[i].id18+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box18_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id19_'+i+'" value='+response.body[i].id19+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box19_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id20_'+i+'" value='+response.body[i].id20+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box20_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id21_'+i+'" value='+response.body[i].id21+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box21_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id22_'+i+'" value='+response.body[i].id22+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box22_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id23_'+i+'" value='+response.body[i].id23+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box23_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id24_'+i+'" value='+response.body[i].id24+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box24_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id25_'+i+'" value='+response.body[i].id25+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box25_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id26_'+i+'" value='+response.body[i].id26+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box26_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id27_'+i+'" value='+response.body[i].id27+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box27_'+i+'" class="sugg-cls">'
											+'</td>'
											+'<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id28_'+i+'" value='+response.body[i].id28+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box28_'+i+'" class="sugg-cls">'
											+'</td>';
											 div6='<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id29_'+i+'" value='+response.body[i].id29+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box29_'+i+'" class="sugg-cls">'
											+'</td>';
											 div7='<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id30_'+i+'" value='+response.body[i].id30+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box30_'+i+'" class="sugg-cls">'
											+'</td>';
											 div8='<td onmouseleave="onmouseoutList();">'
											+ '<input type="text" id="id31_'+i+'" value='+response.body[i].id31+' onmouseover="getAttendanceTypeList(value,id)" class="edit-input" readonly><div id="suggesstion-box31_'+i+'" class="sugg-cls">'
											+'</td>';
												var div51 =	'<td id="totalPresent_'+i+'" class="total-present" value="'+response.body[i].totalPresent+'">'
												+ response.body[i].totalPresent
												+ '</td>'
												+'<td id="leave_'+i+'" class="total-leave" value="'+response.body[i].leave+'">'
												+response.body[i].leave
												+ '</td>'
												+'<td id="weekoff_'+i+'" class="total-weekoff" value="'+response.body[i].weekoff+'">'
												+response.body[i].weekoff
												+ '</td>'
												+'<td id="holiday_'+i+'" class="total-holiday" value="'+response.body[i].holiday+'">'
												+ response.body[i].holiday
												+ '</td>'
												+'<td id="workday_'+i+'" class="total-compWorkday" value="'+response.body[i].workday+'">'
												+response.body[i].workday
												+ '</td>'
												+'<td id="workingday_'+i+'" class="total-empWorkday" value="'+response.body[i].workingday+'">'
												+response.body[i].workingday
												+ '</td>' 
												+'<td id="approveStatus_'+i+'" value="'+response.body[i].approveStatus+'">'
												+ response.body[i].approveStatus
												+'</td></tr>';
												
												var div33=div5+div51;
												var div9=div5+div6+div51;
												var div10=div5+div6+div7+div51;	
												var div11=div5+div6+div7+div8+div51;
												if(monthlen==29){
													$("#tbodyId").append(div9);	
												}else if(monthlen==30){
													$("#tbodyId").append(div10);	
												}else if(monthlen==31){
													$("#tbodyId").append(div11);	
												}else{
													$("#tbodyId").append(div33);
												}
												if(response.body[i].approveStatus=="Approved"){
													 $("tr.statuscheck_"+i+" input").prop('disabled', true);
												}else{
													$("tr.statuscheck_"+i+" input").prop('disabled', false);
												}
												$("[class=edit-input]").filter("[value='P']").prop("class",'p');
												$("[class=edit-input]").filter("[value='L']").prop("class",'l');
												$("[class=edit-input]").filter("[value='H']").prop("class",'h');
												$("[class=edit-input]").filter("[value='WO']").prop("class",'wo');
												$("[class=edit-input]").filter("[value='A']").prop("class",'a');
									}
							}
							
							$('.loader').hide();
						     var len = response.body.length;
			                	  if(len > 0) {
			                		  $("#assignBtn").append('<button class="approve-btn" id="approve" onclick="approve('+len+');" style="display:block">Approve</button>');
			          				var isApprove = $("#isApprove").val();
			    					if (isApprove == "" || isApprove==null) {
				                		  $("#saveBtn").append('<button class="save-btn" id="save" onclick="saveAsDraft('+len+');" style="display:block">Save As Draft</button>');
			    					}
			  		              }else{
				  		    			var divND ='<tr><td colspan="40" class="dtxt">No Data Found!</td></tr>';
				  		    			 $("#tbodyId").append(divND);
				  		            	 $("#assignBtn").empty();
										 $("#saveBtn").empty();
					  					
			                	  }
			                	  
						},
					});
				
				}
				
				
			},
			error : function(response) {
				//console.log(response);
			}
		});
	}
</script>
<script>
function totalUserCSV() {
	var band = $("#attndband").val();
	var fromDate = $("#fromDate").val();
	var toDate = $("#endDate").val();
	var y=toDate.split("-");
	var m = $("#attndmonth").val();
	const monthnamelist = ["January","February","March","April","May","June","July","August","September","October","November","December"];
	let monthname = monthnamelist[m-1];
 	var monthYear=monthname+" "+y[2];
 	
	var fromdate1 = fromDate.split("-").reverse().join("-");
	var todate1 = toDate.split("-").reverse().join("-");
	var date1 = new Date(fromdate1);
	var date2 = new Date(todate1);
	var diffDays = ((date2.getTime() - date1.getTime()) / (1000 * 60 * 60 * 24))+1;
    window.open("/master/view-goal-attendance-download-excel-employee-attendance?fromDate="+ btoa(fromDate)+ "&toDate="+ btoa(toDate) + "&band=" + band+"&monthYear="+monthYear+"&days="+parseInt(diffDays));
	}
	 

	function getApproverStatus() {
	var fromDate = $("#fromDate").val();
	var userId = $("#sessionId").val();
	if (fromDate) {
		$.ajax({
			type : 'GET',
			url : 'view-goal-attendance-getApproverStatus?fromDate='
					+ fromDate + "&userId=" + userId,
			contentType : false,
			success : function(response) {
				console.log(response)
				if (response.message == "success") {
					$("#isApprove").val(response.body.key);
				}
			},
			error : function(e) {

			}
		});
	}
	}
	function onmouseoutList(){
		$(".sugg-cls").hide();
	}
	/* Function autosearch for getShiftList1 */
	function getAttendanceTypeList(id1,id2){
		var arr = id2.split("d");
		var xsid=arr[1];
		var sid="suggesstion-box"+xsid;
		var search =id1;
		if(search == ""){
			$("#"+sid).hide();
		}
		if (search) {
		$.ajax({
					type : "POST",
					url : "view-goal-attendance-autosearch-attenType",
					dataType : 'json',
					contentType : 'application/json',
					data : search,
					success : function(response) {
						if (response.message == "success") {
							console.log(response.body)
							if (response.body.length != 0) {
								$("#search").css("background", "#FFF");
								var content = '<ul id="autocomplete-list1" style="margin-left:-30px; font-weight:100; font-size:14px; color:#ccc;">';
								for (var x = 0; x < response.body.length; x++) {
									content += '<li class="autocompletedata cp" onClick="selectAutocompleteValue1(\''
										
											+ response.body[x].name
											+ '\',\''
											+ xsid
											+ '\',\''
											+ response.body[x].key
											+ '\')">'
											+ response.body[x].name
											+ '</li>';
								}
								content += '</ul>';
								$("#"+sid).show();
								$("#"+sid).html(content);

							} else {
								$("#search").css("background", "#FFF");
								var content = '<div id="autocomplete-list1">';
								content += '<div onClick="selectAutocompleteValue()">'
										+ "No Data Found" + '</div>';
								content += '</div>';
								$("#"+sid).show();
								$("#"+sid).html(content);
							}
						}
					},
					error : function(data) {
						console.log(data);
					}
				})
		}

	}
	function selectAutocompleteValue1(atndname,xsid) {
		var sid="suggesstion-box"+xsid;
				if (atndname) {
					$("#id"+xsid).val(atndname);
					$("#search").val(atndname);
					$("#search").attr('data-procat', atndname);
					$("#"+sid).hide();
					if (atndname == 'P') {
						$("#id" + xsid).removeClass('h');
						$("#id" + xsid).removeClass('wo');
						$("#id" + xsid).removeClass('a');
						$("#id" + xsid).removeClass('l');
						$("#id" + xsid).addClass('p');
					} else if (atndname == 'L') {
						$("#id" + xsid).removeClass('p');
						$("#id" + xsid).removeClass('h');
						$("#id" + xsid).removeClass('wo');
						$("#id" + xsid).removeClass('a');
						$("#id" + xsid).addClass('l');
					} else if (atndname == 'H') {
						$("#id" + xsid).removeClass('p');
						$("#id" + xsid).removeClass('l');
						$("#id" + xsid).removeClass('wo');
						$("#id" + xsid).removeClass('a');
						$("#id" + xsid).addClass('h');
					} else if (atndname == 'WO') {
						$("#id" + xsid).removeClass('p');
						$("#id" + xsid).removeClass('l');
						$("#id" + xsid).removeClass('h');
						$("#id" + xsid).removeClass('a');
						$("#id" + xsid).addClass('wo');
					} else if (atndname == 'A') {
						$("#id" + xsid).removeClass('p');
						$("#id" + xsid).removeClass('l');
						$("#id" + xsid).removeClass('h');
						$("#id" + xsid).removeClass('wo');
						$("#id" + xsid).addClass('a');
					} else {
						$("#id" + xsid).removeClass('p');
						$("#id" + xsid).removeClass('l');
						$("#id" + xsid).removeClass('h');
						$("#id" + xsid).removeClass('wo');
						$("#id" + xsid).removeClass('a');
						$("#id" + xsid).addClass('edit-input');
					}
				} else {
					$("#atndname").val("");
					$("#search").val("");
					$("#search").attr('data-procat', "");
					$("#"+sid).hide();
					//calculateSum();
				}
				calculateSum();
			}
		function selectAutocompleteValue() {
			$("[class=edit-input]").filter("[value='P']").prop("class", 'p');
			$("[class=edit-input]").filter("[value='L']").prop("class", 'l');
			$("[class=edit-input]").filter("[value='H']").prop("class", 'h');
			$("[class=edit-input]").filter("[value='WO']").prop("class", 'wo');
			$("[class=edit-input]").filter("[value='A']").prop("class", 'a');
		$("#atndname").val("");
		$("#search").val("");
		$("#search").attr('data-procat', "");
		$("#suggesstion-box1_").hide();
	
		}
        function calculateSum() {
            var tbl = $('#table_atten');
            tbl.find('tr').each(function () {
                var sumA = 0;
                 var sumP = 0;
                 var sumL = 0;
                 var sumH = 0;
                 var sumWO = 0;
                $(this).find('input[type=text]').each(function () {
                    if (this.value.length != 0) {
                    	
                    if(this.value=="A"){
                     sumA += 1;
                    }else if(this.value=="P"){
                     sumP += 1;
                    }else if(this.value=="L"){
                     sumL += 1;
                    }
                    /* else if(this.value=="H"){
                     sumH += 1;
                    } */
                    else if(this.value=="WO"){
                     sumWO += 1;
                    }else{
                    
                    }
                    }
                });
 				$(this).find('.total-present').text(sumP.toFixed());
        		$(this).find('.total-leave').text(sumL.toFixed());
        		$(this).find('.total-holiday').text(sumH.toFixed());
        		$(this).find('.total-weekoff').text(sumWO.toFixed());
        		var empworkday=parseFloat($(this).find('.total-present').text())+parseFloat($(this).find('.total-leave').text())+parseFloat($(this).find('.total-weekoff').text());
        		$(this).find('.total-empWorkday').text(empworkday);
               
            });
        }
		//approve function for All attendance details
		function approve(len) {
			var dataset = [];
			var fromDate = $("#fromDate").val();
			var toDate = $("#endDate").val();
			var userrole = $("#sessionRole").val();
			var roleid = "";
			for (var x = 6; x <= userrole.length; x = x + 6) {
				roleid = roleid + '"' + userrole.slice(x - 6, x) + '",';
			}
			roleid = roleid.substring(0, roleid.length - 1);
			for(i=0;i<len;i++){
				item={};
				item.empId =$("#empId_"+i).text();
				item.bandid = $("#bandid_"+i).text();
				item.dept = $("#deptId_"+i).text();
				item.subDept = $("#subDeptId_"+i).text();
				item.attendType = $("#attendType_"+i).text();
				item.id1 = $("#id1_"+i).val();
				item.id2 = $("#id2_"+i).val();
				item.id3 = $("#id3_"+i).val();
				item.id4 = $("#id4_"+i).val();
				item.id5 = $("#id5_"+i).val();
				item.id6 = $("#id6_"+i).val();
				item.id7 = $("#id7_"+i).val();
				item.id8 = $("#id8_"+i).val();
				item.id9 = $("#id9_"+i).val();
				item.id10 = $("#id10_"+i).val();
				item.id11 = $("#id11_"+i).val();
				item.id12 = $("#id12_"+i).val();
				item.id13 = $("#id13_"+i).val();
				item.id14 = $("#id14_"+i).val();
				item.id15 = $("#id15_"+i).val();
				item.id16 = $("#id16_"+i).val();
				item.id17 = $("#id17_"+i).val();
				item.id18 = $("#id18_"+i).val();
				item.id19 = $("#id19_"+i).val();
				item.id20 = $("#id20_"+i).val();
				item.id21 = $("#id21_"+i).val();
				item.id22 = $("#id22_"+i).val();
				item.id23 = $("#id23_"+i).val();
				item.id24 = $("#id24_"+i).val();
				item.id25 = $("#id25_"+i).val();
				item.id26 = $("#id26_"+i).val();
				item.id27 = $("#id27_"+i).val();
				item.id28 = $("#id28_"+i).val();
				item.id29 = $("#id29_"+i).val();
				item.id30 = $("#id30_"+i).val();
				item.id31 = $("#id31_"+i).val();
				item.fromDate = fromDate;
				item.toDate = toDate;
				item.roleId = roleid;
				item.totalPresent =$("#totalPresent_"+i).text();
				item.leave =$("#leave_"+i).text();
				item.weekoff =$("#weekoff_"+i).text();
				item.holiday =$("#holiday_"+i).text();
				item.workday =$("#workday_"+i).text();
				item.workingday =$("#workingday_"+i).text();
				item.approveStatus =$("#approveStatus_"+i).text();
				item.remarks =$("#remarks_"+i).text();
				dataset.push(item);
				console.log(item)
			}
			if (dataset.length > 0) {
				console.log(JSON.stringify(dataset))
				var isApprove = $("#isApprove").val();
				if (isApprove == "" || isApprove==null) {
				$.ajax({
							type : "POST",
							url : "view-goal-attendance-approve-attnd",
							dataType : "json",
							contentType : "application/json",
							data : JSON.stringify(dataset),
							success : function(response) {
								if (response.message == "Success") {
									$("#messageParagraph").text(
											" Approved Successfully");
									$("#msgOkModal").removeClass("btn3");
									$("#msgOkModal").addClass("btn1");
									$("#msgModal").modal('show');
									allAttendanceData();
								} else {
									$("#messageParagraph").text("Something Went Wrong , Please Try Again After Sometime!");
									$("#msgOkModal").removeClass("btn3");
									$("#msgOkModal").addClass("btn1");
									$("#msgModal").modal('show');
								}
							},
							error : function(response) {
								//console.log(response)
							}
						});
			}else{
				$("#messageParagraph").text("YOU’RE ALREADY APPROVED!");
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');	
			}
		}else{
			$("#messageParagraph").text("NO DATA FOR APPROVE!");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
	  }
}
//save as draft function for All attendance details
	function saveAsDraft(len) {
			var dataset = [];
			var fromDate = $("#fromDate").val();
			var toDate = $("#endDate").val();
			var userrole = $("#sessionRole").val();
			var roleid = "";
			for (var x = 6; x <= userrole.length; x = x + 6) {
				roleid = roleid + '"' + userrole.slice(x - 6, x) + '",';
			}
			roleid = roleid.substring(0, roleid.length - 1);
			for(i=0;i<len;i++){
				item={};
				item.empId =$("#empId_"+i).text();
				item.bandid = $("#bandid_"+i).text();
				item.dept = $("#deptId_"+i).text();
				item.subDept = $("#subDeptId_"+i).text();
				item.attendType = $("#attendType_"+i).text();
				item.id1 = $("#id1_"+i).val();
				item.id2 = $("#id2_"+i).val();
				item.id3 = $("#id3_"+i).val();
				item.id4 = $("#id4_"+i).val();
				item.id5 = $("#id5_"+i).val();
				item.id6 = $("#id6_"+i).val();
				item.id7 = $("#id7_"+i).val();
				item.id8 = $("#id8_"+i).val();
				item.id9 = $("#id9_"+i).val();
				item.id10 = $("#id10_"+i).val();
				item.id11 = $("#id11_"+i).val();
				item.id12 = $("#id12_"+i).val();
				item.id13 = $("#id13_"+i).val();
				item.id14 = $("#id14_"+i).val();
				item.id15 = $("#id15_"+i).val();
				item.id16 = $("#id16_"+i).val();
				item.id17 = $("#id17_"+i).val();
				item.id18 = $("#id18_"+i).val();
				item.id19 = $("#id19_"+i).val();
				item.id20 = $("#id20_"+i).val();
				item.id21 = $("#id21_"+i).val();
				item.id22 = $("#id22_"+i).val();
				item.id23 = $("#id23_"+i).val();
				item.id24 = $("#id24_"+i).val();
				item.id25 = $("#id25_"+i).val();
				item.id26 = $("#id26_"+i).val();
				item.id27 = $("#id27_"+i).val();
				item.id28 = $("#id28_"+i).val();
				item.id29 = $("#id29_"+i).val();
				item.id30 = $("#id30_"+i).val();
				item.id31 = $("#id31_"+i).val();
				item.fromDate = fromDate;
				item.toDate = toDate;
				item.roleId = roleid;
				item.totalPresent =$("#totalPresent_"+i).text();
				item.leave =$("#leave_"+i).text();
				item.weekoff =$("#weekoff_"+i).text();
				item.holiday =$("#holiday_"+i).text();
				item.workday =$("#workday_"+i).text();
				item.workingday =$("#workingday_"+i).text();
				item.approveStatus =$("#approveStatus_"+i).text();
				item.remarks =$("#remarks_"+i).text();
				dataset.push(item);
			//	console.log(item)
			}
			if (dataset.length > 0) {
				//console.log(JSON.stringify(dataset))
				$.ajax({
							type : "POST",
							url : "view-goal-attendance-save-draft",
							dataType : "json",
							contentType : "application/json",
							data : JSON.stringify(dataset),
							success : function(response) {
								if (response.message == "Success") {
									$("#messageParagraph").text("Saved As Draft Successfully");
									$("#msgOkModal").removeClass("btn3");
									$("#msgOkModal").addClass("btn1");
									$("#msgModal").modal('show');
									//location.reload();
								} else {
									$("#messageParagraph").text("Something Went Wrong , Please Try Again After Sometime!");
									$("#msgOkModal").removeClass("btn3");
									$("#msgOkModal").addClass("btn1");
									$("#msgModal").modal('show');
									//location.reload();
								}
							},
							error : function(response) {
								//console.log(response)
							}
						});
 
		}else{
			$("#messageParagraph").text("NO DATA FOR APPROVE!");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
	  }
}
		
	    $(function () {
	    	
	        var tbl = $('#table_atten');
	        tbl.find('tr').each(function () {
	            // $this = this;
	            $(this).find('input[type=text]').bind("keyup", function () {
	                calculateSum();
	            });
	        });

	        function calculateSum() {
	            var tbl = $('#table_atten');
	            tbl.find('tr').each(function () {
	                //var sum = 0;
	                 var sumP = 0;
	                 var sumL = 0;
	                $(this).find('input[type=text]').each(function () {
	                    if (this.value.length != 0) {
	                    if(this.value=="A"){
	                     sum += 1;
	                     
	                    }else if(this.value=="P"){
	                     sumP += 1;
	                    }else if(this.value=="L"){
	                     sum += 1;
	                    }else if(this.value=="H"){
	                     sum += 1;
	                    }else if(this.value=="WO"){
	                     sum += 1;
	                    }else{
	                    
	                    }
	                       
	                    }
	                });
	 				$(this).find('.total-leave').val(sumL.toFixed());
	        $(this).find('.total-present').val(sumP.toFixed());
	               
	            });
	        }
	    });
 function filterData1() {
	 $("#quickFilter").val('');
	filterData()
}
	function cancelBar() {
		var id = document.getElementById("closeKey");
		id.style.display = "block";

		if ($('#quickFilter').val() == null || $('#quickFilter').val() == "") {
			id.style.display = "none";
		} 
	}
 
	function filterData() {
		var id = $("#quickFilter").val();
		var value = id.toLowerCase();
		$("#table_atten tr").filter(function() {
			$('#theadBody').show();
			$('#table_atten tbody tr[data-no-results-found]').remove();
			$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
		});
		if ($('#table_atten tbody tr:visible').length === 0) {
			$('#theadBody').show();
			$('#table_atten tbody')
					.append(
							'<tr data-no-results-found><td colspan="50" class="dtxt">No Data Found!</td></tr>');
		}
	}
</script>


</head>

<body>
	<div layout:fragment="content" class="maincontent">
		<div class="container-fluid">
			<div class="d-flex">
				<div class="maincontentsec">
					<div class="row ">

						<input type="hidden" id="sessionId" th:value="${userId}" /> <input
							type="hidden" id="sessionRole" th:value="${userRole}" /> <input
							type="hidden" id="isApprove" /> <input type="hidden"
							id="startDayForAtten" th:value="${startDayForAtten}" /><input
							type="hidden" id="empRole" th:value="${empRole}" /> <input
							type="hidden" id="mrRole" th:value="${mrRole}" /> <input
							type="hidden" id="adRole" th:value="${adRole}" />


						<div class="col-md-12 mt-for">
							<div class="font-design">Attendance List</div>
							<div class="topdetails roomListDiv"></div>
							<div class="slidearrow"></div>
						</div>

						<div class="col-md-3">
							<div class="form-group">
							  <label>Band Name</label>
								<div class="select">
									<select id="attndband" class="form-control">
										<option value="">--SELECT--</option>
										<option th:each="c,iter:${bandList}" th:value="${c.key}"
											th:text="${c.name}"></option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-2">
							<div class="form-group">
							  <label>Year</label>
								<div class="select">
									<select id="attndyear" class="form-control">
										<option th:each="c,iter:${yearList}" th:value="${c.name}"
											th:text="${c.name}"></option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-3">
							<div class="form-group">
							  <label>Month Name</label>
								<div class="select">
									<select id="attndmonth" class="form-control">
										<option value="1">JANUARY</option>
										<option value="2">FEBRUARY</option>
										<option value="3">MARCH</option>
										<option value="4">APRIL</option>
										<option value="5">MAY</option>
										<option value="6">JUNE</option>
										<option value="7">JULY</option>
										<option value="8">AUGUST</option>
										<option value="9">SEPTEMBER</option>
										<option value="10">OCTOBER</option>
										<option value="11">NOVEMBER</option>
										<option value="12">DECEMBER</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-2">
						  <label>From Date</label>
							<div class="form-group calendar_box">
								<input type="text" id="fromDate" value="" class="form-control"
									th:attr="onkeyup=|formatDate('fromDate','${session.DATEFORMAT_JS}')|"
									readonly> <!-- <i class="ti-calendar picker_calendar"
									id="fromDateCalendar"></i> -->
							</div>
						</div>
						<div class="col-md-2">
						  <label>To Date</label>
							<div class="form-group calendar_box">
								<input type="text" id="endDate" value="" class="form-control"
									th:attr="onkeyup=|formatDate('endDate','${session.DATEFORMAT_JS}')|"
									readonly> <!-- <i class="ti-calendar picker_calendar"
									id="endDateCalendar"></i> -->
							</div>
						</div>
					</div>
					<div class="d-flex mt-20">
						<div class="col-md-4  btn-hs">
							<div class="font-design" id="totalEmp">Employee Attendance
								Details(<span></span>)</div>
						</div>
						
						<div class="col-md-4" id="searchRowDiv">
							<div class="input-style">
								<input type="text" placeholder="Search.." name="search"
									class="searchboxinput" onkeyup="filterData(),cancelBar()" id="quickFilter"
									 autocomplete="off">
								<div class="searchicon">
									<a href="javascript:void(0)"><span
										style="display: none; border-right: 1px solid #ccc; padding-right: 5px;"
										id="closeKey" 
									onclick=" filterData1(); $('#quickFilter').val('');document.getElementById('closeKey').style.display='none';"
										class="close_i"><i class="ti-close srchicon"></i></span></a><a
										href="javascript:void(0)"><i class="ti-search srchicon"></i></a>
								</div>
							</div>
						</div>
						
						
						<div class="col-md-4 btn-hs" align="right">
							<button class="btn4" onclick="totalUserCSV()">Download</button>
							<div id="assignBtn"></div>
							<div id="saveBtn"></div>
						</div>

					</div>
					<!-- 	<div id="tbodyId"> -->
					<div class="tbl-scrl">
						<table class="table md-tbl  table-bordered" id="table_atten">
							<thead id="thids">

							</thead>
							<tbody class="tbodyCls" id="tbodyId">
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

</body>
</html>