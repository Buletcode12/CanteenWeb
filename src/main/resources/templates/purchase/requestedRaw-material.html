<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/master}">

<head>
<style type="text/css">
.highcharts-exporting-group {
	display: none;
}

.autocomplete {
	position: relative;
	display: inline-block;
	width: 100%;
}

.btn-primarynew {
	color: #fff !important;
	background-color: #0d6efd;
	border-color: #0d6efd;
}

.slidebox {
	padding: 14px;
	margin-top: 0px;
	margin: 0px 10px;
}

.new-btn {
	border: none;
	border-radius: 4px;
	font-size: 10px;
	background-color: #5784c4;
	color: #fff !important;
	margin-left: 5px;
	margin-bottom: 8px;
	width: 72px;
	height: 28px;
	line-height: 12px;
	float: right;
	text-transform: uppercase;
	cursor: pointer;
}

.form-group label {
	font-size: 12px;
	position: relative;
	top: 4px;
}

.holdCls {
	background-color: rgb(0, 143, 0);
}

.bg_white {
	background: #ffffff !important;
}

.blueClsWT {
	background: #0076ba;
	color: #fff;
}

.blueCls {
	background: #0076ba;
	color: #fff;
}

.blueClsWT::before {
	font-size: 8px;
	color: #FFF;
	content: '\e64c';
	font-family: 'themify';
	padding-right: 7px;
}

.modal-body table td input[type=checkbox] {
	width: 0px;
	margin-right: 16px;
	position: relative;
	top: 0px;
	float: none;
}

.firstnode {
	color: #929292;
	border-top: 1px solid transparent !important;
	border-left: 1px solid transparent !important;
	border-bottom: 1px solid transparent !important;
	width: 320px;
	font-size: 12px;
	font-weight: 100;
}

.simple-tree-table-closed .simple-tree-table-icon:after {
	content: "\f105" !important;
	font-family: 'FontAwesome';
	color: black;
	display: inline-block;
	margin-right: 6px;
	transform: rotate(90deg);
}

.sugg-cls ul {
	height: 150px;
	overflow-x: scroll;
	position: relative;
}

ul#autocomplete-list1 {
	position: relative;
	z-index: 999;
}

ul#autocomplete-list1 li {
	position: relative;
	color: #fff;
	padding-left: 6px;
	background-color: #1f57a8;
	border-bottom: solid 1px #6189c2;
	padding-top: 5px;
	padding-bottom: 5px;
}

a.addCust {
	color: #fff;
}

.simple-tree-table-opened .simple-tree-table-icon:after {
	content: "\f105" !important;
	font-family: 'FontAwesome';
	color: black;
	display: inline-block;
	margin-right: 6px;
}

.simple-tree-table-icon {
	display: inline-block;
	width: 1.5em;
	line-height: 1.5em;
	margin: 0.1em;
	background-color: transparent;
	text-align: center;
	cursor: pointer;
}

label.lbl {
	position: relative;
	top: -2px !important;
}

.tptCls {
	background: transparnt;
}

.modal-content {
	position: relative;
	display: flex;
	flex-direction: column;
	width: 118%;
	pointer-events: auto;
	background-color: #fff;
	background-clip: padding-box;
	border: -1px solid rgba(0, 0, 0, .2);
	border-radius: 0.3rem;
	outline: 0;
}
/*  .picker_calendar2 {
	cursor: pointer;
	position: absolute;
	top: 316px;
	right: 19px;
}

.picker_calendar3 {
	cursor: pointer;
	position: absolute;
	top: 375px;
	right: 691px;
} */
.font-small {
	font-size: 13px;
}

.billtxt {
	color: #777 !important;
	font-size: 14px;
	margin-top: 10px;
	text-transform: uppercase;
	display: block;
}

.fa {
	display: inline-block;
	font: normal normal normal 14px/1 FontAwesome;
	font-size: inherit;
	text-rendering: auto;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

.form-controls {
	font-family: 'Montserrat', sans-serif;
	display: block;
	width: 100%;
	font-size: 12px;
	color: #929292;
	background-color: transparent;
	background-clip: padding-box;
	border: 1px solid #d5d5d5;
	transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
	line-height: 30px;
	border-radius: 0;
	padding: 0;
}
</style>
<script>
	$(document)
			.ready(

					function() {

						/* 	$("#organatioModal").hide();
							$("#customerModal").hide();

							$("#documentDetails").hide();
							$('#docTbl').on('click', '.rmv1', function() {
								openDeleteConfirm();
								var value = $(this).parent("div").attr("id");
								$("#dltValue").val(value);
							}); */
						var gridDiv = document.querySelector('#myGrid');
						new agGrid.Grid(gridDiv, gridOptions);

						var gridDiv = document.querySelector('#item');
						new agGrid.Grid(gridDiv, itemOptions);
						
						var gridDiv = document.querySelector('#activity');
						new agGrid.Grid(gridDiv, activityOptions);

						$("#toDateCalendarDt").hide();
						//$("#Cancel").hide();
						$("#addData").hide();
						//$("#save").hide();
						$('#reqAppvBtn').attr("disabled", true);
						$('#delete').attr("disabled", true);
						$('#salesOrder').attr("disabled", true);

						//gridOptions.api.setRowData();
						//itemOptions.api.setRowData();
						var rowData = [];
						gridOptions.api.setRowData(rowData);
						console.log(rowData);
						$('.loader').show();
						agGrid.simpleHttpRequest({
							url : 'view-req-rwMaterial-ItemDtls-through-ajax'
						}).then(function(data) {
							var jsonData = JSON.parse(data.body);
							var allData=jsonData.Plan;
							var len = allData.length;
							$('#totalCandidate').find('span').html(len);
							gridOptions.api.setRowData(allData);
							$('.loader').hide();
						});

						$("#browseBtn").click(function() {
							$("#itemName").val(null);
							$("#hsnCode").val(null);
							$("#unit").val(null);
							$("#itemNameTemp").val(null);
							$("#hsnCodeTemp").val(null);
							$("#unitTemp").val(null);
							$("#suggesstion-box_").hide();
							$("#myModal").modal('show');

						})
						var dateFormat = localStorage.getItem("dateFormat");

						$("#toDateCalendar").datetimepicker({
							format : dateFormat,
							closeOnDateSelect : true,
							minDate : new Date(),
							timepicker : false,
						}).on("change", function() {
							$('#qutValidDate').val($(this).val());
						})

						$('#qutValidDate').blur(function() {
							$("#toDateCalendar").val($(this).val());
						})
                      $('#pOrder').attr("disabled", true);
						/* 
								product category	 
						 */
						$("#browseBtn")
								.click(
										function() {

											$(".benefitChk").prop("checked",
													false);
											$("#productModName").val("");
											$("#brand").val("");
											$("#skuMod").val("");
											$("#modelMod").val("");
											$("#manufactureItemMod").val("");
											$("#variationTypeMod").val("");
											$("#variationValueMod").val("");
											$("#unitMod").val("");
											$("#productCategoryCBDiv").empty();
											$("#select_product").empty();
											$('.loader').show();
											$("body").addClass("overlay");
											$("#productDiv").modal("show");
											$
													.ajax({
														type : "POST",
														url : "manage-purchase-order-item-get-product-list",
														dataType : "json",
														contentType : "application/json",
														data : "a",
														success : function(
																response) {
															if (response.message == "success") {
																for (var i = 0; i < response.body.length; i++) {
																	var row = "";
																	if (response.body[i].categoryId == response.body[i].parentId) {
																		if (response.body[i].nodeCount > 0) {

																			row = '<tr data-node-id="'+response.body[i].categoryId+'" class="abc" id="'+response.body[i].categoryId+'">'
																					+ '<td class="firstnode" id=lbl_'+response.body[i].categoryId+'>'
																					+ response.body[i].categoryName
																					+ '</td></tr>';
																		} else {
																			row = '<tr data-node-id="'+response.body[i].categoryId+'" class="abc" id="'+response.body[i].categoryId+'">'
																					+ '<td class="firstnode" id=lbl_'+response.body[i].categoryId+'><input class="benefitChk pc1-box" type="checkbox" id="ccCheck_'
																					+ response.body[i].categoryId
																					+ '" value="'
																					+ response.body[i].categoryId
																					+ '" name="'
																					+ response.body[i].categoryName
																					+ '" onchange=selectCheckBox("'
																					+ response.body[i].categoryId
																					+ '","'
																					+ response.body[i].catLevel
																					+ '")>'
																					+ response.body[i].categoryName
																					+ '</td></tr>';
																		}

																	} else {
																		if (response.body[i].nodeCount > 0) {
																			row = '<tr data-node-id="'+response.body[i].categoryId+'" data-node-pid="'+response.body[i].parentId+'" class="abc" id="'+response.body[i].categoryId+'">'
																					+ '<td class="firstnode" id=lbl_'+response.body[i].categoryId+'>'
																					+ response.body[i].categoryName
																					+ '</td></tr>';
																		} else {

																			row = '<tr data-node-id="'+response.body[i].categoryId+'" data-node-pid="'+response.body[i].parentId+'" class="abc" id="'+response.body[i].categoryId+'">'
																					+ '<td class="firstnode" id=lbl_'+response.body[i].categoryId+'><input class="benefitChk pc1-box" type="checkbox" id="ccCheck_'
																					+ response.body[i].categoryId
																					+ '" value="'
																					+ response.body[i].categoryId
																					+ '" name="'
																					+ response.body[i].categoryName
																					+ '" onchange=selectCheckBox("'
																					+ response.body[i].categoryId
																					+ '","'
																					+ response.body[i].catLevel
																					+ '")>'
																					+ response.body[i].categoryName
																					+ '</td></tr>';
																		}
																	}
																	$(
																			"#productCategoryCBDiv")
																			.append(
																					row);

																}

																$('.loader')
																		.hide();
																$("body")
																		.removeClass(
																				"overlay");

																$('#basic')
																		.simpleTreeTable(
																				{
																					expander : $('#expander'),
																					collapser : $('#collapser'),
																					store : 'session',
																					storeKey : 'simple-tree-table-basic'
																				});
															}
														},
														error : function(data) {
															//console.log(data)
															$('.loader').hide();
															$("body")
																	.removeClass(
																			"overlay");
															$("#productDiv")
																	.modal(
																			"show");
														}
													});
										})

					});

	/* 
	
	 Quotation 
	
	 */

	 var columnDefs = [
			{
				headerCheckboxSelection : false,
				headerCheckboxSelectionFilteredOnly : false,
				checkboxSelection : true,
				width : 10,
				sortable : false,
				filter : false,
				resizable : true

			},
			{
				headerName : 'Plan Id',
				width : 150,
				field : "planId",
				cellRenderer : function(params) {
				return '<a id="planId" onclick=editPlan("'
				+params.data.planId+'","'+params.data.approveStatus+'","'+params.data.week_name 
				+ '") href="javascript:void(0)">'
				+ params.data.planId + '</a>';

			}
			}, {
				headerName : 'Week',
				width : 200,
				field : "week_name",
				cellStyle : {
					textAlign : 'center'
				}
			}, {
				headerName : 'From Date',
				width : 200,
				field : "from_date",
				cellStyle : {
					textAlign : 'center'
				}
			},{
				headerName : 'To Date',
				field : "to_date",
				width : 200,
				cellStyle : {
					textAlign : 'center'
				}
			}, {
				headerName : 'status',
				field : "plan_status",
				width : 150,
				cellStyle : {
					textAlign : 'center'
				}
			}, {
			
			headerName : 'Approve Status',
			field : "approveStatus",
			width:160,
			cellStyle : {
				textAlign : 'center'
			},
			cellRenderer : function(params) {
				if (params.data.approveStatus =="Approved") { 
					return '<div style="color:#0642f5">'+params.data.approveStatus+'</div>';
				}else {
					return '<div style="color:#a9a9a9">'+params.data.approveStatus+'</div>';
				}
			}
			
			}, {
				headerName : 'description',
				field : "description",
				width : 400,
			}];

	// let the grid know which columns and what data to use
	var gridOptions = {
		columnDefs : columnDefs,
		rowSelection : 'multiple',
		groupSelectsChildren : true,
		suppressRowClickSelection : true,
		suppressAggFuncInHeader : true,
		defaultColDef : {
			sortable : true,
			filter : true,
			resizable : true,
			width : 120
		},
		//onSelectionChanged : onSelectionChanged,
	};
	
	// for activity table
	var activityDefs = [
		{
			//headerCheckboxSelection : true,
			headerCheckboxSelectionFilteredOnly : true,
			checkboxSelection : true,
			sortable : false,
			filter : false,
			resizable : true,
			width : 20
		},
		{
			headerName : "SKU/ITEM CODE",
			field : "sku",
			width : 150,
			cellRenderer : function(params) {
				return '<a onclick=editProductsku("' + params.data.itemId
						+ '") href="javascript:void(0)">' + params.data.sku
						+ '</a>';
			},
			suppressCsvExport : "true"
		}, , {
			headerName : "Plan Id",
			field : "planId",
			width : 200,
			cellStyle : {
				textAlign : 'center'
			},
			hide : "true"

		},
		{
			headerName : "Item Name",
			field : "itemName",
			width : 350,
			
		},
		 {
			headerName : "Type",
			field : "itemType",
			width : 160,
			cellStyle : {
				textAlign : 'center'
			}

		},
		{
			headerName : "UNIT",
			field : "unitName",
			width : 110,
			cellStyle : {
				textAlign : 'center'
			}

		}, {
			headerName : "UNIT",
			field : "unit",
			width : 80,
			hide : true

		} ,
		{
			headerName : "Plan Quantity",
			field : "quantity",
			type : 'rightAligned',
			width : 170,
		},{
			headerName : "Stock Quantity",
			field : "availQty",
			width : 170,
			type : 'rightAligned',

		},
		{
			headerName : "Required Quantity",
			field : "reqQty",
			width : 170,
			type : 'rightAligned',
		}];


	// let the grid know which columns and what data to use product table

	var activityOptions = {
			columnDefs : activityDefs,
			rowSelection : 'single',
			groupSelectsChildren : true,
			suppressRowClickSelection : true,
			suppressAggFuncInHeader : true,
			defaultColDef : {
				sortable : true,
				filter : true,
				resizable : true,
				width : 120
			},
			onSelectionChanged : onSelectionChangeChild,
		};
	
	var itemDefs = [
			{
				//headerCheckboxSelection : true,
				headerCheckboxSelectionFilteredOnly : true,
				checkboxSelection : true,
				width : 10,
				sortable : false,
				filter : false,
				resizable : true

			},
			{
				headerName : "SlNo",
				field : "slNo",
				width : 70,
				cellRenderer : function(params) {
					if (params.data.slNo) {
						return '<a onclick=editProduct("' + params.data.slNo
								+ '") href="javascript:void(0)">'
								+ params.data.slNo + '</a>';
					} else {
						return '<a onclick=editProduct("' + params.data.slNo
								+ '") href="javascript:void(0)">'
								+ params.data.slNo + '</a>';
					}
				}
			}, {
				headerName : 'SKU',
				field : "sku",
				width : 100,

			}, {
				headerName : 'HSN Code',
				field : "hsnCode",
				width : 120,
			/* cellClass : function(params) {
				if (params.data.grnStatus === 'Generated') {
					return (params.data.grnStatus === 'Generated' ? 'blueClsWT' : 'tptCls');
				}
			} */
			}, {

				headerName : 'Item Name',
				field : "itemName",
				width : 175,
			}, {
				headerName : 'Item Id',
				field : "itemId",
				width : 100,
				hide : true,
			}, {
				headerName : 'Quantity',
				field : "quantity",
				type : 'rightAligned',
				width : 100,
				//valueFormatter : currencyFormatter
			}, {

				headerName : 'Unit',
				field : "unitName",
				width : 70,
			}, {
				headerName : 'Unit',
				field : "unit",
				hide : true,

			}, {
				headerName : 'Unit Price',
				field : "unitPrice",
				type : 'rightAligned',
				width : 120,
				valueFormatter : currencyFormatter
			}, {
				headerName : 'Discount',
				field : "discount",
				type : 'rightAligned',
				width : 120,
				valueFormatter : currencyFormatter
			}, {
				headerName : 'Amount',
				field : "lineTotal",
				type : 'rightAligned',
				width : 100,
				valueFormatter : currencyFormatter,
				aggFunc : 'sum'
			}, {
				headerName : 'GST Rate',
				field : "gstRate",
				type : 'rightAligned',
				width : 100,
				valueFormatter : currencyFormatter
			}, {
				headerName : 'CGST',
				field : "itemCgst",
				type : 'rightAligned',
				width : 70,
			//valueFormatter : currencyFormatter
			}, {
				headerName : 'SGST',
				field : "itemSgst",
				type : 'rightAligned',
				width : 70,
			//valueFormatter : currencyFormatter
			}, {
				headerName : 'IGST',
				field : "itemIgst",
				type : 'rightAligned',
				width : 70,
			//valueFormatter : currencyFormatter
			}, {
				headerName : 'Taxable Amount',
				field : "taxableAmt",
				type : 'rightAligned',
				width : 170,
			//valueFormatter : currencyFormatter
			}, {
				headerName : "Pending Status",
				field : "pendingQty",
				width : 173,
				hide : true,

			},
	/*{
		headerName : "GRN Date",
		field : "grnDate",
		width : 110,
	},
	
	{
		headerName : "GRN Id",
		field : "grnId",
		width : 100,
	} */];
	var itemOptions = {
		columnDefs : itemDefs,
		rowSelection : 'multiple',
		groupSelectsChildren : true,
		suppressRowClickSelection : true,
		suppressAggFuncInHeader : true,
		defaultColDef : {
			sortable : true,
			filter : true,
			resizable : true,
			width : 251,
			height : 10
		},
		onSelectionChanged : rowSelectItem,
		getRowNodeId : function(data) {
			return data.slNo;
		}
	};
	function changeDateFormat(inputDate) {
		var splitDate = inputDate.split('-');
		if (splitDate.count == 0) {
			return null;
		}
		var year = splitDate[0];
		var month = splitDate[1];
		var day = splitDate[2];

		return day + '-' + month + '-' + year;
	}

	function rowSelect() {
		var selectedRows = gridOptions.api.getSelectedRows();
		var rowCount = 0;
		selectedRows.forEach(function(selectedRow, index) {
			rowCount = rowCount + 1;
		});

		if (rowCount > 0) {
			$('#pOrder').attr("disabled", false);
		} else {
			$('#pOrder').attr("disabled", true);
		}
	}
	function rowSelectItem() {
		var selectedRows = itemOptions.api.getSelectedRows();
		var rowCount = 0;
		selectedRows.forEach(function(selectedRow, index) {
			rowCount = rowCount + 1;
		});
		 var selectedNodes = itemOptions.api.getSelectedNodes();
		 var selectedData = selectedNodes.map(node => node.data);
		if (rowCount > 0) {
		
			$('#delete1').attr("disabled", false);
			$('#newItem').attr("disabled", true);
			}else{
				$('#newItem').attr("disabled", false);
				$('#delete1').attr("disabled", true);
		} 
 
	}
	function cancel() {
		 $(".formValidation").remove();
			$("#totalReq").show();
			$("#searchRowDiv").show();
			$(".btn-hs").show();
			$("#myGrid").show();
			$("#demo").hide();
			$("#reqDltBtn").attr('disabled', true);
			$("#newBtn").attr('disabled', false);
			agGrid.simpleHttpRequest({
				url : 'view-req-rwMaterial-ItemDtls-through-ajax'
			}).then(function(data) {
				var jsonData = JSON.parse(data.body);
				var allData=jsonData.Plan;
				var len = allData.length;
				$('#totalReq').find('span').html(len);
				gridOptions.api.setRowData(allData);
			});
			$("#planId").val('');
			$("#week").val('');
			$("#year").val('');
			$("#description").val();
			closeNav();
		}
	function onQuickFilterChanged() {
		$(".ti-search srchicon").hide();
		gridOptions.api
				.setQuickFilter(document.getElementById('quickFilter').value);
	}

	function cancelBar() {
		var id = document.getElementById("closeKey");
		id.style.display = "block";

		if ($('#quickFilter').val() == null || $('#quickFilter').val() == "") {
			id.style.display = "none";
		}
	}
	var childid = "";
	function onSelectionChangeChild() {
		 var selectedNodes = activityOptions.api.getSelectedNodes();
		 var selectedData = selectedNodes.map(node => node.data);
		 childid= selectedData.map(node => node.slnoId);
		var selectedRows = activityOptions.api.getSelectedRows();
		var rowCount = 0;
		selectedRows.forEach(function(i) {
			rowCount = rowCount + 1;
		});
		if (rowCount > 0) {
			$('#pOrder').attr('disabled', false);
		}else{
			$('#pOrder').attr('disabled', true);
			
		}
	}
	function CancelPo() {
		$('#purchaseModal').modal('hide');
		var poId=$("#pohedId").html();
		
		$('.formValidation').remove();
		$("#pohedId").html('');
		$("#vendorName").val('');
		$("#vendorId").val('');
		$("#suggesstion-box1_").hide();
		$("#custGSTNo").val('');
		$("#qutValidDate").val('');
		$("#reference").val('');
		$("#paymentTermId").val('');
		$("#carrierId").val('');
		$('#approvePorder').show();
		$("#qutDescription").val('');
		$("#organizationName").val('');
		$("#customerName").val('');
		$("#addre").hide();
		$("#terms").val('');
		$("#itemId").val('');
		$("#itemName").val('');
		$("#quantity").val('');
		$("#unitPrice").val('');
		$("#discount").val('');
		$("#gstRate").val('');
		$("#lineTotal").val('');
		$("#tcsAmount").val('');
		$("#tcsName").val('');
		$("#subTotal").val('');
		$("#qIGST").val('');
		$("#qCGST").val('');
		$("#qSGST").val('');
		$("#grandTotal").val('');
		$("#adjustment").val('');
		$("#taxType").val('');
		$("#itemIgst").val('');
		$("#itemCgst").val('');
		$("#itemSgst").val('');
		$("#searchRowDiv").show();

		$("#delete").show();
		$('.formValidation').remove();
		$("#add").show();
		$("#myGrid").hide();
		$("#demo").show();
		$("#searchRowDiv").hide();
		$("#dwnld").hide();
		$("#save").hide();
		$("#Cancel").hide();
		$("#addData").hide();
		$('#hideTbl').show();
		$("#totalCandidate").show();
		$("#upld").show();
		$("#documentDetails").show();
		itemOptions.api.setRowData();
		$('#delete').attr("disabled", true);
		var tbl = '<tr> <td style="display:none" align="center" class="pdb-24"><input class="checkCls" type="checkbox" id="check2"><label for="check2"></label></td>'
				+ '<td style="display:none"><div class="form-group"> <select class="form-control documentclss" id="docid_0" onblur="removeValid(event);"> <option value="">Select</option> </select> </div></td>'
				+ '<td><div class="form-group"> <input type="text" value="" class="form-control docNoclss" id="docnoid_"></div></td>'
				+ '<td> <div class="control-group position-r"> <label class="custom-file-upload" for="uploadDoc_0" id="uploadFor_0"> <i class="ti-plus" id="clickImg_0"></i> </label>'
				+ '<div class="controls"> <input type="file" class="document" id="uploadDoc_0" name="userImage" onchange="saveMultiFile(event)" /></div> </div> <input type="hidden" id="uploadHidden_0" class="uploadHidCls">'
				+ '<div id="uploadedBillDiv_0" align="center" class="uploadedBillCls"></div> <div id="imageName_0" class="custom-file-upload"></div> <input type="hidden" id="editId_0"> </td>'
				+ '</tr>';
		$("#doctbodyData").append(tbl);
		$('#delete').attr("disabled", true);
		$('#grn').show();
		$('#approvePorder').attr("disabled", true);
	}
	function poDetails() {
		$('.loader').show();
	//	$("#save").show();
		$("#Cancel").show();
		$('#purchaseModal').modal('show');
		var date = (new Date()).toISOString().split('T')[0];
		var newDate = changeDateFormat(date);
		$("#purchaseDate").val(newDate);
		$("#organatioModal").show();
		$("#customerModal").hide();
		$("#addre").hide();
		$('#delete1').attr("disabled", true);

		$.ajax({
			type : "GET",
			url : "manage-purchase-order-get-insertedid",
			success : function(response) {
				if (response.message == "success") {
					$('.loader').hide();
					$("#purchageOrderReference").val(response.body[0].key);
				}
			},
			error : function(e) {
				$('.loader').hide();}
		});
		$("#doctbodyData").empty();
		var tbl = '<tr> <td style="display:none" align="center" class="pdb-24"><input class="checkCls" type="checkbox" id="check2"><label for="check2"></label></td>'
				+ '<td style="display:none"><div class="form-group"> <select class="form-control documentclss" id="docid_0" onblur="removeValid(event);"> <option value="">Select</option> </select> </div></td>'
				+ '<td><div class="form-group"> <input type="text" value="" class="form-control docNoclss" id="docnoid_"></div></td>'
				+ '<td> <div class="control-group position-r"> <label class="custom-file-upload" for="uploadDoc_0" id="uploadFor_0"> <i class="ti-plus" id="clickImg_0"></i> </label>'
				+ '<div class="controls"> <input type="file" class="document" id="uploadDoc_0" name="userImage" onchange="saveMultiFile(event)" /></div> </div> <input type="hidden" id="uploadHidden_0" class="uploadHidCls">'
				+ '<div id="uploadedBillDiv_0" align="center" class="uploadedBillCls"></div> <div id="imageName_0" class="imageName"></div><div id="dltImage_0" ></div><input type="hidden" id="editId_0></td>'
				+ '</tr>';
		$("#doctbodyData").append(tbl);

		var selectedRows = activityOptions.api.getSelectedRows();
		//var selectedRowsString = '';
		var sku = "";

		for (var i = 0; i < selectedRows.length; i++) {
			sku = sku + '"' + selectedRows[i].sku + '",';
		}
		sku = sku.substring(0, sku.length - 1);
		var itemId = "";
		for (var i = 0; i < selectedRows.length; i++) {
			itemId = itemId + '"' + selectedRows[i].itemId + '",';
		}
		itemId = itemId.substring(0, itemId.length - 1);
		if (sku) {
			agGrid.simpleHttpRequest(
					{
						url : 'view-req-rwMaterial-get-POItemdata?itemId='
								+ itemId + "&sku=" + sku
					}).then(function(data) {
				itemOptions.api.setRowData(data);
			});
		} else {
			$("#alert").modal('show');
			document.getElementById("textId").innerHTML = "Please Select Atleast one Record !";
		}
	}
	
	/* Vendor AutoSearch */

	function getVendorList() {
		var search = $("#vendorName").val();
		$("#addre").hide();

		if (search) {

			$
					.ajax({
						type : "POST",
						url : "manage-purchase-order-get-vendor-list",
						dataType : 'json',
						contentType : 'application/json',
						data : search,
						success : function(response) {
							if (response.message == "success") {
								if (response.body.length != 0) {
									$("#search").css("background", "#FFF");
									var content = '<ul id="autocomplete-list1" >';
									for (var i = 0; i < response.body.length; i++) {
										content += '<li style="margin-left:-30px; font-weight:100; font-size:12px;"   class="autocompletedata cp" onClick="selectAutocompleteValue1(\''
												+ response.body[i].vendorId
												+ '\',\''
												+ response.body[i].vendorName
												+ '\',\''
												+ response.body[i].custGSTNo
												+ '\',\''
												+ response.body[i].taxType
												+ '\')">'
												+ response.body[i].vendorName
												+ '</li>';
									}
									content += '<li style="margin-left:-30px;background-color:#082958;color:#fff;"   onclick="AddVendor();"><a class="addCust" href="#">Add New Vendor</a>'
											+ '</li>';
									content += '</ul>';
									//console.log("content " + content)
									$("#suggesstion-box1_").show();
									$("#suggesstion-box1_").html(content);

								} else {
									$("#search").css("background", "#FFF");
									var content = '<ul id="autocomplete-list1">';
									content += '<li style="margin-left:-30px; font-weight:100; font-size:14px; color:#ccc;     background-color: #0909e4;" onClick="selectAutocompleteValue()">'
											+ "No Data Found" + '</li>';
									content += '<li style="margin-left:-30px;"  onclick="AddVendor();"><aclass="addCust" href="#">Add New Vendor</a>'
											+ '</li>';
									content += '</ul>';
									$("#suggesstion-box1_").show();
									$("#suggesstion-box1_").html(content);
								}
							}
						},
						error : function(data) {
							console.log(data);
						}
					})
		} else {
			$("#suggesstion-box1_").hide();
		}

	}
	function saveMultiFile(event) {
		var AssignItemQty = event.currentTarget.value;
		var currentFldId = event.currentTarget.getAttribute('id');
		var l = currentFldId.split("_");
		var counter = l[1];
		var currentFldId = "#" + currentFldId;

		var uFile = $(currentFldId)[0].files[0];
		var fileName = event.currentTarget.value;
		var lastIndex = fileName.lastIndexOf("\\");
		if (lastIndex >= 0) {
			fileName = fileName.substring(lastIndex + 1);
		}
		var extension = fileName.split(".");

		var iURL = URL.createObjectURL(uFile);
		$("#uploadedBillDiv_" + counter).html("");
		if (extension[1] != null && extension[1] != "") {
			$("#uploadHidden_" + counter).val('');
		}
		if (extension[1] == "jpg" || extension[1] == "png"
				|| extension[1] == "jpeg") {
			var LightImg = "<div class='uploadicon position-l'><a class='example-image-link' href='" + iURL + "' title='" + fileName + "' target='_balnk'><i class='fa fa-picture-o'></i></a></div>";
		} else if (extension[1] == "pdf") {
			var LightImg = "<div class='uploadicon position-l'><a class='example-image-link' href='" + iURL + "' title='" + fileName + "' target='_balnk'><i class='fa fa-file-pdf-o'></i> </a></div>";
		} else if (extension[1] == "xls" || extension[1] == "xlsx") {
			var LightImg = "<div class='uploadicon position-l'><a class='example-image-link' href='" + iURL + "' title='" + fileName + "' target='_balnk'><i class='fa fa-file-excel-o'></i></a></div>";
		} else if (extension[1] == "doc" || extension[1] == "dox"
				|| extension[1] == "docx") {
			var LightImg = "<div class='uploadicon position-l'><a class='example-image-link' href='" + iURL + "' title='" + fileName + "' target='_balnk'><i class='fa fa-file-word-o'></i></a></div>";
		} else {
			var LightImg = "<div class='uploadicon position-l '> </div>";
		}
		var dltImg = "<i class='ti-close position-l rmv1'></i>";
		$("#uploadedBillDiv_" + counter).html(LightImg);
		$("#imageName_" + counter).html(fileName);
		$("#dltImage_" + counter).html(dltImg);

		$("#dltImage_" + counter).addClass("custom-file-delete");
		$("#clickImg_" + counter).removeClass("ti-plus");
		$("#clickImg_" + counter).addClass("ti-pencil");

	}
	function addMore1() {

		var lengthOfTableRow = $("#doctbodyData").children('tr').length;
		var cloneHtml = $("#docTbl tbody tr:first").clone();

		$("#docTbl tbody").append($("#docTbl tbody tr:first").clone());
		$("#myTable tbody tr td:last").html("");
		//var addMore = '<button type="button" class="btn btn-primary tr_clone_add" name="add" onclick="addMore1();"><span class="ti-plus"></span></button>&nbsp;'

		$("#docTbl tbody tr:last").find(".documentclss").val("");
		$("#docTbl tbody tr:last").find(".docNoclss").val("");
		$("#docTbl tbody tr:last").find(".documentclssup").val("");
		$("#docTbl tbody tr:last").find(".uploadedBillCls").empty();
		$("#docTbl tbody tr:last").find(".uploadHidCls").empty();
		$("#docTbl tbody tr:last").find(".uploadHidCls").val('');
		$("#docTbl tbody tr:last").find(".imageName").empty();
		var j = 0;
		$("#docTbl > #doctbodyData > tr").each(function(i) {

			var selectInput = $(this).find('select');
			var textInput = $(this).find('input');
			var fileInput = $(this).find('file');
			var divInput = $(this).find('div');
			var label = $(this).find('label');
			var iInput = $(this).find('i');
			selectInput.eq(0).attr('id', "docid_" + i);

			textInput.eq(1).attr('id', "docnoid_" + i);
			textInput.eq(2).attr('id', "uploadDoc_" + i);
			label.eq(1).attr('for', "uploadDoc_" + i);
			textInput.eq(3).attr('id', "uploadHidden_" + i);
			divInput.eq(4).attr('id', "uploadedBillDiv_" + i);
			divInput.eq(5).attr('id', "imageName_" + i);
			divInput.eq(6).attr('id', "dltImage_" + i);
			iInput.eq(0).attr('id', "clickImg_" + i);
			j++;
		})
		$("#clickImg_" + (j - 1)).removeClass("ti-pencil");
		$("#clickImg_" + (j - 1)).addClass("ti-plus");

	}

	function checkForDuplicateEntry(event) {
		var document = event.currentTarget.value;
		var currentFldId = event.currentTarget.getAttribute('id');
		var l = currentFldId.split("_");
		var counter = l[1];
		var count = 0;
		$(".docNoclss").each(function() {
			if (document == $(this).val()) {
				count++;
			}
		})
		if (count >= 2) {
			$("#messageParagraph").text("Document Name Already Entered");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');

			return false;
		} else {
			return true;
		}

	}
	function selectAutocompleteValue1(vendorId, vendorName, custGSTNo, taxType) {

		if (vendorId) {

			$("#vendorId").val(vendorId);

			$("#vendorName").val(vendorName);
			$("#custGSTNo").val(custGSTNo);
			$("#taxType").val(taxType);
			$("#search").val(vendorName);
			$("#search").attr('data-procat', vendorId);
			$("#suggesstion-box1_").hide();
			$("#addre").show();
			hideShowS();
			getAddressDetails(vendorId)
			getReferenceList(vendorId, '');
			//priceCalculation();
		} else {

			$("#vendorId").val("");

			$("#vendorName").val("");
			$("#custGSTNo").val("");
			$("#taxType").val("");
			$("#search").val("");
			$("#search").attr('data-procat', "");
			$("#suggesstion-box1_").hide();

		}
	}
	function selectAutocompleteValue() {

		$("#vendorId").val("");
		$("#vendorName").val("");
		$("#custGSTNo").val("");
		$("#taxType").val("");
		$("#search").val("");
		$("#search").attr('data-procat', "");
		$("#suggesstion-box1_").hide();

	}
	function addnewAddress() {
		$('#addAddressModel').modal('show');
		$("#billingInfo").show();
		$("#countryb").val('');
		$("#statesb").val('');
		$("#cityb").val('');
		$("#street1b").val('');
		$("#street2b").val('');
		$("#zipCode").val('');
		$("#phoneb").val('');
		$("#faxb").val('');

	}
	function addnewAddress1() {
		$("#country1s").val('');
		$("#states1s").val('');
		$("#city1s").val('');
		$("#street11s").val('');
		$("#street21s").val('');
		$("#zipCode1s").val('');
		$("#phone1s").val('');
		$("#fax1s").val('');
		$('#addAddressModel1').modal('show');
		$("#shippingInfo").show();

	}
	function getAddressDetails(vendorId) {
		$('.loader').show();
		//var Id=$("#custName").val();
		$.ajax({
			type : "GET",
			url : "manage-purchase-order-get-address?id=" + vendorId,

			async : false,
			success : function(response) {
				if (response.message == "Success") {
					$('.loader').hide();
					console.log(response.body)
					$("#con").html(response.body.country);
					$("#bstate").html(response.body.states);
					$("#bcity").html(response.body.city);
					$("#bstreet1").html(response.body.street1);
					$("#bstreet2").html(response.body.street2);
					$("#bzipcode").html(response.body.zipCode);
					$("#bphone").html(response.body.phone);
					$("#bfax").html(response.body.fax);

					$("#con1").html(response.body.country1);
					$("#bstate1").html(response.body.states1);
					$("#bcity1").html(response.body.city1);
					$("#bstreet11").html(response.body.street11);
					$("#bstreet21").html(response.body.street21);
					$("#bzipcode1").html(response.body.zipCode1);
					$("#bphone1").html(response.body.phone1);
					$("#bfax1").html(response.body.fax1);

				}
			}
		});
	}
	function hideShowS() {
		var taxType1 = $("#taxType").val();
		if (taxType1 == 'true') {
			$('#igstTR').hide();
			$('#cgstTR').show();
			$('#sgstTR').show();
		} else {
			$('#igstTR').show();
			$('#cgstTR').hide();
			$('#sgstTR').hide();
		}
	}
	function getReferenceList(vendorId, rid) {
		$('.loader').show();
		if (vendorId) {
			var option = $("<option></option>");
			$(option).val(null);
			$(option).html("Select");
			$.ajax({
				type : "GET",
				url : "manage-purchase-order-getReferenceList?id=" + vendorId,
				success : function(response) {
					if (response.message == "success") {
						$('.loader').hide();
						$("#reference").empty();
						var option = $("<option></option>");
						$(option).val(null);
						$(option).html("Select");
						$("#reference").append(option);
						for (var i = 0; i < response.body.length; i++) {
							var option = $("<option></option>");
							$(option).val(response.body[i].key);
							$(option).html(response.body[i].key);
							$("#reference").append(option);
						}
						if (rid != "" || rid != null || rid != "null") {
							$("#reference").val(rid);
						}
					}
				},
				error : function(e) {
					$('.loader').hide();}
			});
		} else {
			$('.loader').hide();
			$("#reference").empty();
			var option = $("<option></option>");
			$(option).val(null);
			$(option).html("salesOrderIdd");
			$("#reference").append(option);
			$("#reference").empty();
			var option = $("<option></option>");
			$(option).val(null);
			$(option).html("Select");
		}
	}
	function openModal(id) {
		if (id == 0) {
			$("#organatioModal").show();
			$("#customerModal").hide();
		} else if (id == 1) {
			$("#customerModal").show();
			$("#organatioModal").hide();
		} else {
			$("#customerModal").hide();
			$("#organatioModal").hide();
		}

	}
	function deleteItem() {

		$('#deleteProduct').modal('show');
	}
	function cancelModalProductBtn() {

		$("#deleteModalBtn").removeAttr("disabled");
		$('#deleteProduct').modal('hide');
	}
	function openNav() {
		
		//$('#disDiv1').show();
		$("#sku").val("");
		$("#itemName").val("");
		$("#quantity").val("");
		$("#unitPrice").val("");
		$("#discount").val("");
		$("#gstRate").val("");
		$("#lineTotal").val("");
		$("#hsnCode").val("");
		$("#unit").val("");
		$("#editProduct").val("");
		//$("#suggesstion-box_").hide();
		var vendorValid = true;
		if ($("#vendorName").val() == null || $("#vendorName").val() == "") {
			vendorValid = false;
		}
		if (vendorValid) {
			document.getElementById("mySidenav").style.cssText = "width:35%; position: absolute; right:-10px; overflow: hidden; height:auto; top:523px;";
			document.getElementById("main_content").style.width = "65%";
		} else {
			$("#messageParagraph").text("First Choose Vendor Name");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
		}
	}

	function closeNav() {
		document.getElementById("mySidenav").style.width = "0";
		document.getElementById("main_content").style.width = "100%";
		$('.formValidation').remove();
		$("#sku").val('');
		$("#itemId").val('');
		$("#itemName").val('');
		$("#quantity").val('');
		$("#unitPrice").val('');
		$("#discount").val('');
		$("#gstRate").val('');
		$("#lineTotal").val('');
		$("#hsnCode").val('');
		$("#unit").val('');
		$("#editProduct").val(null);

	}
	function editProduct(slNo) {
		$(".formValidation").remove();
		var status = $("#approveStatusField").val();
		if (status == '1') {
			return false;
		}
		var quotationId = $("#quotationhedId").html();
		var rowNode = itemOptions.api.getRowNode(slNo);

		//console.log(rowNode)
		openNav();
		$("#editProduct").val(slNo);
		$("#sku").val(rowNode.data.sku);
		$("#itemId").val(rowNode.data.itemId);
		$("#itemIdTemp").val(rowNode.data.itemId);
		$("#itemName").val(rowNode.data.itemName);
		$("#hsnCode").val(rowNode.data.hsnCode);
		$("#unit").val(rowNode.data.unit);
		$("#quantity").val(rowNode.data.quantity);
		$("#unitPrice").val(rowNode.data.unitPrice);
		$("#gstRate").val(rowNode.data.gstRate);
		$("#discount").val(rowNode.data.discount);
		$("#lineTotal").val(rowNode.data.lineTotal);
		$("#itemIgst").val(rowNode.data.itemIgst);
		$("#itemCgst").val(rowNode.data.itemCgst);
		$("#itemSgst").val(rowNode.data.itemSgst);
		$("#pendingQty").val(rowNode.data.pendingQty);
		$("#skuTemp").val(rowNode.data.sku);

	}

	var totalLine;
	function calculateLineTotal() {
		var price = $("#unitPrice").val();
		var quantity = $("#quantity").val();
		var discount = $("#discount").val();
		var discountAmount = $("#discountAmount").val();

		if (discountAmount == '1') {
			if (price && quantity) {
				var mul = price * quantity;

				if (discount > mul) {

					$("#discount").val("0");
					totalLine = mul - discount;
					$("#lineTotal").val((mul).toFixed(2));
				} else {
					totalLine = mul - discount;
					$("#lineTotal").val((totalLine).toFixed(2));
				}

			} else {
				var mul = 0;
				$("#lineTotal").val((mul).toFixed(2));

			}
		} else {
			if (price && quantity) {
				var mul = price * quantity;
				if (discount > mul) {

					$("#discount").val("0");
					totalLine1 = (mul / 100) * discount;
					totalLine = mul - totalLine1;
					$("#lineTotal").val((mul).toFixed(2));
				} else {
					totalLine1 = (mul / 100) * discount;
					totalLine = mul - totalLine1;
					$("#lineTotal").val((totalLine).toFixed(2));
				}

			} else {
				var mul = 0;
				$("#lineTotal").val((mul).toFixed(2));

			}
		}

	}

	/* //quotation item  table add */

	function saveTableData() {
		var editProduct = $("#editProduct").val();
		var item = {};
		var data = 1;
		var validation = true;

		if (item.itemName == null || item.itemName == "") {
			validation = validationUpdated("Item Name Required", 'itemName');
		}
		if (item.quantity == null || item.quantity == "") {
			validation = validationUpdated("Quantity Required", 'quantity');
		}
		if (item.unitPrice == null || item.unitPrice == "") {
			validation = validationUpdated("Unit Price Required", 'unitPrice');

		}

		if (item.gstRate == null || item.gstRate == "") {
			validation = validationUpdated("GST Rate Required", 'gstRate');
		}
		if (item.lineTotal == null || item.lineTotal == "") {
			validation = validationUpdated("Line Total Required", 'lineTotal');
		}

		if (validation) {
			item.slNo = data;
			itemOptions.api.forEachNode(function(rowNode, index) {
				if (!editProduct) {
					data = data + 1;
					item.slNo = data;
				} else {
					item.slNo = editProduct;
				}

			});

			item.itemId = $('#itemIdTemp').val();
			item.sku = $('#skuTemp').val();
			item.itemName = $('#itemName').val();
			item.itemId = $('#itemIdTemp').val();
			item.hsnCode = $('#hsnCode').val();
			item.unit = $('#unit').val();
			item.unitName = $("#unit option:selected").text();
			item.quantity = $('#quantity').val();
			item.unitPrice = $('#unitPrice').val();
			item.discount = $('#discount').val();
			item.gstRate = $('#gstRate').val();
			item.lineTotal = $('#lineTotal').val();
			item.pendingQty = $('#pendingQty').val();
			var taxType1 = $("#taxType").val();
			if (taxType1 == 'true') {
				item.itemCgst = (item.lineTotal * item.gstRate) / 200;
				item.itemSgst = (item.lineTotal * item.gstRate) / 200;
				item.itemIgst = 0;
				item.taxableAmt = parseFloat(item.lineTotal) + item.itemCgst
						+ item.itemSgst;
			} else {
				item.itemCgst = 0;
				item.itemSgst = 0;
				item.itemIgst = (item.lineTotal * item.gstRate) / 100;
				item.taxableAmt = parseFloat(item.lineTotal) + item.itemIgst;
			}

			//item.slNo = data;
			var quot = [];

			if (editProduct) {
				var rowNode = itemOptions.api.getRowNode(editProduct);
				rowNode.setData(item);
			} else {
				itemOptions.api.forEachNode(function(rowNode, index) {
					quot.push(rowNode.data);
				});
				quot.push(item)
				itemOptions.api.setRowData(quot);

				//	quot.push(item)
				//itemOptions.api.setRowData(quot);
				var sum = 0.0;
				var gstRate = 0.0;
				var qSGST = 0.0;
				var qCGST = 0.0;
				var qIGST = 0.0;
				var itemIgst = 0.0;
				var itemCgst = 0.0;
				var itemSgst = 0.0;
				var len = quot.length;
				for (var i = 0; i < len; i++) {
					sum = sum + parseFloat(quot[i].lineTotal);
					if (taxType1 == 'false') {
						quot[i].itemIgst = quot[i].lineTotal * quot[i].gstRate
								/ 100;
						qIGST = qIGST + quot[i].itemIgst;
						grandTotal = sum + qIGST;
					} else {
						quot[i].itemCgst = quot[i].lineTotal * quot[i].gstRate
								/ 200;
						quot[i].itemSgst = quot[i].lineTotal * quot[i].gstRate
								/ 200;

						qCGST = qCGST + quot[i].itemCgst;
						qSGST = qSGST + quot[i].itemSgst;
						grandTotal = sum + qCGST + qSGST;
					}
				}
				$("#subTotal").val(sum);
				$("#qIGST").val(qIGST);
				$("#qCGST").val(qCGST);
				$("#qSGST").val(qSGST);
				$("#grandTotal").val(grandTotal)
			}
			priceCalculation()
			closeNav();
			$("#sku").val('');
			$("#itemId").val('');
			$("#itemName").val('');
			$("#quantity").val('');
			$("#unitPrice").val('');
			$("#discount").val('');
			$("#gstRate").val('');
			$("#lineTotal").val('');
			$("#hsnCode").val('');
			$("#unit").val('');

			$("#editProduct").val(null);
		}

	}

	function priceCalculation() {
		var grid = [];
		itemOptions.api.forEachNode(function(rowNode, index) {

			grid.push(rowNode.data);
		});
		var len = grid.length;
		var val = 0;
		var val2 = 0;
		var val3 = 0;
		var val4 = 0;

		var taxType1 = $("#taxType").val();
		for (i = 0; i < len; i++) {
			if (taxType1 == 'true') {
				val2 = parseFloat(val2) + parseFloat(grid[i].itemSgst);
				val3 = parseFloat(val3) + parseFloat(grid[i].itemCgst);

			} else {
				//val2 = parseFloat(val2) + parseFloat(grid[i].itemSgst);
				//val3 = parseFloat(val3) + parseFloat(grid[i].itemCgst);
				val4 = parseFloat(val4) + parseFloat(grid[i].itemIgst);

			}

			val = parseFloat(val) + parseFloat(grid[i].lineTotal);
		}
		tcsCalculation();
		calculateAdjustment();

		var adj = 0.0;
		var tcsval = 0.0;
		adj = $("#adjustment").val();

		var tcs = $('#tcsName').val();
		if (tcs != '') {
			var tcsval = tcs.replace(/[^0-9]/g, '');
		}
		//var tcsval = 0.0;
		var tcsAmount = 0.0;
		tcsAmount = val * parseFloat(tcsval) / 100;
		$("#subTotal").val(val);
		$("#qIGST").val(val4);
		$("#qCGST").val(val3);
		$("#qSGST").val(val2);
		var gTotal = 0.0;

		gTotal = parseFloat(val) + parseFloat(val2) + parseFloat(val3)
				+ parseFloat(val4) + parseFloat(adj) + parseFloat(tcsAmount);

		$("#grandTotal").val(gTotal.toFixed(2))
		$("#tcsAmount").val(tcsAmount.toFixed(2))

	}

	function calculateAdjustment() {
		//var adjustment = $("#adjustment").val();

		if (/^\d+$/.test($("#adjustment").val())
				|| $("#adjustment").val() == '-'
				|| $("#adjustment").val() == ''
				|| /^\-?\d+((\.|\,)\d+)?$/.test($("#adjustment").val())) {
			var adjustment = $("#adjustment").val();
		} else {
			$("#adjustment").val(0);
		}

		var subTotal = $("#subTotal").val();
		var qSGST = $("#qSGST").val();
		var qCGST = $("#qCGST").val();
		var qIGST = $("#qIGST").val();
		var tcsAmount1 = $("#tcsAmount").val();
		var tcsAmount = 0;
		if (tcsAmount1 != '' && tcsAmount1 != null) {
			tcsAmount = tcsAmount1;
		}
		var grandTotal = parseFloat(subTotal) + parseFloat(qSGST)
				+ parseFloat(qCGST) + parseFloat(qIGST) + parseFloat(tcsAmount);

		var add = 0;

		if (/^\-?\d+((\.|\,)\d+)?$/.test(adjustment)) {

			add = parseFloat(adjustment) + parseFloat(grandTotal);

			$("#grandTotal").val((add).toFixed(2));

		} else {

			$("#grandTotal").val((grandTotal).toFixed(2));

		}

	}	
	// tcs calculation

	function tcsCalculation() {

		var tcsValue = $("#tcsValue").val();
		var subTotal = $("#subTotal").val();
		var grandTotal2 = $("#grandTotal").val();

		var qSGST = $("#qSGST").val();
		if (qSGST == "" || qSGST == null || qSGST == "null") {
			qSGST = 0;
			$("#qSGST").val(qSGST);
		}
		var qCGST = $("#qCGST").val();
		if (qCGST == "" || qCGST == null || qCGST == "null") {
			qCGST = 0;
			$("#qCGST").val(qCGST);
		}
		var qIGST = $("#qIGST").val();
		if (qIGST == "" || qIGST == null || qIGST == "null") {
			qIGST = 0;
			$("#qIGST").val(qIGST);
		}

		var tcsAmount = $("#tcsAmount").val();
		if (tcsAmount == "" || tcsAmount == null || tcsAmount == "null") {
			tcsAmount = 0;
			$("#tcsAmount").val(tcsAmount);
		}
		var grandTotal = $("#grandTotal").val();
		if (grandTotal == "" || grandTotal == null || grandTotal == "null") {
			grandTotal = 0;
			$("#grandTotal").val(grandTotal);
		}

		var totVal = parseFloat(subTotal) + parseFloat(qSGST)
				+ parseFloat(qCGST) + parseFloat(qIGST);

		if (tcsValue) {

			var tcs = (parseFloat(subTotal) * parseFloat(tcsValue)) / 100;
			var add = parseFloat(tcs) + parseFloat(totVal);
			$("#grandTotal").val((add).toFixed(2));
			$("#tcsAmount").val((tcs).toFixed(2));
		} else {

			var add = 0;
			$("#grandTotal").val((totVal).toFixed(2));
		}

	}

	var tcs = 0;
	function tcsBlank() {
		var tcsValue = $("#tcsValue").val();
		var tcsName = $("#tcsName").val();
		var gt = $("#grandTotal").val();
		var tcsAmount = $("#tcsAmount").val();

		if (tcsName == '') {
			$("#tcsValue").val('');
			$("#tcsId").val('');
			tcsCalculation()
			$("#tcsAmount").val(tcs);
		}

	}
	//TCS auto search

	function getTCSList() {
		$('.loader').show();
		var search = $("#tcsName").val();
		if (search) {
			$
					.ajax({
						type : "POST",
						url : "manage-purchase-order-get-tcs-list",
						dataType : 'json',
						contentType : 'application/json',
						data : search,
						success : function(response) {
							if (response.message == "success") {
								$('.loader').hide();
								console.log("response data"
										+ JSON.stringify(response))
								if (response.body.length != 0) {
									$("#search").css("background", "#FFF");
									var content = '<ul id="autocomplete-list1" >';
									for (var i = 0; i < response.body.length; i++) {
										content += '<li style="margin-left:-30px; font-weight:100; font-size:14px; color:#ccc;     background-color: #0909e4;" class="autocompletedata cp" onClick="selectAutocompleteValue3(\''
												+ response.body[i].tcsId
												+ '\',\''
												+ response.body[i].taxName
												+ '\',\''
												+ response.body[i].rateId
												+ '\',\''
												+ response.body[i].taxType
												+ '\')">'
												+ response.body[i].taxName
												+ '</li>';
									}
									content += '<li style="margin-left:-30px;"  onclick="AddTCS();"><a class="addCust" href="#">Manage TCS</a>'
											+ '</li>';
									content += '</ul>';
									//console.log("content " + content)
									$("#suggesstion-box3_").show();
									$("#suggesstion-box3_").html(content);

								} else {
									$('.loader').hide();
									$("#search").css("background", "#FFF");
									var content = '<ul id="autocomplete-list1">';
									content += '<li style="margin-left:-30px; font-weight:100; font-size:14px; color:#ccc;     background-color: #0909e4;" onClick="selectAutocompleteValuee1()">'
											+ "No Data Found" + '</li>';
									content += '<li style="margin-left:-30px;"  onclick="AddTCS();"><a class="addCust" href="#">Manage TCS</a>'
											+ '</li>';
									content += '</ul>';
									$("#suggesstion-box3_").show();
									$("#suggesstion-box3_").html(content);
								}
							}
						},
						error : function(data) {
							console.log(data);
							$('.loader').hide();}
					})
		} else {
			$('.loader').hide();
			$("#suggesstion-box3_").hide();
		}

	}

	function selectAutocompleteValuee1() {

		$("#tcsId").val("");

		$("#tcsName").val("");
		$("#custGSTNoo1").val("");
		$("#taxTypee1").val("");
		$("#search").val("");
		$("#search").attr('data-procat', "");
		$("#suggesstion-box3_").hide();

	}

	function selectAutocompleteValue3(tcsId, taxName, rateId, taxType) {

		$("#tcsId").val(tcsId);
		$("#tcsName").val(taxName);
		$("#tcsValue").val(rateId);
		$("#search").val(taxName);
		$("#search").attr('data-procat', tcsId);
		$("#suggesstion-box3_").hide();
		tcsCalculation();

	}
	function AddTCS() {

		$('#manageTCsModel').modal('show');
		$("#collection").val('');
		$("#rateId").val('');
		$("#taxName").val('');

	}
	function deleteProductOnclick() {
		var selectedRows = itemOptions.api.getSelectedRows();
		itemOptions.api.applyTransaction({
			remove : selectedRows

		});
		cancelModalProductBtn();
		//DELETE GST,SUBTOTAL,GRANDTOTAL,SGST,CGST,IGST
		var sum = $("#subTotal").val();
		var gstRate = $("#gstRate").val();
		var qCGST = $("#qCGST").val();
		var qSGST = $("#qSGST").val();

		var qIGST = $("#qIGST").val();
		var grandTotal = $("#grandTotal").val();
		var itemIgst = $("#itemIgst").val();
		var itemCgst = $("#itemCgst").val();
		var itemSgst = $("#itemSgst").val();
		var len = selectedRows.length;
		for (var i = 0; i < len; i++) {

			sum = sum - selectedRows[i].lineTotal;
			var taxType = $("#taxType").val()
			if (taxType == "true") {

				selectedRows[i].itemIgst = selectedRows[i].lineTotal
						* selectedRows[i].gstRate / 100;
				qIGST = qIGST - selectedRows[i].itemIgst;
				qCGST = qCGST - selectedRows[i].itemCgst;
				qSGST = qSGST - selectedRows[i].itemSgst;
				grandTotal = sum + qIGST;

			} else {

				selectedRows[i].itemIgst = selectedRows[i].lineTotal
						* selectedRows[i].gstRate / 100;
				qIGST = qIGST - selectedRows[i].itemIgst;
				qCGST = qCGST - selectedRows[i].itemCgst;
				qSGST = qSGST - selectedRows[i].itemSgst;
				grandTotal = sum + qIGST;
/* 
				selectedRows[i].itemCgst = selectedRows[i].lineTotal
						* selectedRows[i].gstRate / 200;
				selectedRows[i].itemSgst = selectedRows[i].lineTotal
						* selectedRows[i].gstRate / 200;
				alert(selectedRows[i].itemCgst)
				alert(selectedRows[i].itemCgst)

				qCGST = qCGST - selectedRows[i].itemCgst;
				qSGST = qSGST - selectedRows[i].itemSgst;
				grandTotal = sum + qCGST + qSGST; */

			}

		}

		$("#itemIgst").val(itemIgst);
		$("#itemCgst").val(itemCgst);
		$("#itemSgst").val(itemSgst);
		$("#subTotal").val(sum);
		$("#qIGST").val(qIGST);
		$("#qCGST").val(qCGST);
		$("#qSGST").val(qSGST);
		$("#grandTotal").val(grandTotal)
	}
	function addtcsInfo1() {
		$('.loader').show();
		var obj = {};
		var Id = $("#tcsId").val();

		obj.salespersonId = $("#tcsId").val();
		obj.collection = $("#collection").val();
		obj.rateId = $("#rateId").val();
		obj.taxName = $("#taxName").val();

		var validation = true;
		if (obj.collection == null || obj.collection == "") {
			validation = validationUpdated("Select Collection", "collection");
		}

		if (obj.rateId == null || obj.rateId == "") {
			validation = validationUpdated("Enter Rate", "rateId");
		}
		if (obj.taxName == null || obj.taxName == "") {
			validation = validationUpdated("Enter Tax Name", "taxName");
		}

		$.ajax({
			type : "POST",
			url : "manage-purchase-order-add-tcs",
			contentType : "application/json",
			data : JSON.stringify(obj),
			success : function(response) {
				if (response.message == "Success") {
					$('.loader').hide();
					//getSalessPersonList();
					$("#messageParagraph").text("Data Saved Successfully");
					$("#msgOkModal").removeClass("btn3");
					$("#msgOkModal").addClass("btn1");
					$("#msgModal").modal('show');

					$('#manageTCsModel').modal('hide');

				}
			},
			error : function(data) {
				$('.loader').hide();}
		})

	}

	function checkEmpty() {
		var infofileName = true;
		$(".formValidation").remove();
		$('.docNoclss').each(function() {
			if ($(this).val() == null || $(this).val() == "") {
				infofileName = false;
				validationModal("Document Name Required", $(this).attr('id'));
			}
		});

		var mulDocInfo = true;
		if (infofileName) {
			$('#doctbodyData > tr').each(function() {
				if ($(this).closest('tr').find('.imageName').text()) {
					mulDocInfo = true;
				} else {
					mulDocInfo = false;
					$("#messageParagraph").text("Please Choose a File ");
					$("#msgOkModal").removeClass("btn3");
					$("#msgOkModal").addClass("btn1");
					$("#msgModal").modal('show');
					return false;
				}

			});
		}
		if (infofileName && mulDocInfo) {
			addMore1()
		}
	}
	function check1(fieldId) {
		var tempVal = $("#" + fieldId).val().replace(/[^0-9 ]/g, '');
		$("#" + fieldId).val(tempVal);
	}
	/*
	image upload fn
	 */

	function saveFile() {

		var uFile = $('#fileUpload')[0].files[0];
		var fileName = $('#fileUpload').val();
		var iURL = URL.createObjectURL(uFile);
		var LightImg = "<div class='uploadicon position-l'><a class='example-image-link' href='" + iURL + "' title='" + fileName + "' target='_balnk'><i class='fa fa-picture-o'></i></a></div>";
		$("#uploadedBillDiv_").html(LightImg);
		var lastIndex = fileName.lastIndexOf("\\");
		if (lastIndex >= 0) {
			fileName = fileName.substring(lastIndex + 1);
		}
		var iURL = URL.createObjectURL(uFile);

		$('#imgLoc').attr('src', '');
		$('#imgLoc').attr('src', iURL);

		var fileData = new FormData();
		fileData.append('file', uFile);
		fileData.append('path', 'none');

		$.ajax({
			type : "POST",
			url : "manage-purchase-order-upload-file",
			enctype : "multipart/form-data",
			contentType : false,
			data : fileData,
			processData : false,
			cache : false,
			success : function(response) {

			},
			error : function(e) {

			}
		});
	}

	function showDisplay() {
		var title = $('#companyName').val();

		$('#vendorDisplayName').val(title);
	}

	function tcscancelBtn() {
		$('#manageTCsModel').modal('hide');
		$("#collection").val('');
		$("#taxName").val('');
		$("#rateId").val('');
	}

	function saveFile1(event) {
		var uFile = $(uploadDoc_0)[0].files[0];
		var fileName = event.currentTarget.value;
		var lastIndex = fileName.lastIndexOf("\\");
		if (lastIndex >= 0) {
			fileName = fileName.substring(lastIndex + 1);
		}
		var extension = fileName.split(".");
		var iURL = URL.createObjectURL(uFile);
		$("#uploadedBillDiv_0").html("");

		if (extension[1] == "jpg" || extension[1] == "png"
				|| extension[1] == "jpeg") {
			var LightImg = "<div class='uploadicon position-l'><a class='example-image-link' href='" + iURL + "' title='" + fileName + "' target='_balnk'><i class='fa fa-picture-o' style='color: blue'></i></a></div>";
		} else if (extension[1] == "pdf") {
			var LightImg = "<div class='uploadicon position-l'><a class='example-image-link' href='" + iURL + "' title='" + fileName + "' target='_balnk'><i class='fa fa-file-pdf-o' style='color: red'></i></a></div>";
		} else {
			var LightImg = "<div class='uploadicon position-l'> </div>";
		}
		$("#uploadedBillDiv_0").html(LightImg);
		$("#imageName_0").html(fileName);
		var fileData = new FormData();
		fileData.append('file', uFile);
		fileData.append('path', 'none');
		$.ajax({
			type : "POST",
			url : "manage-purchase-order-upload-file1",
			enctype : "multipart/form-data",
			contentType : false,
			data : fileData,
			processData : false,
			cache : false,
			success : function(response) {
			},
			error : function(e) {

			}
		});
	}

	function selectCheckBox(id, lvl) {

		$("#select_product").empty();
		getProductByCategory();

		if (lvl == 'L1') {
			var textDesc = $("#lbl_" + id).text();
			$("#catDesc").text(textDesc);
		} else {
			var res = lvl.substring(1, 1000000);

			var lastText = $("#lbl_" + id).text();
			var textDesc = "";
			for (i = res; i > 1; i--) {
				var pUL = $("#lbl_" + id).parents("ul").attr("id");
				pUL = pUL.substring(3, 10000000000000);
				var newText = $("#lbl_" + pUL).text();
				textDesc = newText + " > " + textDesc;
				id = pUL;
			}
			textDesc = textDesc + lastText;
			$("#catDesc").text(textDesc);
		}
	}

	function selectProductVal() {
		$("#itemName").val($("#itemNameTemp").val());
		$("#itemId").val($("#itemIdTemp").val());
		$("#brandName").val($("#brandNameTemp").val());
		$("#brandId").val($("#brandIdTemp").val());
		$("#category").val($("#prodCatIdTemp").val());
		$("#categoryName").val($("#prodCatNameTemp").val());
		$("#sku").val($("#skuTemp").val());
		$("#hsnCode").val($("#hsnCodeTemp").val());
		$("#unit").val($("#unitTemp").val());
		$("#search").val($("#itemNameTemp").val())
		$("#select_product").html('');
		$('#myModal').modal('hide');
		$("#gstRate").val($("#gstRateTemp").val());
	}
	function getProductByCategory() {
		$('.loader').show();
		$("#select_product").empty();
		var valor = "";
		$('input.pc1-box[type=checkbox]').each(function() {
			if (this.checked)
				valor = valor + $(this).val() + ",";
		});

		if (valor) {
			$("#select_product").empty();
			$
					.ajax({
						type : "POST",
						url : "manage-purchase-order-item-product-by-cat",
						dataType : 'json',
						contentType : 'application/json',
						data : valor,
						success : function(response) {
							if (response.message == "success") {
								$('.loader').hide();
								console.log(response.body)
								$("#select_product").empty();
								var content = '';
								for (var i = 0; i < response.body.length; i++) {

									content += '<div class="autocompletedata cp product-item" id="'
											+ response.body[i].productId
											+ "_"
											+ response.body[i].sku
											+ '" onClick=selectActive("'
											+ response.body[i].productId
											+ "_"
											+ response.body[i].sku
											+ '","'
											+ response.body[i].sku
											+ '","'
											+ response.body[i].productId
											+ '","'
											+ window
													.btoa(response.body[i].productName)
											+ '","'
											+ window
													.btoa(response.body[i].brandId)
											+ '","'
											+ window
													.btoa(response.body[i].brandName)
											+ '","'
											+ window
													.btoa(response.body[i].productCatId)
											+ '","'
											+ window
													.btoa(response.body[i].productCatName)
											+ '","'
											+ window
													.btoa(response.body[i].hsnCode)
											+ '","'
											+ window
													.btoa(response.body[i].unit)
											+ '","'
											+ window
													.btoa(response.body[i].gstRate)
											+ '")>'
											+ response.body[i].sku
											+ " - "
											+ response.body[i].brandName
											+ " - "
											+ response.body[i].productName
											+ '</div>';
								}
								content += '</ul>';
								$("#select_product").show();
								$("#select_product").append(content);

								var itemId = $("#itemId").val();
								var skuId = $("#sku").html();

								if (itemId) {
									$("#" + itemId + "_" + skuId).addClass(
											'productActive');
								}

							}
						},
						error : function(data) {
							$('.loader').hide();
						}
					})
		} else {
			$('.loader').hide();
			$("#itemName").val(null);
			$("#hsnCode").val(null);
			$("#unit").val(null);
			$("#itemId").val(null);
			$("#select_product").empty();
		}
	}

	function selectActive(id, sku, productId, productName, brandId, brandName,
			prodCatId, prodCatName, hsnCode, unit, gstRate) {

		$('.autocompletedata ').removeClass('productActive');
		$("#" + id).addClass('productActive');
		$("#itemNameTemp").val(window.atob(productName));
		$("#itemIdTemp").val(productId);
		$("#brandNameTemp").val(window.atob(brandName));
		$("#brandIdTemp").val(window.atob(brandId));
		$("#skuTemp").val(sku);
		$("#gstRateTemp").val(window.atob(gstRate));
		$("#prodCatIdTemp").val(window.atob(prodCatId));
		$("#prodCatNameTemp").val(window.atob(prodCatName));
		$("#searchTemp").val(window.atob(productName))
		$("#hsnCodeTemp").val(window.atob(hsnCode));
		$("#unitTemp").val(window.atob(unit));

	}
	
	function closeModal1() {
		$("#myModal").modal('hide');
	}
	/* //po  table add */

	function save() {
		if (validFormData() && validProductData()) {
			var datas = [];
			var imageValid = true;
			var uploadList = [];
			$("#doctbodyData > tr").each(

					function() {
						var uFile = $(this).find(".document")[0].files[0];
						var fileName = $(this).find(".document").val();
						var data = [];
						var x = [];
						if (fileName != '' && fileName != 'undefined'
								&& fileName != null) {
							var lastIndex = fileName.lastIndexOf("\\");
							if (lastIndex >= 0) {
								fileName = fileName.substring(lastIndex + 1);
							}
							var reader = new FileReader();
							reader.readAsDataURL(uFile);

							reader.onload = function() {
								data = reader.result.split(",");
								x.push(data[1]);
							};
						} else {
							if ($("#poId").val()) {
								fileName = $(this).find(".uploadHidCls").val();
							} else {
								x = [];
							}

						}
						uploadData = {};
						uploadData['poId'] = $("#poId").val();
						uploadData['documnentName'] = $(this)
								.find(".docNoclss").val();
						uploadData['documentFile'] = x;
						uploadData['fileName'] = fileName;
						uploadData['imageNameEdit'] = $(this).find(
								".uploadHidCls").val();
						if($(this).find(".docNoclss").val()!="" && $(this).find(".docNoclss").val()!='null' && fileName!="" && fileName!="null"){
							uploadList.push(uploadData);
							console.log(uploadData)
							
						}

					});
			setTimeout(function() {

				itemOptions.api.forEachNode(function(rowNode, indrx) {

					var obj = rowNode.data;
					obj.poId = $("#pohedId").html();
					obj.quotationId = '';
					obj.vendorId = $("#vendorId").val();
					obj.vendorName = $("#vendorName").val();
					obj.reference = '';
					obj.terms = $("#terms").val();
					obj.adjustment = $("#adjustment").val();
					obj.tcs = $("#tcsId").val();
					obj.tcsAmount = $("#tcsAmount").val();
					obj.qutValidDate = $("#qutValidDate").val();
					obj.qutDescription = $("#qutDescription").val();
					obj.subTotal = $("#subTotal").val();
					obj.grandTotal = $("#grandTotal").val();
					obj.paymentTermId = $("#paymentTermId").val();
					obj.carrierId = $("#carrierId").val();
					obj.taxType = $('#taxType').val();
					obj.qIGST = $('#qIGST').val();
					obj.qCGST = $('#qCGST').val();
					obj.qSGST = $('#qSGST').val();

					obj.taxType = $('#taxType').val();

					obj.shippingDetails = $("input[name='checkbox']:checked")
							.val();
					
					obj.orgDetails = $('#organizationName').val();
					obj.custDetails = $('#customerName').val();
					obj.documentList = uploadList;

					console.log('Object', obj)
					datas.push(obj);

				});

				saveAllPo(datas);

			}, 1000)

		}
	}

	function saveAllPo(datas) {
		//	window.location.reload();

		$('.loader').show();
		$("body").addClass("overlay");

		$.ajax({
			type : "POST",
			url : "view-req-rwMaterial-add",
			contentType : "application/json",
			data : JSON.stringify(datas),
			success : function(response) {
				if (response.message == "Success") {
					$('.loader').hide();
					$("body").removeClass("overlay");
					console.log(response.message)
					console.log('Data', JSON.stringify(datas))

					$("#messageParagraph").text("Data Saved Successfully");
					$("#msgOkModal").removeClass("btn3");
					$("#msgOkModal").addClass("btn1");
					$("#msgModal").modal('show');

					$(".btn-hs").show();
					
					agGrid.simpleHttpRequest({
						url : "view-req-rwMaterial-ItemDtls-through-ajax"
					}).then(function(data) {
						var jsonData = JSON.parse(data.body);
						var allData = jsonData.ProductItemData;
						var len = allData.length;
						$('#totalCandidate').find('span').html(len);
						gridOptions.api.setRowData(allData);
					});
					Cancel();
				}

			},
			error : function(datas) {
				console.log(datas)
			}
		})

	}

	function validFormData() {
		var allValid = true;

		if (!validationUpdated("Vendor Name Required", 'vendorName'))
			allValid = false;
		if (!validationUpdated("Expected Delivery Date Required",
				'qutValidDate'))
			allValid = false;
		if (!validationUpdated("Vendor Notes Required", 'qutDescription'))
			allValid = false;
		return allValid;
	}

	function validProductData() {
		var item = null;
		itemOptions.api.forEachNode(function(rowNode, index) {
			item = item + rowNode.data;
		});
		if (item) {
			return true;
		} else {
			$("#messageParagraph").text("Please Add Item Details");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
			return false;
		}
	}	
	
	function editPlan(planid,approveStatus,weekName) {
		$('.loader').show();
		 $("#myGrid").hide();
		 $("#demo").show();
		   if(approveStatus=="Approved"){
	        	 $("#save").hide(); 
	        	 $("#newchild").hide(); 
	        	 $("#deleteChild").hide(); 
	        	 $("#save1").hide(); 
	         }else{
	        	 $("#save").show(); 
	        	 $("#newchild").show(); 
	        	 $("#deleteChild").show(); 
	        	 $("#save1").show(); 
	         }
		   $("#searchRowDiv").hide();
		    $("#total").hide();
		    $("#total1").show();
		    $("#dwnld").hide();
		   $('#pOrder').attr("disabled", true);
		   $('.loader').show();
			$("body").addClass("overlay"); 
		agGrid.simpleHttpRequest(
				{
					url : 'view-req-rwMaterial-plan-edit?id='+ planid
				}).then(function(data) {
					var jsonData = JSON.parse(data.body[0]);
					console.log(jsonData)
					var allData=jsonData.ProductItemData;
					var len = allData.length;
					$('#totalRmPm').find('span').html(len);
					$('.loader').hide();
					$("body").removeClass("overlay");
		 			$("#planId").val(planid);
					$("#trReqId").text(planid);
					$("#week").text(allData[0].week_name);
					$("#year").val(allData[0].year);
					$("#description").val(allData[0].description);
					
					
					activityOptions.api.setRowData(allData);
					$("#tdiv").hide();
					$("#searchRowDiv").hide();
					$("#totalReq").hide();
					$("#ttbtn").hide(); 
					$('.loader').hide();
				});
	}	
	function downloadDetails() {
		var dataset = [];
		gridOptions.api.forEachNodeAfterFilterAndSort(function(rowNode, index) {
			dataset.push(rowNode.data);
		});
		gridOptions.api.exportDataAsCsv(dataset);
	}
	function downloadRMPMDetails() {
		var dataset = [];
		activityOptions.api.forEachNodeAfterFilterAndSort(function(rowNode, index) {
			dataset.push(rowNode.data);
		});
		activityOptions.api.exportDataAsCsv(dataset);
	}
	function onQuickFilterChanged1() {
		$(".ti-search srchicon").hide();
		activityOptions.api
				.setQuickFilter(document.getElementById('quickFilter1').value);
	}

	function cancelBar1() {
		var id = document.getElementById("closeKey1");
		id.style.display = "block";

		if ($('#quickFilter1').val() == null || $('#quickFilter1').val() == "") {
			id.style.display = "none";
		}
	}
</script>
</head>

<body>
	<div layout:fragment="content" class="maincontent">
		<div class="container-fluid">
			<div class="row">
				<div class="maincontentsec">
					<div class="content_padding">

						<div class="d-flex justify-content-between" id="reqTable"
							style="display: none;">

							<div class="col-md-4 btn-hs" id="total">
								<div class="font-design" id="totalCandidate">
									Plan List(<span></span>)
								</div>
							</div>

							<div class="col-md-4 btn-hs" id="searchRowDiv">
								<div class="input-style">
									<input type="text" placeholder="Search.." name="search"
										class="searchboxinput" onkeyup="cancelBar()"
										oninput="onQuickFilterChanged()" id="quickFilter"
										autocomplete="off">
									<div class="searchicon">
										<a href="javascript:void(0)"><span
											style="display: none; border-right: 1px solid #ccc; padding-right: 5px;"
											id="closeKey"
											onclick="gridOptions.api.setQuickFilter(null);$('#quickFilter').val('');document.getElementById('closeKey').style.display='none';"
											class="close_i"><i class="ti-close srchicon"></i></span></a><a
											href="javascript:void(0)"><i class="ti-search srchicon"></i></a>
									</div>
								</div>
							</div>

							<div class="col-md-4 buttonsec btn-hs" id="btndiv">
								<button class="download-btn" id=dwnld
									onclick="downloadDetails()">Download</button>
								<!-- <button onclick="add()" class="new-btn" id="add">New</button> -->
								<!-- <button onclick="deleteQuotation()" class="delete-btn"
									id="delete">delete</button> -->

							</div>
						</div>

						<input type="hidden" id="sessionId" th:value="${userId}" /> <input
							type="hidden" id="sessionName" th:value="${userName}" /> <input
							type="hidden" id="hrRole" th:value="${hrRole}" /> <input
							type="hidden" id="sessionRole" th:value="${userRole}" /> <input
							type="hidden" id=cancelModalBtn() " adRole" th:value="${adRole}" />

						<div id="myGrid" style="height: 500px; width: 100%;"
							class="ag-theme-alpine"></div>



						<div class="collapse" id="demo">
							<div class="innercontent">
								<div class="innerstickybg">
									<div class="row">

										<div class="col-md-4">
											Plan Id: <span id="trReqId"></span>
										</div>
										<div class="col-md-4">
										    Week: <span id="week"></span>
										</div>

										<div class="col-md-4" align="right">
											<button class="cancel-btn" id="cancelBtn" onclick="cancel()">Cancel</button>
											<button class="approve-btn" id=pOrder onclick="poDetails()">Po</button>
											<button class="approve-btn" id="save"
												onclick="masterSaveData()">Save</button>
										</div>
									</div>
								</div>


								<div class="row mt-4">
											<div class="d-flex justify-content-between" id="reqTable"
							style="display: none;">

							<div class="col-md-4 btn-hs" id="total1">
								<div class="font-design" id="totalRmPm">
									RM & PM LIST (<span></span>)
								</div>
							</div>

							<div class="col-md-4 btn-hs" id="searchRowDiv">
								<div class="input-style">
									<input type="text" placeholder="Search.." name="search"
										class="searchboxinput" onkeyup="cancelBar1()"
										oninput="onQuickFilterChanged1()" id="quickFilter1"
										autocomplete="off">
									<div class="searchicon">
										<a href="javascript:void(0)"><span
											style="display: none; border-right: 1px solid #ccc; padding-right: 5px;"
											id="closeKey1"
											onclick="activityOptions.api.setQuickFilter(null);$('#quickFilter1').val('');document.getElementById('closeKey1').style.display='none';"
											class="close_i"><i class="ti-close srchicon"></i></span></a><a
											href="javascript:void(0)"><i class="ti-search srchicon"></i></a>
									</div>
								</div>
							</div>

							<div class="col-md-4 buttonsec btn-hs" id="btndiv">
								<button class="download-btn" id=dwnld
									onclick="downloadRMPMDetails()">Download</button>

							</div>
						</div>
									<div id="activity" style="width: 100%; height: 400px;"
										class="ag-theme-alpine"></div>
								</div>

							</div>

						</div>



						<div class="modal fade" id="purchaseModal">
							<div class="modal-dialog modal-lg"
								style="margin-top: 130px; height: 900px;">
								<div class="modal-content">

									<!-- 	Modal Header -->
									<div class="modal-header flex-column"></div>
									<!-- Modal body -->
									<div class="modal-body">


										<div class="innerstickybg" id="headingItem">
											<div class="row">

												<div class="col-md-4">
													Purchase Order ID: <span id="pohedId"></span>
												</div>
												<div class="col-md-4">
													<div id="statusDiv"></div>
												</div>
												<div class="col-md-4">
													<button class="cancel-btn" id="Cancel" onClick="CancelPo()">Close</button>
													<button class="approve-btn" id="save" onclick="save()">Save</button>
												</div>


											</div>
										</div>

										<div class="innercontent">


											<div class="row">
												<input type="hidden" id="poId">

												<div class="col-lg-4">

													<div class="form-group">
														<div class="autocomplete" style="width: 100%;">
															<label>Vendor Name</label> <input type="text"
																id="vendorName" placeholder="Search Here.."
																class="form-control" onkeyup='getVendorList()'><input
																type="hidden" id="vendorId"> <input
																type="hidden" id="custGSTNo"> <input
																type="hidden" id="taxType">
														</div>
														<div id="suggesstion-box1_" class="sugg-cls"></div>

													</div>
													<div class="row" id=addre>
														<div class="col-md-6">
															<span class="billtxt" id="billingAdd">Billing
																Address</span>
															<address class="font-small ember-view">
																<!-- 	<strong id="addNewAdd1" onclick="addnewAddress()"
																	style="color: blue; cursor: pointer;">Add New
																	Address</strong> -->


															</address>
															<div class="preserve-wrap1">
																<span id='con'></span><br> <span id='bstate'></span><br>
																<span id='bcity'></span><br> <span id='bstreet1'></span><br>
																<span id='bstreet2'></span><br> <span id='bzipcode'></span><br>
																<span id='bphone'></span><br> <span id='bfax'></span><br>
															</div>
														</div>
														<div class="col-md-6">
															<span class="billtxt" id="shippingAdd">Shipping
																Address</span>
															<address class="font-small ember-view">
																<!-- <strong id="addNewAdd" onclick="addnewAddress1()"
																	style="color: blue; cursor: pointer;">Add New
																	Address</strong> -->
															</address>
															<div class="preserve-wrap1">
																<span id='con1'></span><br> <span id='bstate1'></span><br>
																<span id='bcity1'></span><br> <span id='bstreet11'></span><br>
																<span id='bstreet21'></span><br> <span
																	id='bzipcode1'></span><br> <span id='bphone1'></span><br>
																<span id='bfax1'></span><br>

															</div>
														</div>
													</div>

												</div>


												<div class="col-lg-3">
													<div class="form-group">
														<label>Purchase Order Id</label><input type="text"
															id="purchageOrderReference" class="form-control" readonly>
													</div>
												</div>


												<div class="col-lg-2">
													<label>Po Date</label> <input type="text" id="purchaseDate"
														class="form-control" readonly>
												</div>
												<!-- <div class="col-lg-2">
									<div class="form-group calendar_box">
										<label>Po Date</label> <input type="text" id="purchaseDate"
											class="form-control"
											th:attr="onkeyup=|formatDate('purchaseDate','${session.DATEFORMAT_JS}')|">
										<i class="ti-calendar picker_calendar" id="toDateCalendarPo"></i>
									</div>
								</div> -->
												<input type="hidden" id="approveStatusField">
												<div class="col-lg-3">
													<div class="form-group calendar_box">
														<label>Expected Delivery Date</label> <input type="text"
															id="qutValidDate" class="form-control"
															th:attr="onkeyup=|formatDate('qutValidDate','${session.DATEFORMAT_JS}')|">
														<i class="ti-calendar picker_calendar" id="toDateCalendar"></i>
													</div>
												</div>

												<!-- 	<div class="col-lg-3">
													<div class="form-group">
														<label>Reference</label>
														<div class="select">
															<select id="reference" onchange="getRefItemDetails()">
																<option value="">Select</option>
															</select>
														</div>
													</div>
												</div> -->
												<!--  <div class="col-lg-2">
													<label>Quotation Id</label> <input type="text"
														id="quotationId" class="form-control" readonly>
												</div> -->


												<div class="col-lg-3">
													<div class="form-group">
														<label>Payment Term</label>
														<div class="select">
															<select id="paymentTermId" onblur="removeValid(event)">
																<option value="">Select</option>
																<option th:each="c,iter:${PaytermList}"
																	th:value="${c.key}" th:text="${c.name}"></option>
															</select>
														</div>
													</div>

												</div>

												<div class="col-lg-3">
													<div class="form-group">
														<label>Mode Of Transport</label>
														<div class="select">
															<select id="carrierId" onblur="removeValid(event)">
																<option value="">Select</option>
																<option th:each="c,iter:${CarrierLists}"
																	th:value="${c.key}" th:text="${c.name}"></option>
															</select>
														</div>
													</div>

												</div>

												<div class="col-lg-4">
													<div class="form-group">

														<label>Shipping Details</label>
														<div class="row mrtop" id="shippingDetails">
															<div class="col-md-6">
																<div class="radio-align">
																	<span><input type="radio" id="orgDetails"
																		value="0" checked name="checkbox"
																		onclick="openModal(0)"></span> <label class="lbl">Organization</label>
																</div>
															</div>
															<div class="col-md-4">
																<div class="radio-align">
																	<span><input type="radio" id="custDetails"
																		value="1" name="checkbox" onclick="openModal(1)"></span>
																	<label class="lbl">Vendor</label>
																</div>
															</div>
														</div>


														<div class="row">
															<div class="col-lg-12" id="organatioModal">

																<div class="form-group">
																	<div class="autocomplete" style="width: 100%;">
																		<label>Organization Name</label> <input type="text"
																			id="organizationName" placeholder="Organization Name"
																			class="form-control">

																	</div>


																</div>
															</div>
															<div class="col-lg-12" id="customerModal">

																<div class="form-group">
																	<div class="autocomplete" style="width: 100%;">
																		<label>Vendor Name</label> <input type="text"
																			id="customerName" placeholder="Vendor Name"
																			class="form-control">

																	</div>


																</div>
															</div>
														</div>



													</div>
												</div>


												<div class="col-lg-6">
													<div class="form-group">
														<label>Vendor Notes</label>
														<textarea id="qutDescription" class="mt-2 form-controls"> </textarea>

													</div>
												</div>



											</div>


											<div id="main_content">
												<div class="accordion-item mt-4" id="accordionExample">
													<h2 class="accordion-header" id="headingOne">
														<button class="accordion-button" type="button"
															data-bs-toggle="collapse" data-bs-target="#collapseOne"
															aria-expanded="false" aria-controls="collapseOne">
															Item Details</button>
													</h2>

													<div id="collapseOne"
														class="accordion-collapse collapse show"
														aria-labelledby="headingOne"
														data-bs-parent="#accordionExample">
														<div class="accordion-body">

															<div class="row">

																<div class="col-md-4 btn-hs1">
																	<div class="font-design"></div>
																</div>
																<div class="col-md-8 butttonsec">

																	<button class="new-btn" id="newItem"
																		onclick="openNav()">NEW</button>
																	<button class="delete-btn" id="delete1"
																		onclick="deleteItem()">Delete</button>
																	<!-- <button class="new-btn" id="grn" onclick="createGRN()">
																		GRN Receipt</button> -->
																</div>
															</div>
															<div id="item" style="width: 100%; height: 200px;"
																class="ag-theme-alpine"></div>


														</div>

													</div>
												</div>


												<div id="mySidenav" class="sidenav">
													<div class="slidebox">
														<div class="row">
															<div class="chartbtnsec">
																<div align="right">
																	<button class="cancel-btn" onclick="closeNav()">CANCEL</button>
																	<button class="approve-btn" id="saveTableData"
																		onclick="saveTableData()">SAVE</button>

																</div>
															</div>

															<div class="col-lg-12 mrt_6">
																<div class="form-group">
																	<button id="browseBtn" class="browse-btn">Browse</button>
																</div>
															</div>

															<div class="col-lg-12">
																<div class="form-group">
																	<div class="autocomplete">
																		<input type="hidden" id="editProduct"> <input
																			type="hidden" id="itemId"> <label>Item
																			Name</label> <input type="text" id="itemName"
																			onblur="removeValid(event)" class="form-control"
																			onkeyup='getItemQutotationList()'>
																	</div>
																	<div id="suggesstion-box_" class="sugg-cls"></div>
																</div>
															</div>
															<div class="col-lg-6">
																<div class="form-group">
																	<div class="autocomplete" style="width: auto">
																		<label>HSN Code </label> <input type="text"
																			id="hsnCode" onblur="removeValid(event)"
																			class="form-control"
																			onkeyup='getItemQutotationList()'>
																	</div>
																	<div id="suggesstion-boxx_" class="sugg-cls"></div>
																</div>
															</div>


															<div class="col-lg-6">
																<div class="form-group">
																	<label>Unit</label>
																	<div class="select">
																		<select id="unit" onblur="removeValid(event)"
																			onkeyup='getItemQutotationList()'>
																			<option value="">Select</option>
																			<option th:each="c,iter:${unitList}"
																				th:value="${c.key}" th:text="${c.name}"></option>
																		</select>
																	</div>
																</div>

															</div>

															<div class="col-lg-6">
																<div class="form-group">
																	<label>Quantity</label> <input type="text"
																		id="quantity" class="form-control"
																		onblur="removeValid(event)"
																		onkeyup="calculateLineTotal();getGSTRateCal()">
																</div>
															</div>
															<div class="col-lg-6">
																<div class="form-group">
																	<label>Unit Price</label><input type="text"
																		id="unitPrice" class="form-control"
																		onblur="removeValid(event)"
																		onkeyup="calculateLineTotal();getGSTRateCal()">
																</div>
															</div>
															<input type="hidden" id="pendingQty" />

															<div class="col-lg-6">
																<div class="form-group">
																	<label>Discount</label>
																	<div class="d-flex">
																		<input type="text" id="discount" class="form-control"
																			onkeyup="calculateLineTotal();getGSTRateCal()"
																			onblur="removeValid(event)">
																		<div class="select" style="width: 60px;">
																			<select id="discountAmount" class="form-control"
																				onkeyup="calculateLineTotal();getGSTRateCal()">
																				<option value="0" selected>%</option>
																				<option value="1">₹</option>
																			</select>
																		</div>

																	</div>
																</div>
															</div>
															<input type="hidden" id="gstRateTemp" />
															<div class="col-lg-6">
																<div class="form-group">
																	<label>GST Rate</label><input type="text" id="gstRate"
																		onblur="removeValid(event)" class="form-control"
																		onkeyup="getGSTRateCal()">
																</div>
															</div>
															<div class="col-lg-12">
																<div class="form-group">
																	<label>Line Total</label> <input type="text"
																		id="lineTotal" onblur="removeValid(event)"
																		class="form-control">
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>


											<div class="row" id=gstCalS>
												<div class="col-lg-7">


													<!--accordion start-->
													<div class="accordion-item mt-4" id="accordionExample2">
														<div class="accordion-item" id="documentDetails">
															<h2 class="accordion-header" id="headingTwoo"
																onclick="closeAllNav()">

																<button class="accordion-button collapsed" type="button"
																	data-bs-toggle="collapse"
																	data-bs-target="#collapseTwoo" aria-expanded="false"
																	aria-controls="collapseTwoo">Attach Files To
																	PO</button>

															</h2>
															<div id="collapseTwoo"
																class="accordion-collapse collapse"
																aria-labelledby="headingTwoo"
																data-bs-parent="#accordionExample">
																<div class="accordion-body">


																	<div class="row">
																		<div class="col-md-4 btn-hs1">
																			<div class="font-design"></div>
																		</div>
																		<div class="col-md-8 butttonsec">
																			<!--   <button class="download-btn" onclick="rfqCSV()">Download</button> -->
																			<button class="new-btn" id="saveAttachmentBtn"
																				onclick="checkEmpty();">Add Document</button>

																		</div>
																	</div>

																	<table id="docTbl" cellspacing="7" cellpadding="7">
																		<thead>
																			<tr class="tr_clone">
																				<!-- <th align="center"></th> -->

																				<th width="320">Document Name</th>
																				<th width="380">Attachment</th>


																			</tr>
																		</thead>
																		<tbody id="doctbodyData">
																			<tr>
																				<td style="display: none" align="center"
																					class="pdb-24"><input class="checkCls"
																					type="checkbox" id="check2"><label
																					for="check2"></label></td>
																				<td style="display: none"><div
																						class="form-group">


																						<select class="form-control documentclss"
																							id="docid_0" onblur="removeValid(event);">
																							<option value="">--Select--</option>
																							<option th:each="c,iter:${documentTypeList}"
																								th:value="${c.key}" th:text="${c.name}"></option>
																						</select>
																					</div></td>
																				<td><div class="form-group">
																						<input type="text" value=""
																							class="form-control docNoclss"
																							onblur="checkForDuplicateEntry(event)"
																							id="docnoid_">
																					</div></td>

																				<td>
																					<div class="control-group position-r">
																						<label class="custom-file-upload"
																							for="uploadDoc_0" id="uploadFor_0"> <i
																							id="clickImg_0" class="ti-plus"></i>
																						</label>
																						<div class="controls">

																							<input type="file" class="document"
																								id="uploadDoc_0" name="userImage"
																								accept="image/*" onchange="saveMultiFile(event)" />

																						</div>
																					</div> <input type="hidden" id="uploadHidden_0"
																					class="uploadHidCls">
																					<div id="uploadedBillDiv_0" align="center"
																						class="uploadedBillCls"></div>
																					<div id="imageName_0" class="imageName"></div>
																					<div id="dltImage_0"></div>
																				</td>

																			</tr>


																		</tbody>
																	</table>

																</div>
															</div>
														</div>
													</div>
													<!--accordion end-->



													<div class="form-group">
														<label style="margin-bottom: 10px;">Terms &
															Conditions</label>
														<textarea id="terms" class="mt-2 form-controls"
															style="height: 129px;"> </textarea>

													</div>


												</div>
												<div class="col-lg-5 mt-4">
													<table style="width: 100%">
														<tr>
															<th>
																<div class="row">
																	<div class="col-lg-4">Sub Total:</div>
																	<div class="col-lg-8">
																		<div class="form-group">
																			<input type="text" id="subTotal" class="form-control"
																				readonly>
																		</div>
																	</div>
																</div>
															</th>

														</tr>
														<tr class="tbl-box" id="sgstTR">
															<th>
																<div class="row">
																	<div class="col-lg-4">SGST:</div>
																	<div class="col-lg-8">
																		<div class="form-group">
																			<input type="text" id="qSGST" class="form-control"
																				readonly> <input type=hidden id="itemIgst">
																		</div>
																	</div>
																</div>
															</th>

														</tr>

														<tr id="cgstTR">
															<th>

																<div class="row">
																	<div class="col-lg-4">CGST:</div>
																	<div class="col-lg-8">
																		<div class="form-group">
																			<input type="text" id="qCGST" class="form-control"
																				readonly> <input type=hidden id="itemSgst">
																		</div>
																	</div>
																</div>
															</th>

														</tr>
														<tr class="tbl-box" id="igstTR">
															<th>
																<div class="row">
																	<div class="col-lg-4">IGST:</div>
																	<div class="col-lg-8">
																		<div class="form-group">
																			<input type="text" id="qIGST" class="form-control"
																				readonly> <input type=hidden id="itemCgst">
																		</div>
																	</div>
																</div>
															</th>
														</tr>

														<tr>
															<th>
																<div class="row">
																	<div class="col-lg-4">Adjustment:</div>
																	<div class="col-lg-8">
																		<div class="form-group">
																			<input type="text" id="adjustment"
																				class="form-control"
																				onkeyup="calculateAdjustment();" value='0'>
																		</div>
																	</div>
																</div>

															</th>

														</tr>


														<tr>
															<th>
																<div class="row">
																	<div class="col-lg-4">TCS:</div>
																	<div class="col-lg-5">
																		<div class="form-group">
																			<input type="text" class="form-control" id="tcsName"
																				placeholder="TCS" onkeyup="getTCSList(); tcsBlank()"
																				autocomplete="off"> <input type="hidden"
																				id="tcsId">
																		</div>
																		<input type=hidden id="tcsValue">
																		<div id="suggesstion-box3_" class="sugg-cls"></div>
																	</div>

																	<div class="col-lg-3">
																		<div class="form-group">
																			<input type="text" class="form-control"
																				id="tcsAmount" onkeyup="getTCSList();" readonly>
																			<input type="hidden" id="tcsId">
																		</div>
																	</div>
																</div>
															</th>
														</tr>

														<tr>
															<th>
																<div class="row">
																	<div class="col-lg-4">Grand Total:</div>
																	<div class="col-lg-8">
																		<div class="form-group">
																			<input type="text" id="grandTotal"
																				class="form-control" readonly>
																		</div>
																	</div>
																</div>

															</th>

														</tr>

													</table>


												</div>


											</div>



										</div>

									</div>



								</div>
							</div>
						</div>



						<!--      modal  div end - -->

						<div class="modal fade" id="myModal">
							<div class="modal-dialog modal-lg" style="margin-top: 130px;">
								<div class="modal-content">

									<!-- Modal Header -->
									<div class="modal-header">
										<h4 class="modal-title md-color">Select Product</h4>
										<button type="button" class="close cp" data-dismiss="modal"
											onclick="closeModal1()">&times;</button>
									</div>

									<!-- Modal body -->
									<div class="modal-body modal-cat1">
										<div class="row">

											<div class="col-md-6" df="0"
												style="height: 300px; overflow-y: scroll;">
												<table id="basic">
													<tbody id="productCategoryCBDiv"></tbody>
												</table>


											</div>
											<div class="col-md-6" id="productCategorySelectDiv" df="0"
												style="border-left: 1px solid #ccc; height: 300px; overflow-y: scroll;">
												<div>
													<div class="productlist">Select Product</div>
													<div id="select_product"></div>
													<input type="hidden" id="itemNameTemp" /> <input
														type="hidden" id="hsnCodeTemp" /> <input type="hidden"
														id="itemNameTemp" /> <input type="hidden" id="itemIdTemp" />
													<input type="hidden" id="brandNameTemp" /> <input
														type="hidden" id="brandIdTemp" /> <input type="hidden"
														id="skuTemp" /> <input type="hidden" id="hsnCodeTemp" />
													<input type="hidden" id="unitTemp" /> <input type="hidden"
														id="gstRateTemp" /> <input type="hidden"
														id="prodCatIdTemp" /> <input type="hidden"
														id="prodCatNameTemp" />
												</div>
											</div>
										</div>
									</div>

									<!-- Modal footer -->
									<div class="modal-footer">
										<div class="chartbtnsec">
											<button class="approve-btn" onclick="selectProductVal()">SELECT</button>
											<button class="cancel-btn" data-dismiss="modal"
												onclick="closeModal1()">CANCEL</button>
										</div>
									</div>

								</div>
							</div>
						</div>


						<!-- delete item start	 -->
						<div id="deleteProduct" class="modal fade show" aria-modal="true">
							<div class="modal-dialog modal-confirm">
								<div class="modal-content">
									<div class="modal-header flex-column">
										<button type="button" class="close" data-dismiss="modal"
											aria-hidden="true" onclick="cancelModalProductBtn()">
											<i class="ti-close modal-close"></i>
										</button>
									</div>
									<div class="modal-body">
										<p>Do you really want to delete these records? This
											process cannot be undone.</p>
									</div>
									<div class="modal-footer justify-content-center"
										style="margin-top: -15px;">

										<button type="button" class="cancel-btn" data-dismiss="modal"
											onclick="cancelModalProductBtn();">Cancel</button>
										<button type="button" class="delete-btn"
											onclick="deleteProductOnclick()">Delete</button>
									</div>
								</div>
							</div>
						</div>


					</div>

				</div>
			</div>
		</div>
	</div>
</body>
</html>
