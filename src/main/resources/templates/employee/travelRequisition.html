<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/master}">
<head>
<style type="text/css">
.highcharts-exporting-group {
	display: none;
}

.slidebox {
	padding: 14px;
	margin-top: 0px;
	margin: 0px 10px;
}

/* .form-group label {
	font-size: 12px;
	position: relative;
	top: 4px;
} */
.holdCls {
	background-color: rgb(0, 143, 0);
}

.bg_white {
	background: #ffffff !important;
}
</style>

<script type="text/javascript">
	function openNav() {
		 $("#serviceName").val('');
		 $("#date").val('');
		 $("#time").val('');
		 $("#description").val('');
		// $("#toPlace").val('');
		document.getElementById("mySidenav").style.cssText = "width: 25%; position: absolute; right:-10px; overflow: hidden; height:auto; top:250px;";

		document.getElementById("main").style.width = "75%";
	}

	function closeNav() {
		document.getElementById("mySidenav").style.width = "0";
		document.getElementById("main").style.width = "100%";
		$("#serviceId").val('');
		$("#date").val('');
		$("#time").val('');
		$("#description").val('');
		//$("#toPlace").val('');
		//$("#rowEdit").val(null);
	}
	
	$(function() {
		$("input[name='advanceReq']").click(function() {
			if ($("#No").is(":checked")) {
				$("#amount").hide();
				$("#advanceAmount").val("");
				
			} else {
				$("#amount").show();
			}
		});
	});

	var count1 = 0;
	function allCheck1() {
		count1++;

		if (count1 == 1) {
			$('.checkCls1').prop("checked", true);
		} else {
			count1 = 0;
			$('.checkCls1').prop("checked", false);
		}
	}

	function cancelBar() {
		var id = document.getElementById("closeKey");
		id.style.display = "block";
		if ($('#searchBar').val() == null || $('#searchBar').val() == "") {
			id.style.display = "none";
		}
	}
</script>


<script type="text/javascript">
	$(document).ready(function() {
		
		var userid = $("#sessionId").val();
		var userrole = $("#sessionRole").val();
		var roleid = "";
		for(var i = 6; i <= userrole.length; i=i+6){  
		    roleid = roleid + '"' +userrole.slice(i-6, i)+ '",';
		}
		roleid = roleid.substring(0, roleid.length - 1); 
		
		agGrid.simpleHttpRequest({
			url : 'travel-requisition-view-employee?userid=' + userid+"&roleid="+roleid,
		}).then(function(data) {
			var len = data.length;
			$('#totalReq').find('span').html(len);

			gridOptions.api.setRowData(data);
		});
		
		
		activityOptions.api.setRowData();

		// date format FROM date

		var dateFormat = localStorage.getItem("dateFormat");
		$("#fromDateCalendar").datetimepicker({
			format : dateFormat,
			closeOnDateSelect : true,
			timepicker : false,
			minDate : new Date(),
		}).on("change", function() {
			$('#fromDate').val($(this).val());
		})

		$('#fromDate').blur(function() {
			$("#fromDateCalendar").val($(this).val());
		})
		


		//     date format TO date

		var dateFormat = localStorage.getItem("dateFormat");
		$("#toDateCalendar").datetimepicker({
			format : dateFormat,
			closeOnDateSelect : true,
			timepicker : false,
			minDate : new Date(),
		}).on("change", function() {
			$('#toDate').val($(this).val());
		})

		$('#toDate').blur(function() {
			$("#toDateCalendar").val($(this).val());
		})


		
		///TO_date
		var dateFormat = localStorage.getItem("dateFormat");
		$("#DateCalendar").datetimepicker({
			format : dateFormat,
			closeOnDateSelect : true,
			timepicker : false,
		}).on("change", function() {
			$('#date').val($(this).val());
		})

		$('#date').blur(function() {
			$("#DateCalendar").val($(this).val());
		})
 
 
	

	$("#toDateCalendarTime").datetimepicker({
		format : 'H:i',
		closeOnDateSelect : false,
		timepicker : true,
		datepicker : false,
		step: 15
	}).on("change", function() {
		$('#time').val($(this).val());
	})

	$('#time').blur(function() {
		$("#toDateCalendarTime").val($(this).val());
	})

		//changeOpt();

		$("#statusDiv").hide();
		$('#reqDltBtn').attr('disabled', true);
		$('#approve').attr('disabled', true);
		$('#reject').attr('disabled', true);
		$('#deleteChild').attr('disabled', true);
		$('.collapse').on('show.bs.collapse', function() {
			$(this).siblings('.panel-heading').addClass('active');
		});

		$('.collapse').on('hide.bs.collapse', function() {
			$(this).siblings('.panel-heading').removeClass('active');
		});
		$("#newBtn").click(function() {
			$("#myGrid").hide();
			$("#reqTable").hide();
			$("#searchDiv").hide();
			$(".btn-hs").show();
			$("#btndiv").hide();
			$("#listdiv").hide();
			$("#totalReq").hide();
			$("#searchRowDiv").hide();
			$("#ttbtn").hide();
			$("#demo").show();
			
		})

	});
	
	/* -------------------search bar for mygrid------------------------ */

	function onQuickFilterChanged() {
		gridOptions.api
				.setQuickFilter(document.getElementById('quickFilter').value);
	}

	function cancelBar() {
		var id = document.getElementById("closeKey");
		id.style.display = "block";

		if ($('#quickFilter').val() == null || $('#quickFilter').val() == "") {
			id.style.display = "none";
		}
	}
 function cancel() {
	 $(".formValidation").remove();
		$("#reqTable").show();
		$("#searchDiv").show();
		$(".btn-hs").show();
		$("#myGrid").show();
		$("#demo").hide();
		var userid = $("#sessionId").val();
		var userrole = $("#sessionRole").val();
		var roleid = "";
		for(var i = 6; i <= userrole.length; i=i+6){  
		    roleid = roleid + '"' +userrole.slice(i-6, i)+ '",';
		}
		roleid = roleid.substring(0, roleid.length - 1); 
		
		agGrid.simpleHttpRequest({
			url : 'travel-requisition-view-employee?userid=' + userid+"&roleid="+roleid,
		}).then(function(data) {
			var len = data.length;
			$('#totalReq').find('span').html(len);

			gridOptions.api.setRowData(data);
		});
		$("#employeeId").val('');
		$("#fromDate").val('');
		$("#toDate").val('');
		$("#serviceId").val('');
		$("#date").val('');
		$("#time").val('');
		$("#description").val('');
		//$("#toPlace").val('');
		$("#rowEdit").val(null);
	};
</script>


<script type="text/javascript">
 
//master save data

function masterSaveData() {
	/ if (validFormData() && validProductData()) { /
		$(".formValidation").remove();
	var valid= true;
	
	var datas = [];
	var rowCount = activityOptions.api.getDisplayedRowCount();
	
	if(rowCount > 0){

	activityOptions.api.forEachNode(function(rowNode, index) {
		
		var item = rowNode.data;
        
		item.travelingReqId = $("#trReqId").text();
		item.fromDate = $("#fromDate").val();
		item.toDate = $("#toDate").val();
		item.employeeId = $("#employeeId").val();
		item.placeName = $("#placeName").val();
		item.purpose = $("#purpose").val();
		
		item.advanceReq = $("input[type='radio'][name='advanceReq']:checked").val();

           if (item.advanceReq == 1) {
				item.advanceReq = "1";
				item.advanceAmount = $("#advanceAmount").val();

			} else {
				item.advanceReq = "0";
				item.advanceAmount = "";
			}
       	if (item.placeName == null || item.placeName == "") {
			valid = validationUpdated("Place Name is Required", "placeName");
		}
		if (item.fromDate == null || item.fromDate == "") {
			
		
			valid = validationUpdated("From Date is Required", "fromDate");
			console.log("1"); 
			
		}
		if (item.toDate == null || item.toDate == "") {
			valid = validationUpdated("To Date is  Required", "toDate");
			
		}
		
	
		if (item.purpose == null || item.purpose == "") {
			valid = validationUpdated("Purpose Required", "purpose");
			return false;
		}
	    item.subComponentId = localStorage.getItem('activity');
			datas.push(item);

		});
	
		
	
	
	} else {
		
		var item = {};

		item.travelingReqId = $("#trReqId").text();
		item.fromDate = $("#fromDate").val();
		item.toDate = $("#toDate").val();
		item.employeeId = $("#employeeId").val();
		item.placeName = $("#placeName").val();
		item.purpose = $("#purpose").val();
		item.advanceReq = $("#advanceReq").val();
		item.advanceAmount = $("#advanceAmount").val();
		if (item.placeName == null || item.placeName == "") {
			valid = validationUpdated("Place Name Required", "placeName");
		}
		if (item.fromDate == null || item.fromDate == "") {
			
			valid = validationUpdated("From Date is Required", "fromDate");
			console.log("1");
			
		}
		if (item.toDate == null || item.toDate == "") {
			valid = validationUpdated("To Date is Required", "toDate");
			
		}
		
		if (item.purpose == null || item.purpose == "") {
			valid = validationUpdated("Purpose Required", "purpose");
		//	return false;
		}
		
		if (item.advanceAmount == null || item.advanceAmount == "") {
			valid = validationUpdated("Advance Amount Required", "advanceAmount");
			//return false;
		}
		 
		$("#messageParagraph").text(
		"Add Other Services Details First");
		$("#msgOkModal").removeClass("btn3");
		$("#msgOkModal").addClass("btn1");
		$("#msgModal").modal('show');
	
		datas.push(item);
		
		
	}
	if (valid) {
	saveTravelRequisition(datas);
	console.log(datas);
	}
}

function saveTravelRequisition(datas) {
	console.log(datas);
	$('.loader').show();
	//$("body").addClass("overlay");
	$.ajax({
		type : "POST",
		url : "travel-requisition-add-travel-details",
		dataType : "json",
		contentType : "application/json",
		data : JSON.stringify(datas),
		success : function(response) {
			$('.loader').hide();
			if (response.code == "success") {
				cancel();
				$("#messageParagraph").text(response.message);
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');
				closeNav()
			} else {
				$('.loader').hide();
				$("#messageParagraph").text(response.message);
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');
			}
		},
		error : function(data) {
			$('.loader').hide();
		}
	}) //ajax ends
}

	$("#newBtn").click(function() {
		$("#myGrid").hide();
		$("#reqTable").hide();
		$(".btn-hs").hide();
		$("#demo").show();
		$("#totalReq").hide();
		$("#searchRowDiv").hide();
		$("#ttbtn").hide();
	})

	var columnDefs = [
			{
				headerCheckboxSelection : false,
				headerCheckboxSelectionFilteredOnly : false,
				checkboxSelection : true,
				width : 10,
				sortable : false,
				filter : false,
				resizable : true

			},
			{
				headerName : 'Requisition Id',
				width : 150,
				field : "travelingReqId",
				cellRenderer : function(params) {
					 var sempid=$("#sessionId").val();
						if (params.data.employeeId==sempid && params.data.status=="Pending") {
							return '<a id="requisitionId" onclick=editTravel("'
							+ params.data.travelingReqId+','
							+ params.data.employeeId+','+params.data.status
							+ '") href="javascript:void(0)">'
							+ params.data.travelingReqId + '</a>';
						}else{
							return '<div>'+params.data.travelingReqId+'</div>';
						}
				}
/* 				cellRenderer : function(params) {
					return '<a id="requisitionId" onclick=editTravel("'
							+ params.data.travelingReqId+','
							+ params.data.employeeId+','+params.data.status
							+ '") href="javascript:void(0)">'
							+ params.data.travelingReqId + '</a>';

				} */
			}, {
				headerName : 'Employee Id',
				width : 120,
				field : "employeeId",
			}, {
				headerName : 'Employee Name',
				width : 180,
				field : "employeeName",
			}, {
				headerName : 'Place Name',
				field : "placeName",
			}, {
				headerName : 'Apply Date',
				field : "createdOn",
				width : 120,
				cellStyle : {
					textAlign : 'center'
				}
			},
			{
				headerName : 'From Date',
				field : "fromDate",
				width : 120,
				cellStyle : {
					textAlign : 'center'
				}
			}, {
				headerName : 'To Date',
				field : "toDate",
				width : 120,
				cellStyle : {
					textAlign : 'center'
				}
			}, {
				headerName : 'Purpose',
				field : "purpose",
				width : 180,
			},{
				headerName : 'Status',
				width : 120,
				field : "status",
				cellRenderer : function(params) {
					if (params.data.status =="Pending") { 
						return '<div style="color:#a9a9a9">Pending</div>';
					} else if (params.data.status =="Forwarded") {
						return '<div style="color:#ffa500">Forwarded</div>';
					} else if (params.data.status == "Approved") {
						return '<div style="color:#0642f5">Approved</div>';
					} else {
						return '<div style="color:#ff8242">Rejected</div>';
					}	
				}
			}, {
				headerName : 'Advance Required',
				field : "advanceReq",
				width : 180,
				cellStyle : {
					textAlign : 'center'
				},
/* 				cellRenderer : function(params) {
					if (params.data.advanceReq=='0') {
						return 'NO';
					} else {
						return 'YES';
					}
				} */
			}, {
				headerName : 'Advance Amount',
				width : 180,
				field : "advanceAmount",
			}, {
				headerName : 'Approved By',
				width : 180,
				field : "approvedBy"

			}, {
				headerName : 'Rejected By',
				field : "rejectedBy"
			},{
				headerName : 'Comment',
				field : "approveComment",
				width : 200,
			}

			 ];

	

	// for activity table

	var activityDefs = [
			{
				headerCheckboxSelection : true,
				headerCheckboxSelectionFilteredOnly : true,
				checkboxSelection : true,
				sortable : false,
				filter : false,
				resizable : true,
				width : 30
			},
			{
				headerName : "Serial No",
				field : "slnoId",
				width : 150,
				cellRenderer : function(params) {
					return '<a onclick=editRow("' + params.data.slnoId
							+ '") href="javascript:void(0)">'
							+ params.data.slnoId + '</a>';
				}
			}, {
				headerName : "Service",
				field : "serviceName",
				width : 250
			}, {
				headerName : "ServiceId",
				field : "serviceId",
				width : 200,
				hide : true
			}, {
				headerName : "Date",
				field : "date",
				width : 200,
				cellStyle : {
					textAlign : 'center'
				},
			},

			{
				headerName : "Time",
				field : "time",
				width : 200,
				cellStyle : {
					textAlign : 'center'
				},
			}, {
				headerName : "Description",
				field : "description",
				width : 470
			},];

	// let the grid know which columns and what data to use
	var gridOptions = {
		columnDefs : columnDefs,
		rowSelection : 'single',
		groupSelectsChildren : true,
		suppressRowClickSelection : true,
		suppressAggFuncInHeader : true,
		defaultColDef : {
			sortable : true,
			filter : true,
			resizable : true,
			width : 120
		},
		onSelectionChanged : onSelectionChanged,
	};

	// let the grid know which columns and what data to use product table
	var activityOptions = {
		columnDefs : activityDefs,
		rowSelection : 'multiple',
		groupSelectsChildren : true,
		suppressRowClickSelection : true,
		suppressAggFuncInHeader : true,
		defaultColDef : {
			sortable : true,
			filter : true,
			resizable : true,
			width : 200
		},
		onSelectionChanged : onSelectionChangeChild,
		getRowNodeId : function(data) {
			return data.slnoId;
		}
	};
	
	var id = "";
	var creq="";
	function onSelectionChangeChild() {
		 var selectedNodes = activityOptions.api.getSelectedNodes();
		 var selectedData = selectedNodes.map(node => node.data);
		 creq= selectedData.map(node => node.slnoId);
		 var empID= selectedData.map(node => node.employeeId);
		 
		var selectedRows = activityOptions.api.getSelectedRows();
		id = "";
		for (var i = 0; i < selectedRows.length; i++) {

			id = id + '"' + selectedRows[i].travelingReqId + '",';
			console.log(selectedRows[i].status);
		}
		id = id.substring(0, id.length - 1);

		var rowCount = 0;
		selectedRows.forEach(function(i) {
			rowCount = rowCount + 1;
		});
		if (rowCount > 0) {
			$('#newchild').attr('disabled', true);
			$('#deleteChild').attr('disabled', false);
		
	}else{
		$('#newchild').attr('disabled', false);
		$('#deleteChild').attr('disabled', true);
		
	}
	}
	
	
	var id = "";
	var treq="";
	function onSelectionChanged() {
		
		 var selectedNodes = gridOptions.api.getSelectedNodes();
		 var selectedData = selectedNodes.map(node => node.data);
		 treq= selectedData.map(node => node.travelingReqId);
		 var empID= selectedData.map(node => node.employeeId);
		 
		var selectedRows = gridOptions.api.getSelectedRows();
		id = "";
		for (var i = 0; i < selectedRows.length; i++) {

			id = id + '"' + selectedRows[i].travelingReqId + '",';
			console.log(selectedRows[i].status);
		}
		id = id.substring(0, id.length - 1);

		var rowCount = 0;
		selectedRows.forEach(function(i) {
			rowCount = rowCount + 1;
		});
	 
		
		 var uid=$("#sessionId").val();
		 var adRole=$("#adRole").val();
		if (rowCount > 0) {
			$('#newBtn').attr('disabled', true);
		
			if(empID!=uid){
				 if (selectedData.map(node => node.status) =="Approved") {
						$('#reqDltBtn').attr("disabled", true);
						$('#approve').attr('disabled', true);
						$('#reject').attr('disabled', true);
			        } else {
			        	$('#approve').attr('disabled', false);
						$('#reject').attr('disabled', false);
						$('#reqDltBtn').attr("disabled", true);
			        }
			
			}else{
				if(adRole=='rol001' || adRole=='rol010'){
					$('#approve').attr('disabled', false);
					$('#reject').attr('disabled', false);
				}else{
					$('#approve').attr('disabled', true);
					$('#reject').attr('disabled', true);
				}
				 if (selectedData.map(node => node.status) =="Pending") {
					$('#reqDltBtn').attr("disabled", false);
				}else{
					$('#reqDltBtn').attr("disabled", true);
				}
			}

		} else {
			$('#reqDltBtn').attr("disabled", true);
			$('#approve').attr('disabled', true);
			$('#reject').attr('disabled', true);
			$('#newBtn').attr('disabled', false);
			//$('#delete').attr('disabled', false);
		}

	}
	// for editing child table of shift 
	function editRow(rowNo) {
		var rowNode = activityOptions.api.getRowNode(rowNo);

		openNav();

		$("#rowEdit").val(rowNo);
		$("#serviceId").val(rowNode.data.serviceId);
		$("#serviceName").val(rowNode.data.serviceName);
		$("#date").val(rowNode.data.date);
		$("#time").val(rowNode.data.time);
		$("#description").val(rowNode.data.description);
	//	$("#toPlace").val(rowNode.data.toPlace);
	}

	//editing the employee shift details parent table

	function editTravel(travelingReqId) {
		var data = travelingReqId.split(",");
		var travelingReqid= data[0];
		var empid = data[1];
		var sts = data[2];
	    var sempid=$("#sessionId").val();
	    $("#demo").show();
		agGrid.simpleHttpRequest(
				{
					url : 'travel-requisition-edit-employee-trough-ajax?id='
							+ travelingReqid
				}).then(function(data) {

			
					
					if (sts== "Pending" && empid==sempid) {
						
					//alert(empid)
						//alert(sempid)
						$("#myGrid").hide();
						$("#save").show();
						$("#save1").show();
						//$("#newchild").attr('disabled', false);
						
					
			$("#trReqId").html(data[0].travelingReqId);
			$("#fromDate").val(data[0].fromDate);
			$("#toDate").val(data[0].toDate);
			$("#employeeId").val(data[0].employeeId);
			$("#placeName").val(data[0].placeName);
			$("#purpose").val(data[0].purpose);
			//$("#advanceReq").val(data[0].advanceReq);
			$("#advanceAmount").val(data[0].advanceAmount);
			if(data[0].advanceReq==1){
				$("#Yes").prop('checked', true);
				$("#amount").show();
			}else{
				$("#No").prop('checked', true);
				$("#amount").hide();
			}

			if (data[0].serviceId != null) {
				activityOptions.api.setRowData(data);
			}
					}
					
				else{
					
				
						$("#myGrid").hide();
						$('#save').attr('disabled', true);
						$('#save1').attr('disabled', true);
					
					$("#trReqId").html(data[0].travelingReqId);
			$("#fromDate").val(data[0].fromDate);
			$("#toDate").val(data[0].toDate);
			$("#employeeId").val(data[0].employeeId);
			$("#placeName").val(data[0].placeName);
			$("#purpose").val(data[0].purpose);
			//$("#advanceReq").val(data[0].advanceReq);
			$("#advanceAmount").val(data[0].advanceAmount);
			if(data[0].advanceReq==1){
				$("#Yes").prop('checked', true);
				$("#amount").show();
			}else{
				$("#No").prop('checked', true);
				$("#amount").hide();
			}

			if (data[0].serviceId != null) {
				activityOptions.api.setRowData(data);
			}   
			if (data[0].serviceId != null) {
				activityOptions.api.setRowData(data);
			}
				
				} 
					
					
			$('.loader').hide();
			$("body").removeClass("overlay");
			//$("#deleteChild").show();
			//$("#newchild").show();
		});
		
		 $("#myGrid").hide();
		$("#reqTable").hide();
		$("#totalReq").hide();
		$("#ttbtn").hide();
		//$("#deleteChild").show();
		//$("#newchild").show();
		$("#save").show();
		$("#searchRowDiv").hide();
		$('.loader').show();
		$("body").addClass("overlay");
 
	}

	// delete  

	function deleteOnclick() {
		var selectedRows = gridOptions.api.getSelectedRows();
		var selectedRowsString = '';
		selectedRows.forEach(function(selectedRow, index) {
			if (index > 0) {
				selectedRowsString += ',';
			}
			selectedRowsString += selectedRow.travelingReqId;
		});
		if (selectedRowsString) {
			var item = {};
			item.travelingReqId = selectedRowsString;
			$.ajax({
				type : "POST",
				url : "travel-requisition-delete-th-ajax",
				dataType : "json",
				contentType : "application/json",
				data : JSON.stringify(item),
				success : function(response) {
					if (response.message == "Success") {
						cancel();
						$('#delete').modal('hide');
						location.reload();
					} else {
						swal({
							title : response.code,
							text : response.message,
							type : "warning"
						})
					}
				},
				error : function(data) {
					console.log(data)
				}
			})
		} else {
			$("#alert").modal('show');
			document.getElementById("textId").innerHTML = "Please Select Atleast one Record !";
		}

	}

	// delete selected record from ag grid
	function deleteDetailsOnclick() {
		$('.modal').hide();
		var selectedRows = activityOptions.api.getSelectedRows();
		activityOptions.api.applyTransaction({
			remove : selectedRows
		});
		//$('#newchild').show();
		//$('#deletechild').hide;
		cancelModalProductBtn();
		
	}

	//for closeing modal box for dlt  product
	function cancelModalProductBtn() {
		$("#deleteModalBtn").removeAttr("disabled");
		$('#deleteDetails').modal('hide');
		//$('#newchild').show();
		//$('#deletechild').hide;
	}

	function deleteFun() {
		$('#delete').modal('show');
	}

	function deleteDetails() {
		$('#deleteDetails').modal('show');
	}

	function cancelModalBtn() {
		$("#deleteModalBtn").removeAttr("disabled");
	}

	// save data in aggrid table sidenav save

	function saveTableData() {
		var item = {};
		var valid = true;
		var data = 1;
		var rowEdit = $("#rowEdit").val();
		if (true) {

			activityOptions.api.forEachNode(function(rowNode, index) {
				if (!rowEdit) {
					data = data + 1;
				}
			});
			item.serviceId = $("#serviceId").val();
			item.serviceName = $("#serviceName").val();
			item.date = $("#date").val();
			item.time = $("#time").val();
			item.description = $("#description").val();
			item.slnoId = data;
			var datas = [];
			
			if (item.serviceName == null || item.serviceName == "") {
				valid = validationUpdated("Service Name is Required", "serviceName");
				
			}
			if (item.date == null || item.date == "") {
				valid = validationUpdated("Date Required", "date");
				
			}
			if (item.time == null || item.time == "") {
				valid = validationUpdated("Time Required", "time");
				
			}
			if (item.description == null || item.description == "") {
				valid = validationUpdated("Description Required", "description");
				
			}
 
			if (valid) {
				closeNav();
			if (rowEdit) {
				var rowNode = activityOptions.api.getRowNode(rowEdit);
				rowNode.setData(item);
			} else {

				activityOptions.api.forEachNode(function(rowNode, index) {
					datas.push(rowNode.data);
				});

				datas.push(item)
				activityOptions.api.setRowData(datas);
			}
			} else{
				$('#mySidenav').show();
				
			}
		}
	}
	// setup the grid after the page has finished loading
	document.addEventListener('DOMContentLoaded', function() {

		var gridDiv = document.querySelector('#myGrid');
		new agGrid.Grid(gridDiv, gridOptions);

		var gridDiv = document.querySelector('#activity');
		new agGrid.Grid(gridDiv, activityOptions);

	});

	function switchPage() {

		
		 $("#date").val('');
		 $("#time").val('');
		 $("#description").val('');
		 //$("#toPlace").val('');
		 $("#rowEdit").val(null);
		 $("#fromDate").val();
		 $("#toDate").val();
		 $("#employeeId").val();
		 $("#placeName").val();
			$("#purpose").val();
			$("#advanceReq").val();
		var selectedRows = gridOptions.api.getSelectedRows();
		var selectedRowsString = '';
		selectedRows.forEach(function(selectedRow, index) {
			if (index > 0) {
				selectedRowsString += ',';
			}
			selectedRowsString += selectedRow.itemId;
		});
		$('.loader').show();
		$("body").addClass("overlay");
		$('.loader').hide();
		$("body").removeClass("overlay");
		$("#deleteChild").attr('disabled', true);
		$("#newchild").attr('disabled', false);
	}
	
	/* -------------------function for approve button----------------- */
	var empid = "";
	var empname = "";
	function approveRequisition() {
		empid = $("#sessionId").val();
		empname = $("#sessionName").val();
		comment = $("#comment").val();
		var userrole = $("#sessionRole").val();
		
		var roleID = "";
		for(var i = 6; i <= userrole.length; i=i+6){  
			roleID = roleID + '"' +userrole.slice(i-6, i)+ '",';
		}
		roleID = roleID.substring(0, roleID.length - 1); 
		
		$.ajax({
			type : "GET",
			url : "travel-requisition-approve?approveId=" + treq + "&name=" + empid+"&comment="+comment+"&roleid="+roleID,
			async : false,
			success : function(response) {

				if (response.message == "Success") {
					cancel();
					$('#approve').attr('disabled', true);
					$('#reqDltBtn').attr('disabled', true);
					$('#reject').attr('disabled', true);
					$('#newBtn').attr('disabled', false);
					$("#comment").val(null);
				}

			},
			error : function(data) {
			}
		});
	}

	/*-----------------------function for reject button------------------- */
	var rejempid = "";
	var rejempname = "";
	function rejectRequsition() {
		rejempid = $("#sessionId").val();
		rejempname = $("#sessionName").val();
		comment = $("#comment").val();
var userrole = $("#sessionRole").val();
		
		var roleid = "";
		for(var i = 6; i <= userrole.length; i=i+6){  
			roleid = roleid + '"' +userrole.slice(i-6, i)+ '",';
		}
		roleid = roleid.substring(0, roleid.length - 1); 
		$.ajax({
			type : "GET",
			url : "travel-requisition-reject?rejectId=" + treq + "&name=" + rejempid+"&comment="+comment+"&roleid="+roleid,
			async : false,
			success : function(response) {

				if (response.message == "Success") {
					cancel();
					
					$('#approve').attr('disabled', true);
					$('#reqDltBtn').attr('disabled', true);
					$('#reject').attr('disabled', true);
					$('#newBtn').attr('disabled', false);
					$("#comment").val(null);
				}

			},
			error : function(data) {
			}
		});
	}

/* Function for commentModal show */
	function rejectRequistionModal() {

	    $('#commentModal').modal('toggle');
	    $("#approveLeaveSubmitBtn").hide();
	    $("#rejectLeaveSubmitBtn").show();
	}
	function approveRequistionModal() {

	    $('#commentModal').modal('toggle');
	    $("#approveLeaveSubmitBtn").show();
	    $("#rejectLeaveSubmitBtn").hide();

	}
	
	function downloadDetails() { 
		  var dataset = [];
		  gridOptions.api.forEachNodeAfterFilterAndSort(function(rowNode, index) {
		        dataset.push(rowNode.data);
		    });
		  gridOptions.api.exportDataAsCsv(dataset);
		}
	
	 function check1(fieldId) {
				var tempVal = $("#" + fieldId).val().replace(/[^0-9 ]/g, '');
				var val=parseInt(tempVal);
				if(val >=100){
					$("#" + fieldId).val(val);
				   }
		      else{
					$("#messageParagraph").text(
					"Please add more than Rs.100 ");
					$("#msgOkModal").removeClass("btn3");
					$("#msgOkModal").addClass("btn1");
					$("#msgModal").modal('show');
					$("#" + fieldId).val(null);
					
				}
			}	
	 function checkAmount1(fieldId) {   
			var myField = document.getElementById("advanceAmount")
			 var reg = /^\d{0,8}(\.\d{0,2})?$/;   
			 if (reg.test(myField.value))
			 {       
				 $("#" + fieldId).val();
				 reg = '';  
			 }else{        
				 $("#" + fieldId).val(null);    
				 }
			 } 
		
		
	 function check(fieldId) {
			var tempVal = $("#" + fieldId).val().replace(/[^0-9 ]/g, '');
			$("#" + fieldId).val(tempVal);
		}
		function setFromToDate() {
			$("#messageParagraph").text("Please choose to date greater than or equal to from date ");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
			$("#fromDate").val("");
			$("#toDate").val("");
		}
		function dateChange() {
			
			var fromdate = $('#fromDate').val();
			var todate = $('#toDate').val();
			var fd = fromdate.split("-");
			var td = todate.split("-");
			
			if (fromdate != '' && todate != '') {
				if(fd[2]<=td[2]){
					if(fd[1]==td[1]){
						if(fd[0]<=td[0]){
							
						}else{
							setFromToDate();
						}
					}else if(fd[1]<td[1]){
						
					}else{
						setFromToDate();
					}
					
				}else{
					setFromToDate();
				}
			}else{
				
			}
		}
</script>

</head>
<body>

	<div layout:fragment="content" class="maincontent">

		<div class="container-fluid">
			<div class="row">
				<div class="maincontentsec">
					<div class="content_padding">

						<div class="d-flex justify-content-between" id="tdiv">
							<div class="btn-hs">
								<div class="font-design" id="totalReq">
									TRAVEL LIST(<span></span>)
								</div>
							</div>
							<div id="searchRowDiv">
								<div class="input-style">
									<input type="text" placeholder="Search.." name="search"
										class="searchboxinput" onkeyup="cancelBar()"
										oninput="onQuickFilterChanged()" id="quickFilter"
										autocomplete="off">
									<div class="searchicon">
										<a href="javascript:void(0)"><span
											style="display: none; border-right: 1px solid #ccc; padding-right: 5px;"
											id="closeKey"
											onclick="gridOptions.api.setQuickFilter(null);$('#quickFilter').val('');document.getElementById('closeKey').style.display='none';"
											class="close_i"><i class="ti-close srchicon"></i></span></a><a
											href="javascript:void(0)"><i class="ti-search srchicon"></i></a>
									</div>
								</div>
							</div>
							<div class="buttonsec btn-hs" id="ttbtn">
								<button class="download-btn" id="download" onclick="downloadDetails()">Download</button>
								<button class="approve-btn" id="approve" onclick="approveRequistionModal()" th:if="${hrRole != null}">Approve</button>
								<button class="reject-btn" id="reject" onclick="rejectRequistionModal()" th:if="${hrRole != null}">Reject</button>
								<button class="delete-btn" id="reqDltBtn" onclick="deleteFun()">DELETE</button>
								<button class="new-btn" id="newBtn" onclick="switchPage()">NEW</button>
							</div>
						</div>

						<input type="hidden" id="sessionId" th:value="${userId}" /> <input
							type="hidden" id="sessionName" th:value="${userName}" /> <input
							type="hidden" id="hrRole" th:value="${hrRole}" /> <input
							type="hidden" id="sessionRole" th:value="${userRole}" />
							<input type="hidden" id="adRole" th:value="${adRole}" />
						<div id="myGrid" style="width: 100%; height: 500px;"
							class="ag-theme-alpine"></div>

						<div class="collapse" id="demo">
							<div class="innercontent">
								<div class="innerstickybg">
									<div class="row">

										<div class="col-md-6">
											Requisition Id: <span id="trReqId"></span>
										</div>

										<div class="col-md-6" align="right">
											<button class="cancel-btn" id="cancelBtn" onclick="cancel()">Cancel</button>
											<button class="approve-btn" id="save" onclick="masterSaveData()">Save</button>
										</div>
									</div>

								</div>
								<div class="row innersticky_contentgap"> 
									<input type="hidden" id="travelingReqId">

									<div class="col-md-4">
										<div class="form-group">
											<label> Place Name </label> <input type="text"
												class="form-control" autocomplete="off" id="placeName"  onblur="removeValid(event)" >
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group calendar_box">
											<label>From Date</label> <input type="text" id="fromDate"
												class="form-control" onblur="removeValid(event)" 
												th:attr="onkeyup=|formatDate('fromDate','${session.DATEFORMAT_JS}')|"
												readonly> <i class="ti-calendar picker_calendar"
												id="fromDateCalendar" onchange="dateChange()"></i>
										</div>
									</div>

									<div class="col-md-4">
										<div class="form-group calendar_box">
											<label>To Date</label> <input type="text" id="toDate"
												class="form-control" onblur="removeValid(event)"
												th:attr="onkeyup=|formatDate('toDate','${session.DATEFORMAT_JS}')|"
												readonly> <i class="ti-calendar picker_calendar"
												id="toDateCalendar" onchange="dateChange()"></i>
										</div>
									</div>

									<div class="col-md-4">
										<div class="form-group">
											<label> Purpose </label>
											<textarea class="form-control" id="purpose"  onblur="removeValid(event)"></textarea>
										</div>
									</div>

									<div class="col-md-4">
										<div class="form-group">
											<label>Advance Required</label> <br> <label for="Yes">
												<input type="radio" id="Yes" value="1" name="advanceReq" />
												Yes
											</label> <label for="No"> <input type="radio" id="No"
												value="0" name="advanceReq" checked  /> No
											</label>
										</div>
									</div>
									
									<div class="col-md-4" id="amount" style="display: none;">
										<div class="form-group">
											<label>Advance Amount</label> 
											<input type="text" class="form-control" id="advanceAmount" 
											onchange="check1('advanceAmount')"  onkeyup="checkAmount1('advanceAmount')"  
											onblur="removeValid(event)">
										</div>
									</div>

								</div>
								<div id="main" class="mt-4">
									<div class="accordion-item">
										<h2 class="accordion-header" id="headingOne">
											<button class="accordion-button" type="button"
												data-bs-toggle="collapse" data-bs-target="#collapseOne"
												aria-expanded="false" aria-controls="collapseOne">
												Other Services</button>
										</h2>

										<div id="collapseOne" class="accordion-collapse collapse show"
											aria-labelledby="headingOne"
											data-bs-parent="#accordionExample">
											<div class="accordion-body">

												<div id="mySidenav" class="sidenav">
													<div class="slidebox">
														<div class="row">
															<div class="col-md-10 edit">Service Details</div>
															<div class="col-md-2">
																<div class="arrow">
																	<a href="javascript:void(0)" class="closebtn"
																		onclick="closeNav()"><i class="ti-arrow-right"></i></a>
																</div>
															</div>
														</div>
														<div style="clear: both;"></div>
														<div class="chartbtnsec">
															<div align="right">
																<button class="cancel-btn" onclick="closeNav()">CANCEL</button>
																<!-- <button class="btn3" onclick="deleteProductIndConfirm()">DELETE</button> -->
																<button class="approve-btn" id="save1"
																	onclick="saveTableData()">SAVE</button>
															</div>

														</div>
														<div class="clearfix"></div>
														<div class="row">


															<div class="col-lg-12">
																<div class="form-group">
																	<label>Service</label> <input type="text"
																		class="form-control transparenttxtbox"
																		id="serviceName"  onblur="removeValid(event)">
																</div>
															</div>

															<div class="col-lg-12">
																<div class="form-group calendar_box">
																	<label>Date</label> <input type="text" id="date"
																		class="form-control" onblur="removeValid(event)"
																		th:attr="onkeyup=|formatDate('date','${session.DATEFORMAT_JS}')|"
																		readonly> <i
																		class="ti-calendar picker_calendar" id="DateCalendar"></i>
																</div>
															</div>



															<div class="col-lg-12">
																<div class="form-group calendar_box">
																	<label>Time</label> <input type="text" id="time"
																		class="form-control" onblur="removeValid(event)"
																		th:attr="onkeyup=|formatDate('time','${session.DATEFORMAT_JS}')|"
																		readonly> <i
																		class="ti-calendar picker_calendar"
																		id="toDateCalendarTime"></i>
																</div>
															</div>


															<div class="col-lg-12">
																<div class="form-group">
																	<label>Description</label>
																	<textarea class="form-control" id="description"
																		onblur="removeValid(event)"></textarea>
																</div>
															</div>


															<!-- <div class="col-lg-12">
																<div class="form-group">
																	<label>From Place</label> <input type="text"
																		class="form-control transparenttxtbox" id="fromPlace"  onblur="removeValid(event)">
																</div>
															</div>

															<div class="col-lg-12">
																<div class="form-group">
																	<label>To Place</label> <input type="text"
																		class="form-control transparenttxtbox" id="toPlace"  onblur="removeValid(event)">
																</div>
															</div> -->

														</div>
													</div>
												</div>


												<div class="row">
													<div class="col-md-12 buttonsec btn-hs">
														<button class="delete-btn" id="deleteChild" onclick="deleteDetails()">DELETE</button>
														<button class="new-btn" id="newchild" onclick="openNav()">NEW</button>
													</div>
													<div id="activity" style="width: 100%; height: 200px;"
														class="ag-theme-alpine"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>


				<!-- delete modal start -->
				<div id="delete" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column">
			
							</div>
							<div class="modal-body">
								<p>Do you really want to delete these records? This process
									cannot be undone.</p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: 0px;">

								<button type="button" class="cancel-btn" data-bs-dismiss="modal"
									onclick="cancelModalBtn();">Cancel</button>
								<button type="button" class="delete-btn" onclick="deleteOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>

				<!-- delete product modal start -->
				<div id="deleteDetails" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column"></div>
							<div class="modal-body">
								<p>Do you really want to delete these records? This process
									cannot be undone.</p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: -30px;">

								<button type="button" class="cancel-btn" data-bs-dismiss="modal"
									onclick="cancelModalBtn();">Cancel</button>
								<button type="button" class="delete-btn"
									onclick="deleteDetailsOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>




				<!-- alert modal start -->
				<div id="alert" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column">
								<button type="button" class="close" data-bs-dismiss="modal"
									aria-hidden="true" onclick="cancelModalBtn()">
									<i class="ti-close modal-close"></i>
								</button>
							</div>
							<div class="modal-body">
								<p id="textId"></p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: 0px;">

								<button type="button" class="btn1" data-bs-dismiss="modal">SELECT</button>
								<button type="button" class="btn3" onclick="deleteOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>
				<!-- ------------------Comment modal------------------------- -->

				<div id="commentModal" class="modal fade">
					<div class="modal-dialog">
						<!-- Modal content-->
						<div class="modal-content">
							<div class="modal-header">
								<h4 class="modal-title">Approve/Reject Comment</h4>
								

							</div>
							<div class="modal-body">
								<!-- text input -->
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label>Comment</label> <input class="form-control"
												type="text" id="comment">
										</div>
									</div>

								</div>
							</div>
							<div class="modal-footer justify-content-left">
								<button type="button" class="btn1" data-bs-dismiss="modal"
									aria-hidden="true" id="approveLeaveSubmitBtn"
									onclick="approveRequisition()">Submit</button>
								<button type="button" class="btn1" data-bs-dismiss="modal"
									aria-hidden="true" id="rejectLeaveSubmitBtn"
									onclick="rejectRequsition()">Submit</button>
							</div>
						</div>
					</div>
				</div>
					<!-- ------------------date modal------------------------- -->

					<div id="dateModal" class="modal fade show" aria-modal="true">
						<div class="modal-dialog modal-confirm">
							<div class="modal-content">
								<div class="modal-header flex-column">
									<button type="button" class="close" data-bs-dismiss="modal"
										aria-hidden="true" onclick="cancelModalDeleteBtn()">
									</button>
								</div>
								<div class="modal-body">
									<p>Please choose to date greater than or equal to from date</p>
								</div>
								<div class="modal-footer justify-content-center"
									style="margin-top: -30px;">

									<button type="button" class="btn1"
										onclick="okModalDateBtnOnclick()">OK</button>
								</div>
							</div>
						</div>
					</div>

			</div>
		</div>
	</div>

</body>
</html>