<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/master}">
<head>
<style type="text/css">
.highcharts-exporting-group {
	display: none;
}

.slidebox {
	padding: 14px;
	margin-top: 0px;
	margin: 0px 10px;
}

.holdCls {
	background-color: rgb(0, 143, 0);
}

.bg_white {
	background: #ffffff !important;
}
.totalHour {
 border: 1px solid #ddd;
  border-radius: 2px; 
  background-color: #f5f5f5; 
  padding: 10px; 
  font-size: 12px;
  color: #333;
  transition: border-color 0.3s ease-in-out;
    width: 65px;
    height: 23px;
}
.defectDesc{
 border: 1px solid #ddd;
  border-radius: 2px; 
  background-color: #f5f5f5; 
  padding: 10px; 
  font-size: 12px;
  color: #333;
  transition: border-color 0.3s ease-in-out;
    width: 671px;
    height: 22px;
}
.sample-chk .form-control {
    border-right: none;
    border: 1px solid #d5d5d5 !important;
    border-radius:5px;
    background:#fbfbfb;
}

</style>

<script type="text/javascript">

	$(document).ready(function() {
		var gridDiv = document.querySelector('#myGrid');
		new agGrid.Grid(gridDiv, gridOptions);
		gridOptions.api.setRowData();
		agGrid.simpleHttpRequest({
			url : 'crqs-details-view'
		}).then(function(data) {
			var jsonData = JSON.parse(data.body[0]);
			var allData=jsonData.view;
			console.log(allData)
			var len = allData.length;
			$('#totalReq').find('span').html(len);
			gridOptions.api.setRowData(allData);
		});
		var gridDiv = document.querySelector('#activity');
		new agGrid.Grid(gridDiv, activityOptions);
		var gridDiv = document.querySelector('#activity1');
		new agGrid.Grid(gridDiv, activityOptions1);
		var gridDiv = document.querySelector('#activity2');
		new agGrid.Grid(gridDiv, activityOptions2);
		var gridDiv1 = document.querySelector('#myGridInspect');
		new agGrid.Grid(gridDiv1, inspectOptions);
		//activityOptions.api.setRowData();
		$('#myModal10').modal('hide');
		$('#reqDltBtn').attr('disabled', true);
		$('#inspectBtn').attr('disabled', true);
		$('#assignBtn').attr('disabled', true);
		$('#deleteChild').attr('disabled', true);
		$('.collapse').on('show.bs.collapse', function() {
			$(this).siblings('.panel-heading').addClass('active');
		});

		$('.collapse').on('hide.bs.collapse', function() {
			$(this).siblings('.panel-heading').removeClass('active');
		});
		$("#newBtn").click(function() {

		})
		
		
		var dateFormat = localStorage.getItem("dateFormat");
		$("#DateCalendar3").datetimepicker({
			format : dateFormat,
			closeOnDateSelect : true,
			timepicker : false,
		}).on("change", function() {
			$('#pdate').val($(this).val());
		})

		$('#pdate').blur(function() {
			$("#DateCalendar3").val($(this).val());
		})

		


	});
	
	
	
	/* -------------------search bar for mygrid------------------------ */

	function onQuickFilterChanged() {
		gridOptions.api
				.setQuickFilter(document.getElementById('quickFilter').value);
	}

	function cancelBar() {
		var id = document.getElementById("closeKey");
		id.style.display = "block";

		if ($('#quickFilter').val() == null || $('#quickFilter').val() == "") {
			id.style.display = "none";
		}
	}
	var columnDefs = [
		{
			headerCheckboxSelection : false,
			headerCheckboxSelectionFilteredOnly : false,
			checkboxSelection : true,
			width : 10,
			sortable : false,
			filter : false,
			resizable : true,
			pinned: 'left',

		},
		{
			headerName : 'CRQS Id',
			width : 150,
			pinned: 'left',
			field : "crqsId",
				cellRenderer : function(params) {
				return '<a id="crqsId" onclick=editCRQS("'
				+params.data.crqsId
				+ '") href="javascript:void(0)">'
				+ params.data.crqsId + '</a>';

			}

		}, {
			headerName : 'Factory',
			field : "factory",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'M/C No',
			field : "mcno",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Packing Technology',
			field : "packtech",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Category',
			field : "category",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Brand',
			field : "brand",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Packing Size',
			field : "packsize",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Variant',
			field : "variant",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Date',
			field : "date",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Shift',
			field : "shift",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Name Of SI',
			field : "namesi",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'Approve Status',
			field : "approvests",
			cellStyle : {
				textAlign : 'center'
			},cellRenderer : function(params) {
				if(params.data.apstatus=="1"){
					return '<div style="color:#0642f5">Approved</div>';
				}else{
					return '<div style="color:#a9a9a9">Pending</div>';
				}
				

			}
		}, {
			headerName : 'PDF',
			field : "downloaddoc",
			cellStyle : {
				textAlign : 'center'
			},cellRenderer : function(params) {
				if(params.data.apstatus==1){
					return '<a id="crqsId" onclick=crqsPdfDownload("'
					+params.data.crqsId
					+ '") href="javascript:void(0)"><i class="bi bi-cloud-download">Download</i></a>';
				}else{
					return '';
				}
				

			}
		}];

// let the grid know which columns and what data to use
var gridOptions = {
	columnDefs : columnDefs,
	rowSelection : 'single',
	groupSelectsChildren : true,
	suppressRowClickSelection : true,
	suppressAggFuncInHeader : true,
	defaultColDef : {
		sortable : true,
		filter : true,
		resizable : true,
		width : 150
	},
	onSelectionChanged : onSelectionChanged,
};
//function for row select parents
var id = "";
var apstatus="";
function onSelectionChanged() {
	var selectedNodes = gridOptions.api.getSelectedNodes();
	 var selectedData = selectedNodes.map(node => node.data);
	 id= selectedData.map(node => node.crqsId);
	 apstatus=selectedData.map(node => node.apstatus);
	var selectedRows = gridOptions.api.getSelectedRows();
	var rowCount = 0;
	selectedRows.forEach(function(i) {
		rowCount = rowCount + 1;
	});
	if (rowCount > 0) {
		$('#inspectBtn').attr("disabled", false);
		if(apstatus==1){
			$('#reqDltBtn').attr("disabled", true);
			$('#assignBtn').attr("disabled", true);
			$('#newBtn').attr('disabled', false);
		}else{
		$('#newBtn').attr('disabled', true);
		$('#reqDltBtn').attr("disabled", false);
		$('#assignBtn').attr("disabled", false);
		}
	}else {
		$('#inspectBtn').attr("disabled", true);
		$('#reqDltBtn').attr("disabled", true);
		$('#assignBtn').attr("disabled", true);
		$('#newBtn').attr('disabled', false);
	}
}
// for activity table
var activityDefs = [
	{
		headerName : "Property",
		field : "property",
		width : 100
	},{
		headerName : "Quality Issue",
		field : "qaissues",
		width : 120

	}, {
			headerName : "1-2 Hours",
			field : "s1",
			children: [
		        {   headerName : "Red",
		        	field: 'red1' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red1+'"  id="'+"red1"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber1' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber1+'"  id="'+"amber1"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green1' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green1+'"  id="'+"green1"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],
			},{
			headerName : "3 - 4 Hours",
			field : "s2",
			children: [
		        { headerName : "Red",
		        	field: 'red2' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red2+'"  id="'+"red2"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber2' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber2+'"  id="'+"amber2"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green2' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green2+'"  id="'+"green2"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],
			},{
				headerName : "5 - 6 Hours",
				field : "s3",
				children: [
			        { headerName : "Red",
			        	field: 'red3' ,
						cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red3+'"  id="'+"red3"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			        { headerName : "Amber",
			        	field: 'amber3' ,
			        	cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber3+'"  id="'+"amber3"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			        { headerName : "Green",
			        	field: 'green3' ,
			        	cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green3+'"  id="'+"green3"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			      ],
		},{
			headerName : "7 - 8 Hours",
			field : "s4",
			children: [
		        { headerName : "Red",
		        	field: 'red4' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red4+'"  id="'+"red4"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber4' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber4+'"  id="'+"amber4"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green4' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green4+'"  id="'+"green4"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],

	}];


//let the grid know which columns and what data to use product table
var activityOptions = {
	columnDefs : activityDefs,
	rowSelection : 'single',
	groupSelectsChildren : true,
	suppressRowClickSelection : true,
	suppressAggFuncInHeader : true,
	defaultColDef : {
		sortable : true,
		filter : true,
		resizable : true,
		width : 80
	}
};




//for activity table
var activityDefs1 = [
	{
		headerName : "Property",
		field : "property",
		width : 100
	},{
		headerName : "Quality Issue",
		field : "qaissues",
		width : 120

	}, {
			headerName : "1-2 Hours",
			field : "s1",
			children: [
		        {   headerName : "Red",
		        	field: 'red1' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red1+'"  id="'+"red5"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber1' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber1+'"  id="'+"amber5"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green1' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green1+'"  id="'+"green5"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],
			},{
			headerName : "2 - 3 Hours",
			field : "s2",
			children: [
		        { headerName : "Red",
		        	field: 'red2' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red2+'"  id="'+"red6"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber2' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber2+'"  id="'+"amber6"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green2' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green2+'"  id="'+"green6"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],
			},{
				headerName : "3 - 4 Hours",
				field : "s3",
				children: [
			        { headerName : "Red",
			        	field: 'red3' ,
						cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red3+'"  id="'+"red7"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			        { headerName : "Amber",
			        	field: 'amber3' ,
			        	cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber3+'"  id="'+"amber7"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			        { headerName : "Green",
			        	field: 'green3' ,
			        	cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green3+'"  id="'+"green7"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			      ],
		},{
			headerName : "4 - 5 Hours",
			field : "s4",
			children: [
		        { headerName : "Red",
		        	field: 'red4' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red4+'"  id="'+"red8"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber4' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber4+'"  id="'+"amber8"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green4' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green4+'"  id="'+"green8"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],

	}];


//let the grid know which columns and what data to use product table
var activityOptions1 = {
	columnDefs : activityDefs1,
	rowSelection : 'single',
	groupSelectsChildren : true,
	suppressRowClickSelection : true,
	suppressAggFuncInHeader : true,
	defaultColDef : {
		sortable : true,
		filter : true,
		resizable : true,
		width : 80
	}
};


var activityDefs2 = [
		{
			headerName : "Property",
			field : "property",
			width : 100
		},{
			headerName : "Quality Issue",
			field : "qaissues",
			width : 120

		}, {
			headerName : "1-2 Hours",
			field : "s1",
			children: [
		        {   headerName : "Red",
		        	field: 'red1' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red1+'"  id="'+"red9"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber1' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber1+'"  id="'+"amber9"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green1' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green1+'"  id="'+"green9"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],
			},{
			headerName : "3 - 4 Hours",
			field : "s2",
			children: [
		        { headerName : "Red",
		        	field: 'red2' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red2+'"  id="'+"red10"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber2' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber2+'"  id="'+"amber10"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green2' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green2+'"  id="'+"green10"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],
			},{
				headerName : "5 - 6 Hours",
				field : "s3",
				children: [
			        { headerName : "Red",
			        	field: 'red3' ,
						cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red3+'"  id="'+"red11"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			        { headerName : "Amber",
			        	field: 'amber3' ,
			        	cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber3+'"  id="'+"amber11"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			        { headerName : "Green",
			        	field: 'green3' ,
			        	cellRenderer : function(params) {
								return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green3+'"  id="'+"green11"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
						}	
			        },
			      ],
		},{
			headerName : "7 - 8 Hours",
			field : "s4",
			children: [
		        { headerName : "Red",
		        	field: 'red4' ,
					cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.red4+'"  id="'+"red12"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Amber",
		        	field: 'amber4' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.amber4+'"  id="'+"amber12"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		        { headerName : "Green",
		        	field: 'green4' ,
		        	cellRenderer : function(params) {
							return '<input type="text" class="totalHour"  name="numHour" value="'+params.data.green4+'"  id="'+"green12"+(parseInt(params.data.s0)-1)+'" onkeydown="handleTextFieldKeyDown(event)">';
					}	
		        },
		      ],

	}];


//let the grid know which columns and what data to use product table
var activityOptions2 = {
	columnDefs : activityDefs2,
	rowSelection : 'single',
	groupSelectsChildren : true,
	suppressRowClickSelection : true,
	suppressAggFuncInHeader : true,
	defaultColDef : {
		sortable : true,
		filter : true,
		resizable : true,
		width : 80
	}
};


var inspectDefs = [ {
	headerName : 'Defect',
	field : "defect",
}, {
	headerName : 'Description',
	field : "desc",
	width : 685,
	cellRenderer : function(params) {
		console.log(params);
		if(params.data.approvests==1){
			return '<input type="text" class="defectDesc" value="'+params.data.desc+'" readonly>';
		}else{
			return '<input type="text" class="defectDesc" name="desc" value="'+params.data.desc+'" id="'+"defDesc"+params.rowIndex+'">';
		}
			
	}
} ];

// let the grid know which columns and what data to use product table
var inspectOptions = {
	columnDefs : inspectDefs,
	rowSelection : 'multiple',
	groupSelectsChildren : true,
	suppressRowClickSelection : true,
	suppressAggFuncInHeader : true,
	defaultColDef : {
		sortable : true,
		filter : true,
		resizable : true,
		width : 300,
		height : 10
	}
};


//parents new plan
function newPlan() {
    var currentDate = new Date();
    var formattedDate = currentDate.getDate() + "-" + (currentDate.getMonth() + 1) + "-" + currentDate.getFullYear();
    $('#pdate').val(formattedDate);
	$("#myGrid").hide();
	$("#reqTable").hide();
	$(".btn-hs").show();
	$("#btndiv").hide();
	$("#listdiv").hide();
	$("#totalReq").hide();
	$("#searchRowDiv").hide();
	$("#ttbtn").hide();
	$("#demo").show();
	$("#deleteChild").attr('disabled', true);
	$("#newchild").attr('disabled', false);
	$("#save").attr('disabled', false);
	showGridRow();
}
//function for cancel
function cancel() {

	 $(".formValidation").remove();
		$("#totalReq").show();
		$("#searchRowDiv").show();
		$(".btn-hs").show();
		$("#myGrid").show();
		$("#demo").hide();
		$("#reqDltBtn").attr('disabled', true);
		$("#assignBtn").attr('disabled', true);
		$("#newBtn").attr('disabled', false);
		agGrid.simpleHttpRequest({
			url : 'crqs-details-view'
		}).then(function(data) {
			var jsonData = JSON.parse(data.body[0]);
			var allData=jsonData.view;
			console.log(allData)
			var len = allData.length;
			$('#totalReq').find('span').html(len);
			gridOptions.api.setRowData(allData);
		});

		$("#crqsbox").html("");
		$("#crqsId").val("");
		$("#pdate").val("");
		$("#shift").val("");
		$("#mcname").val("");
		$("#mcno").val("");
		$("#product").val("");
		$("#variant").val("");
		$("#formulation").val("");
		$("#packsize").val("");
		$("#mrp").val("");
		
		$("#packtech").val("");
		$("#category").val("");
		$("#nameofsi").val("");
		$("#sealwidth").val("");
		$("#horizontal").val("");
		$("#vertical").val("");
		$("#gap").val("");

		$('#nodefectobserved1').val("");
		$('#nodefectobserved2').val("");
		$("#nodefectobserved3").val("");
		$("#nodefectobserved4").val("");
		$("#nodefectobserved5").val("");
		$("#nodefectobserved6").val("");
		$("#nodefectobserved7").val("");
		$("#nodefectobserved8").val("");
		$("#nodefectobserved9").val("");
		$("#nodefectobserved10").val("");
		$("#nodefectobserved11").val("");
		$("#nodefectobserved12").val("");
		
		$('#defectpercent1').val("");
		$('#defectpercent2').val("");
		$("#defectpercent3").val("");
		$("#defectpercent4").val("");
		$("#defectpercent5").val("");
		$("#defectpercent6").val("");
		$("#defectpercent7").val("");
		$("#defectpercent8").val("");
		$("#defectpercent9").val("");
		$("#defectpercent10").val("");
		$("#defectpercent11").val("");
		$("#defectpercent12").val("");
		
		$('#totalsamplechecked1').val("");
		$('#totalsamplechecked2').val("");
		$("#totalsamplechecked3").val("");
		$("#totalsamplechecked4").val("");
		$("#qcstatus1").val("");
		$("#qcstatus2").val("");
		$("#qcstatus3").val("");
		$("#qcstatus4").val("");
		
		$("#sack").val("");
		$("#pouch").val("");
		$("#mc").val("");
	}

//master save data
function masterSaveData() {
	$(".formValidation").remove();
	var valid= true;
	var datas = [];
	var i=-1;
	var rowCount = activityOptions.api.getDisplayedRowCount();
	if(rowCount > 0){
	activityOptions.api.forEachNode(function(rowNode, index) {
		var item = rowNode.data;
		item.defecttype = "OPD";
		item.red1 = $('#red1'+index).val();
		item.amber1 = $('#amber1'+index).val();
		item.green1 = $("#green1"+index).val();
		item.red2 = $("#red2"+index).val();
		item.amber2 = $("#amber2"+index).val();
		item.green2 = $("#green2"+index).val();
		item.red3 = $("#red3"+index).val();
		item.amber3 = $("#amber3"+index).val();
		item.green3 = $("#green3"+index).val();
		item.red4 = $("#red4"+index).val();
		item.amber4 = $("#amber4"+index).val();
		item.green4 = $("#green4"+index).val();
		
		console.log("rowNode",item);
		item.crqsId = $("#crqsId").val();
		item.factory = $("#factory").val();
		item.pdate = $("#pdate").val();
		item.shift = $("#shift").val();
		item.mcno = $("#mcno").val();
		item.product = $("#product").val();
		item.variant = $("#variant").val();
		item.category =$("#category").val();
		item.packsize =$("#packsize").val();
		item.nameofsi =$("#nameofsi").val();
		item.packtech =$("#packtech").val();
		item.sealwidth = $("#sealwidth").val();
		item.horizontal =$("#horizontal").val();
		item.vertical =$("#vertical").val();
		item.gap =$("#gap").val();
		item.mrp =$("#mrp").val();
		
		
		item.nodefectobserved1 = parseInt($('#nodefectobserved1').val());
		item.nodefectobserved2 = parseInt($('#nodefectobserved2').val());
		item.nodefectobserved3 = parseInt($("#nodefectobserved3").val());
		item.nodefectobserved4 = parseInt($("#nodefectobserved4").val());
		item.nodefectobserved5 = parseInt($("#nodefectobserved5").val());
		item.nodefectobserved6 = parseInt($("#nodefectobserved6").val());
		item.nodefectobserved7 = parseInt($("#nodefectobserved7").val());
		item.nodefectobserved8 = parseInt($("#nodefectobserved8").val());
		item.nodefectobserved9 = parseInt($("#nodefectobserved9").val());
		item.nodefectobserved10 = parseInt($("#nodefectobserved10").val());
		item.nodefectobserved11 = parseInt($("#nodefectobserved11").val());
		item.nodefectobserved12 = parseInt($("#nodefectobserved12").val());
		
		item.defectpercent1 = $('#defectpercent1').val();
		item.defectpercent2 = $('#defectpercent2').val();
		item.defectpercent3 = $("#defectpercent3").val();
		item.defectpercent4 = $("#defectpercent4").val();
		item.defectpercent5 = $("#defectpercent5").val();
		item.defectpercent6 = $("#defectpercent6").val();
		item.defectpercent7 = $("#defectpercent7").val();
		item.defectpercent8 = $("#defectpercent8").val();
		item.defectpercent9 = $("#defectpercent9").val();
		item.defectpercent10 = $("#defectpercent10").val();
		item.defectpercent11 = $("#defectpercent11").val();
		item.defectpercent12 = $("#defectpercent12").val();
		
		item.totalsamplechecked1 = parseInt($('#totalsamplechecked1').val());
		item.totalsamplechecked2 = parseInt($('#totalsamplechecked2').val());
		item.totalsamplechecked3 = parseInt($("#totalsamplechecked3").val());
		item.totalsamplechecked4 = parseInt($("#totalsamplechecked4").val());
		item.qcstatus1 = $("#qcstatus1").val();
		item.qcstatus2 = $("#qcstatus2").val();
		item.qcstatus3 = $("#qcstatus3").val();
		item.qcstatus4 = $("#qcstatus4").val();
		
		item.sack = $("#sack").val();
		item.pouch = $("#pouch").val();
		item.mc = $("#mc").val();
		
		

		if (item.pdate == null || item.pdate == "") {
			valid = validationUpdated("Production Date is Required", "pdate");
		 }
		if (item.shift == null || item.shift == "") {
			valid = validationUpdated("Shift Details is Required", "shift");
		 }
		if (item.mcno == null || item.mcno == "") {
			valid = validationUpdated("Machine No. is Required", "mcno");
		 }
		if (item.product == null || item.product == "") {
			valid = validationUpdated("Product Name is Required", "product");
		 }
		if (item.variant == null || item.variant == "") {
			valid = validationUpdated("Product Variant is Required", "variant");
		 }
		if (item.category == null || item.category == "") {
			valid = validationUpdated("Category is Required", "category");
		 }
		if (item.packsize == null || item.packsize == "") {
			valid = validationUpdated("Packing Size is Required", "packsize");
		 }
		if (item.mrp == null || item.mrp == "") {
			valid = validationUpdated("MRP is Required", "mrp");
		 }
		if (item.nameofsi == null || item.nameofsi == "") {
			valid = validationUpdated("Name of SI is Required", "nameofsi");
		 }
		if (item.packtech == null || item.packtech == "") {
			valid = validationUpdated("Packing Technology Status is Required", "packtech");
		 }
		if (item.sealwidth == null || item.sealwidth == "") {
			valid = validationUpdated("Seal Width Status is Required", "sealwidth");
		 }
		if (item.horizontal == null || item.horizontal == "") {
			valid = validationUpdated("Horizontal is Required", "horizontal");
		 }
		if (item.vertical == null || item.vertical == "") {
			valid = validationUpdated("Vertical is Required", "vertical");
		 }
		if (item.gap == null || item.gap == "") {
			valid = validationUpdated("Gap is Required", "gap");
		 }
		if (item.sack == null || item.sack == "") {
			valid = validationUpdated("Sack is Required", "sack");
		 }
		if (item.pouch == null || item.pouch == "") {
			valid = validationUpdated("Pouch is Required", "pouch");
		 }
		if (item.mc == null || item.mc == "") {
			valid = validationUpdated("M/C is Required", "mc");
		 }

		
        if(valid){
        	datas.push(item);
         }
	});
	activityOptions1.api.forEachNode(function(rowNode, index) {
		var item = rowNode.data;
		item.defecttype = "IPD";
		item.red1 = $('#red5'+index).val();
		item.amber1 = $('#amber5'+index).val();
		item.green1 = $("#green5"+index).val();
		item.red2 = $("#red6"+index).val();
		item.amber2 = $("#amber6"+index).val();
		item.green2 = $("#green6"+index).val();
		item.red3 = $("#red7"+index).val();
		item.amber3 = $("#amber7"+index).val();
		item.green3 = $("#green7"+index).val();
		item.red4 = $("#red8"+index).val();
		item.amber4 = $("#amber8"+index).val();
		item.green4 = $("#green8"+index).val();
		
		console.log("rowNode",item);
		item.crqsId = $("#crqsId").val();
		item.factory = $("#factory").val();
		item.pdate = $("#pdate").val();
		item.shift = $("#shift").val();
		item.mcno = $("#mcno").val();
		item.product = $("#product").val();
		item.variant = $("#variant").val();
		item.category =$("#category").val();
		item.packsize =$("#packsize").val();
		item.nameofsi =$("#nameofsi").val();
		item.packtech =$("#packtech").val();
		item.sealwidth = $("#sealwidth").val();
		item.horizontal =$("#horizontal").val();
		item.vertical =$("#vertical").val();
		item.gap =$("#gap").val();
		item.mrp =$("#mrp").val();
		


		
		item.nodefectobserved1 = parseInt($('#nodefectobserved1').val());
		item.nodefectobserved2 = parseInt($('#nodefectobserved2').val());
		item.nodefectobserved3 = parseInt($("#nodefectobserved3").val());
		item.nodefectobserved4 = parseInt($("#nodefectobserved4").val());
		item.nodefectobserved5 = parseInt($("#nodefectobserved5").val());
		item.nodefectobserved6 = parseInt($("#nodefectobserved6").val());
		item.nodefectobserved7 = parseInt($("#nodefectobserved7").val());
		item.nodefectobserved8 = parseInt($("#nodefectobserved8").val());
		item.nodefectobserved9 = parseInt($("#nodefectobserved9").val());
		item.nodefectobserved10 = parseInt($("#nodefectobserved10").val());
		item.nodefectobserved11 = parseInt($("#nodefectobserved11").val());
		item.nodefectobserved12 = parseInt($("#nodefectobserved12").val());
		
		item.defectpercent1 = $('#defectpercent1').val();
		item.defectpercent2 = $('#defectpercent2').val();
		item.defectpercent3 = $("#defectpercent3").val();
		item.defectpercent4 = $("#defectpercent4").val();
		item.defectpercent5 = $("#defectpercent5").val();
		item.defectpercent6 = $("#defectpercent6").val();
		item.defectpercent7 = $("#defectpercent7").val();
		item.defectpercent8 = $("#defectpercent8").val();
		item.defectpercent9 = $("#defectpercent9").val();
		item.defectpercent10 = $("#defectpercent10").val();
		item.defectpercent11 = $("#defectpercent11").val();
		item.defectpercent12 = $("#defectpercent12").val();
		
		item.totalsamplechecked1 = parseInt($('#totalsamplechecked1').val());
		item.totalsamplechecked2 = parseInt($('#totalsamplechecked2').val());
		item.totalsamplechecked3 = parseInt($("#totalsamplechecked3").val());
		item.totalsamplechecked4 = parseInt($("#totalsamplechecked4").val());
		item.qcstatus1 = $("#qcstatus1").val();
		item.qcstatus2 = $("#qcstatus2").val();
		item.qcstatus3 = $("#qcstatus3").val();
		item.qcstatus4 = $("#qcstatus4").val();
		
		item.sack = $("#sack").val();
		item.pouch = $("#pouch").val();
		item.mc = $("#mc").val();
		
        if(valid){
        	datas.push(item);
         }
	});
	
	activityOptions2.api.forEachNode(function(rowNode, index) {
		
		var item = rowNode.data;
		item.defecttype = "OCD";
		item.red1 = $('#red9'+index).val();
		item.amber1 = $('#amber9'+index).val();
		item.green1 = $("#green9"+index).val();
		item.red2 = $("#red10"+index).val();
		item.amber2 = $("#amber10"+index).val();
		item.green2 = $("#green10"+index).val();
		item.red3 = $("#red11"+index).val();
		item.amber3 = $("#amber11"+index).val();
		item.green3 = $("#green11"+index).val();
		item.red4 = $("#red12"+index).val();
		item.amber4 = $("#amber12"+index).val();
		item.green4 = $("#green12"+index).val();
		
		console.log("rowNode",item);
		item.crqsId = $("#crqsId").val();
		item.factory = $("#factory").val();
		item.pdate = $("#pdate").val();
		item.shift = $("#shift").val();
		item.mcno = $("#mcno").val();
		item.product = $("#product").val();
		item.variant = $("#variant").val();
		item.category =$("#category").val();
		item.packsize =$("#packsize").val();
		item.nameofsi =$("#nameofsi").val();
		item.packtech =$("#packtech").val();
		item.sealwidth = $("#sealwidth").val();
		item.horizontal =$("#horizontal").val();
		item.vertical =$("#vertical").val();
		item.gap =$("#gap").val();
		item.mrp =$("#mrp").val();
		
		
		
		
		
		item.nodefectobserved1 = parseInt($('#nodefectobserved1').val());
		item.nodefectobserved2 = parseInt($('#nodefectobserved2').val());
		item.nodefectobserved3 = parseInt($("#nodefectobserved3").val());
		item.nodefectobserved4 = parseInt($("#nodefectobserved4").val());
		item.nodefectobserved5 = parseInt($("#nodefectobserved5").val());
		item.nodefectobserved6 = parseInt($("#nodefectobserved6").val());
		item.nodefectobserved7 = parseInt($("#nodefectobserved7").val());
		item.nodefectobserved8 = parseInt($("#nodefectobserved8").val());
		item.nodefectobserved9 = parseInt($("#nodefectobserved9").val());
		item.nodefectobserved10 = parseInt($("#nodefectobserved10").val());
		item.nodefectobserved11 = parseInt($("#nodefectobserved11").val());
		item.nodefectobserved12 = parseInt($("#nodefectobserved12").val());
		
		item.defectpercent1 = $('#defectpercent1').val();
		item.defectpercent2 = $('#defectpercent2').val();
		item.defectpercent3 = $("#defectpercent3").val();
		item.defectpercent4 = $("#defectpercent4").val();
		item.defectpercent5 = $("#defectpercent5").val();
		item.defectpercent6 = $("#defectpercent6").val();
		item.defectpercent7 = $("#defectpercent7").val();
		item.defectpercent8 = $("#defectpercent8").val();
		item.defectpercent9 = $("#defectpercent9").val();
		item.defectpercent10 = $("#defectpercent10").val();
		item.defectpercent11 = $("#defectpercent11").val();
		item.defectpercent12 = $("#defectpercent12").val();
		
		item.totalsamplechecked1 = parseInt($('#totalsamplechecked1').val());
		item.totalsamplechecked2 = parseInt($('#totalsamplechecked2').val());
		item.totalsamplechecked3 = parseInt($("#totalsamplechecked3").val());
		item.totalsamplechecked4 = parseInt($("#totalsamplechecked4").val());
		item.qcstatus1 = $("#qcstatus1").val();
		item.qcstatus2 = $("#qcstatus2").val();
		item.qcstatus3 = $("#qcstatus3").val();
		item.qcstatus4 = $("#qcstatus4").val();
		
		item.sack = $("#sack").val();
		item.pouch = $("#pouch").val();
		item.mc = $("#mc").val();
		
        if(valid){
        	datas.push(item);
         }
	});
	if (valid) {
		savePlanDetails(datas);
		
		}
	} else {
		$("#messageParagraph").text(
		"Please Add Atleast One Plan Details");
		$("#msgOkModal").removeClass("btn3");
		$("#msgOkModal").addClass("btn1");
		$("#msgModal").modal('show');
	}
	console.log("data",datas);
}

function savePlanDetails(datas) {
	$('.loader').show();
	$.ajax({
		type : "POST",
		url : "crqs-details-add",
		dataType : "json",
		contentType : "application/json",
		data : JSON.stringify(datas),
		success : function(response) {
			$('.loader').hide();
			var itemName = $("#itemname option:selected").text();
			if (response.code == "success") {
				cancel()
				$("#messageParagraph").text(response.message);
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');
				agGrid.simpleHttpRequest({
					url : 'crqs-details-view'
				}).then(function(data) {
					var jsonData = JSON.parse(data.body[0]);
					var allData=jsonData.view;
					console.log(allData)
					var len = allData.length;
					$('#totalReq').find('span').html(len);
					gridOptions.api.setRowData(allData);
				});
				
			} else {
				$('.loader').hide();
				$("#messageParagraph").text("Test Parameter For "+itemName+" Already Exist.");
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');
				
				$("#itemid").val('');
				$("#itemname").val('');
				$("#description").val('');
				activityOptions.api.setRowData();
			}
		},
		error : function(data) {
			$('.loader').hide();
		}
	})

}

function showGridRow() {
  var datas = [];
  var item = {};
  agGrid.simpleHttpRequest({
		url : 'crqs-aggrid-show'
	}).then(function(data) {
		var jsonData = JSON.parse(data.body[0]);
		var allData1=jsonData.OPD;
		var allData2=jsonData.IPD;
		var allData3=jsonData.OCD;
		console.log(allData1);
		console.log("dataccc",datas);
		activityOptions.api.setRowData(allData1);
		activityOptions1.api.setRowData(allData2);
		activityOptions2.api.setRowData(allData3);
	});
  	
	
}

	//editing the qc master parent table
	function editCRQS(crqsid) {
		  
		agGrid.simpleHttpRequest(
				{
					url : 'crqs-reqst-edit?id='+ crqsid
				}).then(function(data) {
					var jsonData = JSON.parse(data.body);
					var allData=jsonData.OPD;
					var allData1=jsonData.IPD;
					var allData2=jsonData.OCD;
					var footdata=jsonData.CFD;
					console.log("allData",allData);
					console.log("allData1",allData1);
					console.log("footdata",footdata);
					$("#myGrid").hide();
					$("#demo").show();
					activityOptions.api.setRowData(allData);
					activityOptions1.api.setRowData(allData1);
					activityOptions2.api.setRowData(allData2);
					var rowCount = activityOptions.api.getDisplayedRowCount();
					$("#crqsbox").html(allData[0].crqsId);
					$("#crqsId").val(allData[0].crqsId);
					$("#pdate").val(allData[0].date);
					$("#shift").val(allData[0].shift);
					$("#mcname").val(allData[0].mcname);
					$("#mcno").val(allData[0].mcno);
					$("#product").val(allData[0].variant);
					$("#variant").val(allData[0].brand);
					$("#formulation").val(allData[0].formulation);
					$("#packsize").val(allData[0].packsize);
					$("#mrp").val(allData[0].mrp);
					
					$("#packtech").val(allData[0].packtech);
					$("#category").val(allData[0].category);
					$("#nameofsi").val(allData[0].namesi);
					$("#sealwidth").val(allData[0].sealwidth);
					$("#horizontal").val(allData[0].horizontal);
					$("#vertical").val(allData[0].vertical);
					$("#gap").val(allData[0].gap);

					$('#nodefectobserved1').val(footdata[0].nodefectobserved1);
					$('#nodefectobserved2').val(footdata[0].nodefectobserved2);
					$("#nodefectobserved3").val(footdata[0].nodefectobserved3);
					$("#nodefectobserved4").val(footdata[0].nodefectobserved4);
					$("#nodefectobserved5").val(footdata[0].nodefectobserved5);
					$("#nodefectobserved6").val(footdata[0].nodefectobserved6);
					$("#nodefectobserved7").val(footdata[0].nodefectobserved7);
					$("#nodefectobserved8").val(footdata[0].nodefectobserved8);
					$("#nodefectobserved9").val(footdata[0].nodefectobserved9);
					$("#nodefectobserved10").val(footdata[0].nodefectobserved10);
					$("#nodefectobserved11").val(footdata[0].nodefectobserved11);
					$("#nodefectobserved12").val(footdata[0].nodefectobserved12);
					
					$('#defectpercent1').val(footdata[0].defectpercent1);
					$('#defectpercent2').val(footdata[0].defectpercent2);
					$("#defectpercent3").val(footdata[0].defectpercent3);
					$("#defectpercent4").val(footdata[0].defectpercent4);
					$("#defectpercent5").val(footdata[0].defectpercent5);
					$("#defectpercent6").val(footdata[0].defectpercent6);
					$("#defectpercent7").val(footdata[0].defectpercent7);
					$("#defectpercent8").val(footdata[0].defectpercent8);
					$("#defectpercent9").val(footdata[0].defectpercent9);
					$("#defectpercent10").val(footdata[0].defectpercent10);
					$("#defectpercent11").val(footdata[0].defectpercent11);
					$("#defectpercent12").val(footdata[0].defectpercent12);
					
					$('#totalsamplechecked1').val(footdata[0].totalsamplechecked1);
					$('#totalsamplechecked2').val(footdata[0].totalsamplechecked2);
					$("#totalsamplechecked3").val(footdata[0].totalsamplechecked3);
					$("#totalsamplechecked4").val(footdata[0].totalsamplechecked4);
					$("#qcstatus1").val(footdata[0].qcstatus1);
					$("#qcstatus2").val(footdata[0].qcstatus2);
					$("#qcstatus3").val(footdata[0].qcstatus3);
					$("#qcstatus4").val(footdata[0].qcstatus4);
					
					$("#sack").val(footdata[0].sack);
					$("#pouch").val(footdata[0].pouch);
					$("#mc").val(footdata[0].mc);
					
					if(allData[0].apsts==1){
						$('#save').attr('disabled', true);
					}else{
						$('#save').attr('disabled', false);
					}
					$("#tdiv").hide();
					$("#searchRowDiv").hide();
					$("#totalReq").hide();
					$("#ttbtn").hide(); 
				});
		
	}
	
	
// function for delete qc  
function deleteOnclick() {
		if (id) {
				$.ajax({
		type : "POST",
		url : "crqs-detls-delete?id="+ id,
		success : function(response) {
		 if (response.message == "Success") {
			 cancel();
				$("#messageParagraph").text("Plan deleted sucessfully");
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');
				$('#delete').modal('hide');
				agGrid.simpleHttpRequest({
					url : 'crqs-details-view'
				}).then(function(data) {
					var jsonData = JSON.parse(data.body[0]);
					var allData=jsonData.view;
					console.log(allData)
					var len = allData.length;
					$('#totalReq').find('span').html(len);
					gridOptions.api.setRowData(allData);
				});
				
			} else {
				$("#messageParagraph").text("Something went to wrong!");
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');
			}
		},
		error : function(data) {
			console.log(data)
		}
	})
		} else {
			$("#alert").modal('show');
			document.getElementById("textId").innerHTML = "Please Select Atleast one Record !";
		}

}

	// delete selected record from child ag grid
	function deleteDetailsOnclick() {
		$('.modal').hide();
		var selectedRows = activityOptions.api.getSelectedRows();
		activityOptions.api.applyTransaction({
			remove : selectedRows
		});
		cancelModalProductBtn();
	}
	//for closeing modal box for dlt  product
	function cancelModalProductBtn() {
		$("#deleteModalBtn").removeAttr("disabled");
		$('#deleteDetails').modal('hide');
	}

	function deleteFun() {
		$('#delete').modal('show');
	}

	function deleteDetails() {
		$('#deleteDetails').modal('show');
	}

	function cancelModalBtn() {
		$("#deleteModalBtn").removeAttr("disabled");
	}
//function for download
function downloadDetails() { 
	var dataset = [];
	gridOptions.api.forEachNodeAfterFilterAndSort(function(rowNode, index) {
		dataset.push(rowNode.data);
	});
    gridOptions.api.exportDataAsCsv(dataset);
}


function getParameterId(){
	var parameterId= $("#parameterName").val();
	$("#parameterId").val(parameterId);
}

function getItemid(){
	var parameterId= $("#itemname").val();
	$("#itemid").val(parameterId);
}

      
	function approveFun(){
		$('#approveModal').modal('show');
	}
	function approveResult(data){
		if (id && data=='1') {
			$.ajax({
	type : "POST",
	url : "crqs-detls-approve?id="+ id,
	success : function(response) {
	 if (response.message == "Success") {
		 cancel();
			$("#messageParagraph").text("Approved sucessfully");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
			$('#delete').modal('hide');
			$('#approveModal').modal('hide');
			agGrid.simpleHttpRequest({
				url : 'crqs-details-view'
			}).then(function(data) {
				var jsonData = JSON.parse(data.body[0]);
				var allData=jsonData.view;
				console.log(allData)
				var len = allData.length;
				$('#totalReq').find('span').html(len);
				gridOptions.api.setRowData(allData);
			});
			
		} else {
			$("#messageParagraph").text("Something went to wrong!");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
		}
	},
	error : function(data) {
		console.log(data)
	}
})
	} else {
		$('#approveModal').modal('hide');
	}
	}
	
	function crqsPdfDownload(id) {
		
		window.open("/production/view-crqs-pdf-downloads?dcId="+window.btoa(id), '_blank');  
	}
	
	function productDetails(){
		var productid=$("#product").val();
		agGrid.simpleHttpRequest(
				{
					url : 'pcro-product_detls_drop?id='+ productid
				}).then(function(data) {
					console.log("allDATA",data);
					var jsonData = JSON.parse(data.body);
					var allData=jsonData.edit;
					console.log(jsonData[0].variant);
					$("#variant").val(jsonData[0].variant);
					$("#packsize").val(jsonData[0].packsize);
					 
				});
	};
	
	
	function handleChange(event) {
		  const denominator = parseFloat(event.target.value);
		  const id = event.target.id;
		  const matches = id.match(/\d+$/);
		  if(matches[0]<4){
			  var numerator = parseFloat($('#totalsamplechecked1').val());
		  }else if(matches[0]<7){
			  var numerator = parseFloat($('#totalsamplechecked2').val());
		  }else if(matches[0]<10){
			  var numerator = parseFloat($('#totalsamplechecked3').val());
		  }else{
			  var numerator = parseFloat($('#totalsamplechecked4').val());
		  }
		  
		  if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
		      var percentage = (denominator/numerator) * 100;
		      console.log(numerator,denominator);
		      $('#defectpercent'+matches[0]).val(percentage.toFixed(2) + '%');
		    }
		  console.log('#defectpercent'+matches[0]);
		  // Use the changedValue and id in your logic or perform any desired actions
		}
	
	function inspectFun(){
		$('#myModal10').modal('show');
		agGrid.simpleHttpRequest(
				{
					url : 'crqs-inspect-view?id='+ id
				}).then(function(data) {
					var jsonData = JSON.parse(data.body);
					var allData=jsonData.inspect;
					console.log("vvv",allData[0].approvests);
					inspectOptions.api.setRowData(allData);
					if(allData[0].approvests==1){
						$('#downloadInspect').show();
						$('#saveInspect').hide();
					}else{
						$('#downloadInspect').hide();
						$('#saveInspect').show();
					}
					
				});
	}
	
	
	//master save data
	function inspectSaveData() {
		$(".formValidation").remove();
		var valid= true;
		var datas = [];
		var i=-1;
		var rowCount = inspectOptions.api.getDisplayedRowCount();
		if(rowCount > 0){
			inspectOptions.api.forEachNode(function(rowNode, index) {
			var item = rowNode.data;
			item.crqsId = id[0];
			item.desc = $("#defDesc"+index).val();
	        if(valid){
	        	datas.push(item);
	         }
		});	
		$('.loader').show();
		$.ajax({
			type : "POST",
			url : "crqs-inspect-add",
			dataType : "json",
			contentType : "application/json",
			data : JSON.stringify(datas),
			success : function(response) {
				$('.loader').hide();
				var itemName = $("#itemname option:selected").text();
				if (response.code == "success") {
					cancel();
					$("#messageParagraph").text(response.message);
					$("#msgOkModal").removeClass("btn3");
					$("#msgOkModal").addClass("btn1");
					$("#msgModal").modal('show');
					$('#myModal10').modal('hide');
					
				} else {
					$('.loader').hide();
					$("#messageParagraph").text("Test Parameter For "+itemName+" Already Exist.");
					$("#msgOkModal").removeClass("btn3");
					$("#msgOkModal").addClass("btn1");
					$("#msgModal").modal('show');
					
					$("#itemid").val('');
					$("#itemname").val('');
					$("#description").val('');
					activityOptions.api.setRowData();
				}
			},
			error : function(data) {
				$('.loader').hide();
			}
		})
		}
	}
	
	function crqsInspectPdfDownload() {
		alert(id[0])
		//window.open("/production/view-crqs-inspect-pdf-downloads?crqsId="+window.btoa(id[0]), '_blank');  
	}
	
	
	function handleTextFieldKeyDown(event) {

		let currentCell = '';
		const idChar = {};
		if (event.code === 'Tab') {
			const currentInput = event.target;
			let currentId = currentInput.id;
            var regexResult = currentId.match(/^([a-zA-Z]+)(\d+)$/);
            if (regexResult) {
                var color = regexResult[1];
                var numberPart = regexResult[2];
                var firstDigit = numberPart[0];
                var numericPart = numberPart.slice(1);
            }
			if (numericPart < 27) {
				const nextInput = parseInt(numericPart) + 1;
				let nextInputId = color+firstDigit+nextInput;
				let nextInputCell = document.getElementById(`${nextInputId}`);
				if (nextInputCell) {
					nextInputCell.focus();
					event.preventDefault(); // Prevent the default Tab behavior
				}
			}
		}
	}

	  
    </script>

</head>
<body>

	<div layout:fragment="content" class="maincontent">

		<div class="container-fluid">
			<div class="row">
				<div class="maincontentsec">
					<div class="content_padding">

						<div class="d-flex justify-content-between" id="tdiv">
							<div class="btn-hs">
								<div class="font-design" id="totalReq">
									CRQS List(<span></span>)
								</div>
							</div>
							<div id="searchRowDiv">
								<div class="input-style">
									<input type="text" placeholder="Search.." name="search"
										class="searchboxinput" onkeyup="cancelBar()"
										oninput="onQuickFilterChanged()" id="quickFilter"
										autocomplete="off">
									<div class="searchicon">
										<a href="javascript:void(0)"><span
											style="display: none; border-right: 1px solid #ccc; padding-right: 5px;"
											id="closeKey"
											onclick="gridOptions.api.setQuickFilter(null);$('#quickFilter').val('');document.getElementById('closeKey').style.display='none';"
											class="close_i"><i class="ti-close srchicon"></i></span></a><a
											href="javascript:void(0)"><i class="ti-search srchicon"></i></a>
									</div>
								</div>
							</div>
							<div class="buttonsec btn-hs" id="ttbtn">
								<button class="download-btn" id="download"
									onclick="downloadDetails()">Download</button>
								<button class="delete-btn" id="reqDltBtn" onclick="deleteFun()">DELETE</button>
								<button class="download-btn bg-info text-white" id="inspectBtn" onclick="inspectFun()">INSPECT</button>
								<button class="new-btn" id="assignBtn" onclick="approveFun()">APPROVE</button>
								<button class="new-btn" id="newBtn" onclick="newPlan()">NEW</button>
							</div>
						</div>

						<input type="hidden" id="sessionId" th:value="${userId}" /> <input
							type="hidden" id="sessionName" th:value="${userName}" /> <input
							type="hidden" id="hrRole" th:value="${hrRole}" /> <input
							type="hidden" id="sessionRole" th:value="${userRole}" /> <input
							type="hidden" id="adRole" th:value="${adRole}" />
						<div id="myGrid" style="width: 100%; height: 500px;"
							class="ag-theme-alpine"></div>

						<div class="collapse" id="demo">
							<div class="innercontent">
								<div class="innerstickybg">
									<div class="row">

										<div class="col-md-6">
											C R Q S: <span id="crqsbox"></span>
										</div>

										<div class="col-md-6" align="right">
											<button class="cancel-btn" id="cancelBtn" onclick="cancel()">Cancel</button>
											<button class="approve-btn" id="save"
												onclick="masterSaveData()">Save</button>
										</div>
									</div>

								</div>
								<div class="row innersticky_contentgap">
									<input type="hidden" id="crqsId">
								<div class="col-md-3">
										<div class="form-group">
											<label> Factory </label> <input type="text"
												class="form-control" id="factory" value="ORICLEAN PVT.LTD ,  TANGI, CUTTACK" readonly>
										</div>
									</div>
									
								<div class="col-lg-3">
										<div class="form-group calendar_box">
												<label>Date</label> <input type="text" id="pdate"
												class="form-control" onblur="removeValid(event)"
												th:attr="onkeyup=|formatDate('date','${session.DATEFORMAT_JS}')|"
												readonly> <i
												class="ti-calendar picker_calendar" id="DateCalendar3"></i>
										</div>
								</div>
						
									<div class="col-md-3">
										<div class="form-group">
											<label> Shift </label>
											<div class="select" >
												<select id="shift">
													<option value="">Select</option>
													<option th:each="c:${shiftLists}" th:value='${c.key}'
														th:text="${c.name}"></option>
												</select> <span class="focus"></span>
											</div>
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label> Sampling Line/ M/C No </label>
											<input type="text"
												class="form-control" id="mcno">
											
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label> Product </label>
											<div class="select" >
												<select id="product" onchange="productDetails()">
													<option value="">Select</option>
													<option th:each="c:${itemList}" th:value='${c.key}'
														th:text="${c.name}"></option>
												</select> <span class="focus"></span>
											</div>
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label> Packing Size </label> <input type="text"
												class="form-control" id="packsize" readonly>
										</div>
									</div>
																		<div class="col-md-3">
										<div class="form-group">
											<label> Variant </label> <input type="text"
												class="form-control" id="variant" readonly>
										</div>
									</div>
									
									<div class="col-md-3">
										<div class="form-group">
											<label> Pack Technology </label> <input type="text"
												class="form-control" id="packtech">
										</div>
									</div>
								    <div class="col-md-3">
										<div class="form-group">
											<label> Category </label> <input type="text"
												class="form-control" id="category" >
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label> Name of S/I </label> <input type="text"
												class="form-control" id="nameofsi" >
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label> Seal Width </label> <input type="text"
												class="form-control" id="sealwidth" >
										</div>
									</div>
																		<div class="col-md-3">
										<div class="form-group">
											<label> Horizontal </label> <input type="text"
												class="form-control" id="horizontal" >
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label> Vertical </label> <input type="text"
												class="form-control" id="vertical" >
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label> Gap </label> <input type="text"
												class="form-control" id="gap" >
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label> MRP </label> <input type="text"
												class="form-control" id="mrp" >
										</div>
									</div>

								<div class="col-md-3">
										<div class="form-group">
											<input type="hidden"
												class="form-control" id="shiftincharge">
										</div>
									</div>
								</div>
								<div id="main" class="mt-4">
									<div class="accordion-item">
										<h2 class="accordion-header" id="headingOne">
											<button class="accordion-button" type="button"
												data-bs-toggle="collapse" data-bs-target="#collapseOne"
												aria-expanded="false" aria-controls="collapseOne">
												On Pack -Defects</button>
										</h2>

										<div id="collapseOne" class="accordion-collapse collapse show"
											aria-labelledby="headingOne"
											data-bs-parent="#accordionExample">
											<div class="accordion-body">

												


												<div class="row">
													<div id="activity" style="width: 100%; height: 512px;"
														class="ag-theme-alpine"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								
								<div id="main" class="mt-4">
									<div class="accordion-item">
										<h2 class="accordion-header" id="headingOne">
											<button class="accordion-button" type="button"
												data-bs-toggle="collapse" data-bs-target="#collapseOne"
												aria-expanded="false" aria-controls="collapseOne">
												In Pack -Defects</button>
										</h2>

										<div id="collapseOne" class="accordion-collapse collapse show"
											aria-labelledby="headingOne"
											data-bs-parent="#accordionExample">
											<div class="accordion-body">

												


												<div class="row">
													<div id="activity1" style="width: 100%; height: 279px;"
														class="ag-theme-alpine"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="main" class="mt-4">
									<div class="accordion-item">
										<h2 class="accordion-header" id="headingOne">
											<button class="accordion-button" type="button"
												data-bs-toggle="collapse" data-bs-target="#collapseOne"
												aria-expanded="false" aria-controls="collapseOne">
												Outer Case- Defects</button>
										</h2>

										<div id="collapseOne" class="accordion-collapse collapse show"
											aria-labelledby="headingOne"
											data-bs-parent="#accordionExample">
											<div class="accordion-body">

												


												<div class="row">
													<div id="activity2" style="width: 100%; height: 190px;"
														class="ag-theme-alpine"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								

							<div class="row innersticky_contentgap sample-chk">
									<label> Total number of samples Checked </label>
									<div class="col-md-3">
									
										<div class="form-group">
										
											<input type="number"
												class="form-control" id="totalsamplechecked1">
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="totalsamplechecked2" >
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="totalsamplechecked3">
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="totalsamplechecked4">
										</div>
									</div>
									</div>
									<div class="row innersticky_contentgap sample-chk">
									
									<label> No of defects observed </label>
									
									<div class="col-md-1">
										<div class="form-group">
											
											 <input type="number"
												class="form-control" id="nodefectobserved1" oninput="handleChange(event)">
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved2" oninput="handleChange(event)">
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved3" oninput="handleChange(event)">
										</div>
									</div>
									
																		
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved4" oninput="handleChange(event)">
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved5" oninput="handleChange(event)">
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved6" oninput="handleChange(event)">
										</div>
									</div>
									
																		
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved7" oninput="handleChange(event)">
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved8" oninput="handleChange(event)">
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved9" oninput="handleChange(event)">
										</div>
									</div>
									
																		
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved10" oninput="handleChange(event)">
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved11" oninput="handleChange(event)">
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="number"
												class="form-control" id="nodefectobserved12" oninput="handleChange(event)">
										</div>
									</div>

								</div>
								
								<div class="row innersticky_contentgap sample-chk">
									
									<label> % Number of defects </label>
									
									<div class="col-md-1">
										<div class="form-group">
										
											 <input type="text"
												class="form-control" id="defectpercent1" readonly>
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent2" readonly>
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent3" readonly>
										</div>
									</div>
									
																		
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent4" readonly>
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent5" readonly>
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent6" readonly>
										</div>
									</div>
									
																		
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent7" readonly>
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent8" readonly>
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent9" readonly>
										</div>
									</div>
									
																		
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent10" readonly>
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent11" readonly>
										</div>
									</div>
									<div class="col-md-1">
										<div class="form-group">
											 <input type="text"
												class="form-control" id="defectpercent12" readonly>
										</div>
									</div>

								</div>
								
								<div class="row innersticky_contentgap">
									
									
									<label> QC Status (Accepted/Rejected) </label>

									<div class="col-md-3">
										<div class="form-group">
											
											<div class="select" >
												<select id="qcstatus1">
													<option value="">Select</option>
													<option value="Accepted">Accepted</option>
													<option value="Not Accepted">Not Accepted</option>
												</select> <span class="focus"></span>
											</div>
										</div>
									</div>
									
																		<div class="col-md-3">
										<div class="form-group">
											
											<div class="select" >
												<select id="qcstatus2">
													<option value="">Select</option>
													<option value="Accepted">Accepted</option>
													<option value="Not Accepted">Not Accepted</option>
												</select> <span class="focus"></span>
											</div>
										</div>
									</div>
									
																		<div class="col-md-3">
										<div class="form-group">
											
											<div class="select" >
												<select id="qcstatus3">
													<option value="">Select</option>
													<option value="Accepted">Accepted</option>
													<option value="Not Accepted">Not Accepted</option>
												</select> <span class="focus"></span>
											</div>
										</div>
									</div>
									
									
																		<div class="col-md-3">
										<div class="form-group">
											
											<div class="select" >
												<select id="qcstatus4">
													<option value="">Select</option>
													<option value="Accepted">Accepted</option>
													<option value="Not Accepted">Not Accepted</option>
												</select> <span class="focus"></span>
											</div>
										</div>
									</div>

								</div>
								

								<div class="row innersticky_contentgap">
									
									<div class="col-md-4">
									<label> Sack </label>
										<div class="form-group">
										
											<textarea class="form-control" id="sack" rows="3"></textarea>
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
										<label> Pouch </label>
											 <textarea class="form-control" id="pouch" rows="3"></textarea>
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
										<label> M/C </label>
											 <textarea class="form-control" id="mc" rows="3"></textarea>
										</div>
									</div>
									
									</div>

								</div>
							</div>

						</div>
					</div>
				</div>


				<!-- delete modal start -->
				<div id="delete" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column"></div>
							<div class="modal-body">
								<p>Do you really want to delete these records? This process
									cannot be undone.</p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: 0px;">

								<button type="button" class="cancel-btn" data-bs-dismiss="modal"
									onclick="cancelModalBtn();">Cancel</button>
								<button type="button" class="delete-btn"
									onclick="deleteOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>

				<!-- delete product modal start -->
				<div id="deleteDetails" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column"></div>
							<div class="modal-body">
								<p>Do you really want to delete these records? This process
									cannot be undone.</p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: -30px;">

								<button type="button" class="cancel-btn" data-bs-dismiss="modal"
									onclick="cancelModalBtn();">Cancel</button>
								<button type="button" class="delete-btn"
									onclick="deleteDetailsOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>
				<div id="approveModal" class="modal fade show"
												aria-modal="true">
												<div class="modal-dialog modal-confirm">
													<div class="modal-content">
														<div class="modal-header flex-column"></div>
														<div class="modal-body">
															<p>Are you sure ?</p>
														</div>
														<div class="modal-footer justify-content-center"
															style="margin-top: -30px;">
															<button type="button" class="cancel-btn"
																onclick="approveResult('0');">Don't Approve</button>
															<button type="button" class="approve-btn"
																onclick="approveResult('1')">Approve</button>
														</div>
													</div>
												</div>
											</div>
				<!-- alert modal start -->
				<div id="alert" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column">
								<button type="button" class="close" data-bs-dismiss="modal"
									aria-hidden="true" onclick="cancelModalBtn()">
									<i class="ti-close modal-close"></i>
								</button>
							</div>
							<div class="modal-body">
								<p id="textId"></p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: 0px;">

								<button type="button" class="btn1" data-bs-dismiss="modal">SELECT</button>
								<button type="button" class="btn3" onclick="deleteOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>
				
				<div class="modal fade" id="myModal10">
								<div class="modal-dialog modal-lg" style="max-width: 1100px">
									<div class="modal-content" style="width: 100%">

										<!-- Modal Header -->
										<div class="modal-header">
											<h4 class="modal-title" style="font-size: 16px" id="entry">
												<b>SAMPLE FORMAT FOR HOLD LOT INSPECTION<span></span></b>
											</h4>
											<button type="button" class="close" data-bs-dismiss="modal"
												style="font-size: 25px">
												<i class="ti-close"></i>
											</button>
										</div>
										<!-- Modal body -->
										<div class="modal-body"
											style="height: 530px; overflow-y: scroll;">
											<div class="vertical-line">

												<div class="row">
													<div id="myGridInspect" style="width: 100%; height: 450px;"
														class="ag-theme-alpine"></div>
												</div>
												
											</div>
											<button class="new-btn mt-2" id="saveInspect" onclick="inspectSaveData()">SAVE</button>
											<button class="download-btn mt-2" id="downloadInspect" onclick="crqsInspectPdfDownload()">DOWNLOAD</button>
										</div>
									</div>
								</div>
							</div>
							
			</div>
		</div>
</body>
</html>