<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/master}">
<head>
<style type="text/css">
.highcharts-exporting-group {
	display: none;
}

.slidebox {
	padding: 14px;
	margin-top: 0px;
	margin: 0px 10px;
}

.highlight {
	font-weight: bold;
	color: #866060;
}

.rolestxt {
	color: #774c4c;
	font-weight: 100;
}

.edit {
	font-size: 18px;
	color: #9c6f6f;
	margin-bottom: 10px;
	font-weight: 100;
}

/* .form-group label {
	font-size: 12px;
	position: relative;
	top: 4px;
} */

/*  .modal .ag-cell {
    
    color: white!important;
}  */
.holdCls {
	background-color: rgb(0, 143, 0);
}

.bg_white {
	background: #ffffff !important;
}

#myBoomGrid .ag-root-wrapper {
	border: solid 1px #f6f8f8 !important;
}

#myBoomGrid .ag-row-selected {
	background: #0076ba !important;
	color: #fff !important;
	text-indent: 10px !important;
}

#myBoomGrid .ag-row-selected::before {
	font-size: 8px;
	color: #FFF;
	content: '\e64c';
	font-family: 'themify';
	margin-right: 7px;
	position: relative;
	top: 3px;
	right: 4px;
}

#myBoomGrid .ag-header {
	display: none;
}

#myBoomGrid .ag-center-cols-viewport {
	background: #ffff !important;
}

.modal1 {
	position: absolute;
}
</style>

<script type="text/javascript">

	$(document).ready(function() {
		var gridDiv = document.querySelector('#myGrid');
		new agGrid.Grid(gridDiv, gridOptions);

		var gridDiv = document.querySelector('#activity');
		new agGrid.Grid(gridDiv, activityOptions);
		
		var gridDiv = document.querySelector('#myBoomGrid');
	    new agGrid.Grid(gridDiv, boomOptions); 
		
		agGrid.simpleHttpRequest({
			url : 'uploaded-plan-view'
		}).then(function(data) {
			var jsonData = JSON.parse(data.body[0]);
			var allData=jsonData.Plan;
			console.log(allData)
			var len = allData.length;
			$('#totalReq').find('span').html(len);
			gridOptions.api.setRowData(allData);
		});
		activityOptions.api.setRowData();
		$('#reqDltBtn').attr('disabled', true);
		$('#deleteChild').attr('disabled', true);
		$('.collapse').on('show.bs.collapse', function() {
			$(this).siblings('.panel-heading').addClass('active');
		});

		$('.collapse').on('hide.bs.collapse', function() {
			$(this).siblings('.panel-heading').removeClass('active');
		});
		$("#newBtn").click(function() {

		})
		$('#approvebtn').attr('disabled', true);
		$('#rawMaterialRequired').attr('disabled', true);
		$('#boomAllocation').attr('disabled', true);
		
	
		$("#selectBoom").click(function() {
			
			$(".roletxtsec").empty();
		    var selectedRows = boomOptions.api.getSelectedRows();
		    selectedRows.forEach(function(selectedRow, index) {

				var div = '<div class="rolestxt">'+'<span class="highlight">'+selectedRow.boomId+'</span>'+'('+selectedRow.boomName+') </div>';

		       // alert(selectedRow.boomName)
		        $(".roletxtsec").append(div);
		    });
		    closeModal();
		})
		
		$("#saveBomData").click(function(){
	 data = {};
	 var planId = $('#planId').val()
	 var itemIdBoom = $('#itemIdBoom').html()
/* 	var selectedNodes = activityOptions.api.getSelectedNodes();
	var selectedData = selectedNodes.map(node => node.data);
	 var itemIdBoom= selectedData.map(node => node.itemId); */
	 
	data.planId = planId;
	data.itemId = itemIdBoom;
	
	var dataset = [];
	var selectedRows = boomOptions.api.getSelectedRows();
    selectedRows.forEach(function(selectedRow, index) {
    	dataset.push(selectedRow.boomId);
    });
    data.bomList = dataset;
    
    $(".formValidation").remove();
	allPValid = true;	
	if(allPValid) {
		
    	$("body").addClass("overlay");
		submitBomData(data);
	}
})
  
	});
	
	/* -------------------search bar for mygrid------------------------ */

	function onQuickFilterChanged() {
		gridOptions.api
				.setQuickFilter(document.getElementById('quickFilter').value);
	}

	function cancelBar() {
		var id = document.getElementById("closeKey");
		id.style.display = "block";

		if ($('#quickFilter').val() == null || $('#quickFilter').val() == "") {
			id.style.display = "none";
		}
	}
	
	function onQuickFilterChangedChild() {
		activityOptions.api
				.setQuickFilter(document.getElementById('quickFilterChild').value);
	}

	function cancelBarChild() {
		var id = document.getElementById("closeKey");
		id.style.display = "block";

		if ($('#quickFilter').val() == null || $('#quickFilterChild').val() == "") {
			id.style.display = "none";
		}
	}
	var columnDefs = [
		{
			headerCheckboxSelection : false,
			headerCheckboxSelectionFilteredOnly : false,
			checkboxSelection : true,
			width : 10,
			sortable : false,
			filter : false,
			resizable : true

		},
		{
			headerName : 'Plan Id',
			width : 150,
			field : "planId",
			cellRenderer : function(params) {
			return '<a id="planId" onclick=editPlan("'
			+params.data.planId+'","'+params.data.approveStatus
			+ '") href="javascript:void(0)">'
			+ params.data.planId + '</a>';

		}
		}, {
			headerName : 'Week',
			width : 200,
			field : "week_name",
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'From Date',
			width : 200,
			field : "from_date",
			cellStyle : {
				textAlign : 'center'
			}
		},{
			headerName : 'To Date',
			field : "to_date",
			width : 200,
			cellStyle : {
				textAlign : 'center'
			}
		}, {
			headerName : 'status',
			field : "plan_status",
			width : 150,
			cellStyle : {
				textAlign : 'center'
			}
		}, {
		
		headerName : 'Approve Status',
		field : "approveStatus",
		width:140,
		cellStyle : {
			textAlign : 'center'
		},
		cellRenderer : function(params) {
			if (params.data.approveStatus =="Approved") { 
				return '<div style="color:#0642f5">'+params.data.approveStatus+'</div>';
			}else {
				return '<div style="color:#a9a9a9">'+params.data.approveStatus+'</div>';
			}
		}
		
		}, {
			headerName : 'description',
			field : "description",
			width : 400,
		},
		{
			
			headerName : 'Allocation Status',
			field : "allocationStatus",
			width:140,
			cellStyle : {
				textAlign : 'center'
			},
			cellRenderer : function(params) {
				if (params.data.allocationStatus =="Allocated") { 
					return '<div style="color:#0642f5">'+params.data.allocationStatus+'</div>';
				}else {
					return '<div style="color:#a9a9a9">'+params.data.allocationStatus+'</div>';
				}
			}
			
			}];

// let the grid know which columns and what data to use
var gridOptions = {
	columnDefs : columnDefs,
	rowSelection : 'single',
	groupSelectsChildren : true,
	suppressRowClickSelection : true,
	suppressAggFuncInHeader : true,
	defaultColDef : {
		sortable : true,
		filter : true,
		resizable : true,
		width : 120
	},
	onSelectionChanged : onSelectionChanged,
};
//function for row select parents
var id = "";
function onSelectionChanged() {
	var selectedNodes = gridOptions.api.getSelectedNodes();
	 var selectedData = selectedNodes.map(node => node.data);
	 id= selectedData.map(node => node.planId);
	var allocationStatus= selectedData.map(node => node.allocationStatus);
	var selectedRows = gridOptions.api.getSelectedRows();
	var rowCount = 0;
	selectedRows.forEach(function(i) {
		rowCount = rowCount + 1;
	});
	
	if (rowCount > 0) {
		$('#newBtn').attr('disabled', true);
		
		if(allocationStatus=="Not-Allocated"){
			$("#messageParagraph").text("Allocate Bom First.");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
		}
		else{
			if (selectedData.map(node => node.approveStatus)!="Approved"){
				 $('#approvebtn').attr("disabled", false);
				 $('#reqDltBtn').attr("disabled", false);
				 
			 }else{
				 $('#approvebtn').attr("disabled", true);
				 $('#reqDltBtn').attr("disabled", true);
				 $('#rawMaterialRequired').attr("disabled", false);
			 } 
		}
		 
		
	}else {
		$('#reqDltBtn').attr("disabled", true);
		$('#newBtn').attr('disabled', false);
		$('#approvebtn').attr('disabled', true);
		 $('#rawMaterialRequired').attr("disabled", true);
	}
}
// for activity table
var activityDefs = [
		{
			headerCheckboxSelection : false,
			headerCheckboxSelectionFilteredOnly : true,
			checkboxSelection : true,
			sortable : false,
			filter : false,
			resizable : true,
			width : 30
		},
		{
			headerName : "sku / Item Code",
			field : "itemId",
			width : 150,
			cellRenderer : function(params) {
				return '<a onclick=editRow("' + params.data.itemId+'") href="javascript:void(0)">'
						+ params.data.itemId + '</a>';
			}
		}, {
			headerName : "item Name",
			field : "itemName",
			width : 500,
			
		}, {
			headerName : "Quantity",
			field : "quantity",
			width : 200,
			cellStyle : {
				textAlign : 'center'
			},
		}, {
			headerName : "UNIT",
			field : "unitName",
			width : 215,
			cellStyle : {
				textAlign : 'center'
			}

		}, {
			headerName : "UNIT",
			field : "unit",
			width : 110,
			hide : "true"

		},
		{
			headerName : "Bom Allocation Id",
			field : "bomId",
			width : 400,
			cellStyle : {
				textAlign : 'center'
			},
		},];


// let the grid know which columns and what data to use product table
var activityOptions = {
	columnDefs : activityDefs,
	rowSelection : 'multiple',
	groupSelectsChildren : true,
	suppressRowClickSelection : true,
	suppressAggFuncInHeader : true,
	defaultColDef : {
		sortable : true,
		filter : true,
		resizable : true,
		width : 200
	},
	onSelectionChanged : onSelectionChangeChild,
	getRowNodeId : function(data) {
		return data.itemId;
	}
};
//function for row select parents
var childid = "";
function onSelectionChangeChild() {
	 var selectedNodes = activityOptions.api.getSelectedNodes();
	 var selectedData = selectedNodes.map(node => node.data);
	 childid= selectedData.map(node => node.slnoId);
	var selectedRows = activityOptions.api.getSelectedRows();
	var rowCount = 0;
	selectedRows.forEach(function(i) {
		rowCount = rowCount + 1;
	});
	if (rowCount > 0) {
		if(aprStatus == "Approved"){
			$('#processSFG').attr('disabled', false);
		}else{
			if (rowCount == 1){
				$('#newchild').attr('disabled', true);
				$('#deleteChild').attr('disabled', false);
				$('#boomAllocation').attr('disabled', false);
			}else{
				$('#newchild').attr('disabled', true);
				$('#deleteChild').attr('disabled', true);
				$('#boomAllocation').attr('disabled', true);
			}
		}
		
	}else{
		$('#newchild').attr('disabled', false);
		$('#deleteChild').attr('disabled', true);
		$('#boomAllocation').attr('disabled', true);
		$('#processSFG').attr('disabled', true);
	}
}

//parents new plan
function newPlan() {
	$("#myGrid").hide();
	$("#reqTable").hide();
	$("#searchDiv").hide();
	$(".btn-hs").show();
	$("#btndiv").hide();
	$("#listdiv").hide();
	$("#totalReq").hide();
	$("#searchRowDiv").hide();
	$("#searchRowDivChild").hide();
	$("#ttbtn").hide();
	$("#processSFG").hide();
	$("#totalChildItem").hide();
	$("#demo").show();
	activityOptions.api.setRowData('');
	$("#trReqId").html('');
	closeNav();
	$("#boomAllocation").hide();
	$("#week").val('');
	$("#description").val('');
	$("#rowEdit").val('');
	$("#newchild").show(); 
	 $("#deleteChild").show();
	$("#deleteChild").attr('disabled', true);
	$("#newchild").attr('disabled', false);
}

//function for cancel

function cancel() {
	 $(".formValidation").remove();
		$("#totalReq").show();
		$("#searchRowDiv").show();
		$(".btn-hs").show();
		$("#myGrid").show();
		$("#demo").hide();
		$("#reqDltBtn").attr('disabled', true);
		$("#newBtn").attr('disabled', false);
		agGrid.simpleHttpRequest({
			url : 'uploaded-plan-view'
		}).then(function(data) {
			var jsonData = JSON.parse(data.body[0]);
			var allData=jsonData.Plan;
			var len = allData.length;
			$('#totalReq').find('span').html(len);
			gridOptions.api.setRowData(allData);
		});
		$("#planId").val('');
		$("#week").val('');
		$("#year").val('');
		$("#description").val();
		closeNav();
	}
// function for openNav child	
function openNav() {
	$("#itemName").val('');
	$("#itemId").val('');
	$("#quantity").val('');
	$("#unit").val('');
	$("#rowEdit").val(null);
	document.getElementById("mySidenav").style.cssText = "width: 25%; position: absolute; right:-10px; overflow: hidden; height:auto; top:200px;";
	document.getElementById("main").style.width = "75%";
}
//function for closeNav child
function closeNav() {
	document.getElementById("mySidenav").style.width = "0";
	document.getElementById("main").style.width = "100%";
	$("#itemName").val('');
	$("#itemId").val('');
	$("#quantity").val('');
	$("#unit").val('');
	$("#rowEdit").val(null);
}
//master save data
function masterSaveData() {
	$(".formValidation").remove();
	var valid= true;
	var datas = [];
	var rowCount = activityOptions.api.getDisplayedRowCount();
	if(rowCount > 0){
	activityOptions.api.forEachNode(function(rowNode, index) {
		var item = rowNode.data;
		item.planId = $("#planId").val();
		item.week = $("#week").val();
		item.description = $("#description").val();
        if (item.week == null || item.week == "") {
			valid = validationUpdated("Week is Required", "week");
		 }
        if(valid){
        	datas.push(item);
         }
	});
	if (valid) {
		savePlanDetails(datas);
		console.log(datas);
		}
	} else {
		$("#messageParagraph").text(
		"Please Add Atleast One Plan Details");
		$("#msgOkModal").removeClass("btn3");
		$("#msgOkModal").addClass("btn1");
		$("#msgModal").modal('show');
	}
}

function savePlanDetails(datas) {
	console.log(datas);
	$('.loader').show();
	$.ajax({
		type : "POST",
		url : "uploaded-plan-add",
		dataType : "json",
		contentType : "application/json",
		data : JSON.stringify(datas),
		success : function(response) {
			$('.loader').hide();
			if (response.code == "success") {
				cancel();
				$("#messageParagraph").text(response.message);
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');
				closeNav()
			} else {
				$('.loader').hide();
				$("#messageParagraph").text(response.message);
				$("#msgOkModal").removeClass("btn3");
				$("#msgOkModal").addClass("btn1");
				$("#msgModal").modal('show');
			}
		},
		error : function(data) {
			$('.loader').hide();
		}
	}) //ajax ends
}
// save data in aggrid table sidenav save

function saveTableData() {
	var datas = [];
	var item = {};
	var valid = true;
	var rowEdit = $("#rowEdit").val();
	if (true) {
		activityOptions.api.forEachNode(function(rowNode, index) {
			if (!rowEdit) {
			}
		});
		var iname=$("#itemName").val();
		item.itemName = $("#itemName option:selected").text();
		item.itemId = $("#itemId").val();
		item.quantity = $("#quantity").val();
		item.unit = $('#unit').val();
		item.unitName = $("#unit option:selected").text();
	    if (iname == null || iname == "") {
			valid = validationUpdated("Item Name is Required", "itemName");
		}
		if (item.quantity == null || item.quantity == "") {
			valid = validationUpdated("Quantity Required", "quantity");
		}

	 if (valid) {
			closeNav();
			if (rowEdit) {
				var rowNode = activityOptions.api.getRowNode(rowEdit);
				rowNode.setData(item);
			} else {
				activityOptions.api.forEachNode(function(rowNode, index) {
					datas.push(rowNode.data);
				});
				datas.push(item)
				activityOptions.api.setRowData(datas);
			}
		} else{
			$('#mySidenav').show();
		}
	}
}
	// for editing child table of shift 
	function editRow(itemid) {
		var rowNode = activityOptions.api.getRowNode(itemid);
		openNav();
		$("#rowEdit").val(itemid);
		$("#itemId").val(rowNode.data.itemId);
		$("#itemName").val(rowNode.data.itemId);
		$("#quantity").val(rowNode.data.quantity);
		$("#unit").val(rowNode.data.unit);
	}
	//editing the plan details parent table
	var aprStatus = "";
function editPlan(planid,approveStatus) {
	 
	aprStatus = approveStatus;
		   if(approveStatus=="Approved"){
	        	 $("#save").hide(); 
	        	 $("#newchild").hide(); 
	        	 $("#deleteChild").hide(); 
	        	 $("#save1").hide(); 
	        	 $("#boomAllocation").hide();
	        	 $("#processSFG").show(); 
	        	 $('#processSFG').attr('disabled', true);
	        	
	         }else{
	        	 $("#save").show(); 
	        	 $("#newchild").show(); 
	        	 $("#deleteChild").show(); 
	        	 $("#save1").show(); 
	        	 $("#boomAllocation").show();
	        	 $("#processSFG").hide();
	         }
		  
		agGrid.simpleHttpRequest(
				{
					url : 'uploaded-plan-edit?id='+ planid
				}).then(function(data) {
					var jsonData = JSON.parse(data.body[0]);
					var allData=jsonData.Plan;
					var len = allData.length;
					$('#totalChildItem').find('span').html(len);
					console.log(allData)
						$("#myGrid").hide();
					$("#demo").show();
		 			$("#planId").val(planid);
					$("#trReqId").text(planid);
					$("#week").val(allData[0].week);
					$("#year").val(allData[0].year);
					$("#description").val(allData[0].description);
	  
					activityOptions.api.setRowData(allData);
					$("#tdiv").hide();
					$("#searchRowDiv").hide();
					$("#totalReq").hide();
					$("#ttbtn").hide(); 
					$("#searchRowDivChild").show();
					$("#totalChildItem").show();
					$('#processSFG').attr('disabled', true);
				});
	}


// function for delete plan  
function deleteOnclick() {
		if (id) {
			$.ajax({
				type : "GET",
				url : 'uploaded-plan-delete?id='+ id,
				success : function(response) {
					if (response.message == "Success") {
						cancel();
						$("#messageParagraph").text("Plan deleted sucessfully");
						$("#msgOkModal").removeClass("btn3");
						$("#msgOkModal").addClass("btn1");
						$("#msgModal").modal('show');
						$('#delete').modal('hide');
					} else {
						$("#messageParagraph").text("Something went to wrong!");
						$("#msgOkModal").removeClass("btn3");
						$("#msgOkModal").addClass("btn1");
						$("#msgModal").modal('show');
					}
				},
				error : function(data) {
					console.log(data)
				}
			})
		} else {
			$("#alert").modal('show');
			document.getElementById("textId").innerHTML = "Please Select Atleast one Record !";
		}

	}

	// delete selected record from child ag grid
	function deleteDetailsOnclick() {
		$('.modal').hide();
		var selectedRows = activityOptions.api.getSelectedRows();
		activityOptions.api.applyTransaction({
			remove : selectedRows
		});
		cancelModalProductBtn();
	}
	//for closeing modal box for dlt  product
	function cancelModalProductBtn() {
		$("#deleteModalBtn").removeAttr("disabled");
		$('#deleteDetails').modal('hide');
	}

	function deleteFun() {
		$('#delete').modal('show');
	}

	function deleteDetails() {
		$('#deleteDetails').modal('show');
		closeNav();
	}

	function cancelModalBtn() {
		$("#deleteModalBtn").removeAttr("disabled");
	}
	function cancelBar() {
		var id = document.getElementById("closeKey");
		id.style.display = "block";
		if ($('#searchBar').val() == null || $('#searchBar').val() == "") {
			id.style.display = "none";
		}
	}
//function for download
function downloadDetails() { 
	var dataset = [];
	gridOptions.api.forEachNodeAfterFilterAndSort(function(rowNode, index) {
		dataset.push(rowNode.data);
	});
    gridOptions.api.exportDataAsCsv(dataset);
}
//function for get year
function getYear(){
	var yr = $("#week option:selected").attr("code");
	$('#year').val(yr);
}
//function for item id
function getItemId(){
	var itemId = $("#itemName").val();
	$('#itemId').val(itemId);
}

//Approve Request

function approveOnclick() {
	$('#approveModel').modal('show');
}
function cancelApprove() {
 $('#approveModel').modal('hide');
}

function approveModelOnclick() {
	
	var selectedRows = gridOptions.api.getSelectedRows();
	var selectedRowsString = '';
	
	selectedRows.forEach(function(selectedRow, index) {
		if (index > 0) {
			selectedRowsString += ',';
			
		}
		selectedRowsString += selectedRow.planId;
		
	});
	var planId = selectedRowsString;
	
	var approveStatus = 1;
	$('#approveModel').modal('show');
	$('.loader').show();
	
$.ajax({
	type : "GET",
	url : "uploaded-plan-approve?approveStatus=" + approveStatus + "&planId=" + planId,
	async : false,
	success : function(response) {
		if (response.code == "success") {
			$('.loader').hide();
			
			$('#approveModel').modal('hide');
			$('#reqDltBtn').attr("disabled", true);
			$('#approvebtn').attr("disabled", true);
			$('#newBtn').attr("disabled", false);
			agGrid.simpleHttpRequest({
				url : 'uploaded-plan-view'
			}).then(function(data) {
				var jsonData = JSON.parse(data.body[0]);
				var allData=jsonData.Plan;
				console.log(allData)
				var len = allData.length;
				$('#totalReq').find('span').html(len);
				gridOptions.api.setRowData(allData);
			});
			$("#messageParagraph").text("Approved Successfully");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
		}else{
			$('.loader').hide();
			$('#approveModel').modal('show');
		}
		
	},
	error : function(data) {
	}
});
}

function openNavBoom() {
	var selectedNodes = activityOptions.api.getSelectedNodes();
	var selectedData = selectedNodes.map(node => node.data);
	 var itemId= selectedData.map(node => node.itemId);
	

	$(".roletxtsec").empty();
	$("#empId").val("");
	$("#name").val("");
	$("#cont").val("");
	$("#email").val("");
    $("#itemIdBoom").text(itemId);
   
    document.getElementById("mySidenavBoom").style.cssText = "width: 30%; position: absolute; right:-10px; overflow: hidden; height:auto; top:214px;";
    document.getElementById("main").style.width = "70%";
   // getBoomList();
}
function selectBoom(){
	var selectedNodes = activityOptions.api.getSelectedNodes();
	var selectedData = selectedNodes.map(node => node.data);
	 var itemId= selectedData.map(node => node.itemId);
	
	// $("#browseBtn").click(function() {
		    $("#browseModal").modal("show");
		   
		agGrid.simpleHttpRequest({
	        url: 'uploaded-plan-boom-listing?itemId=' + itemId,
	    }).then(function(data) {
	    	var jsonData = JSON.parse(data.body);
	    	var allData=jsonData.BoomdataData;
	    	boomOptions.api.setRowData(allData);
	    }); 
		   
		   editBomData();
		
		//})
}



function closeNavBoom() {
	
	$(".roletxtsec").empty();
	$("#empId").val("");
	$("#name").val("");
	$("#cont").val("");
	$("#email").val("");
    $("#itemIdBoom").text("Item Id");
    document.getElementById("mySidenavBoom").style.width = "0";
    document.getElementById("main").style.width = "100%";
}
function boomAllocationOnclick(){
	 openNavBoom();
	 editBomData();
	// selectBoom();
}

function closeModal() {
    $("#browseModal").modal("hide");
}


function editBomData(){
	var planId = $('#planId').val()
	var itemId = $('#itemIdBoom').html()
	openNavBoom();
	$.ajax({
		type : "GET",
		url : "uploaded-plan-edit-bomdata?planId=" + planId + "&itemId=" + itemId,
		success : function(response) {
			console.log(response)
			if (response.code == "success") {
				$(".roletxtsec").empty();
				var jsonData = JSON.parse(response.body);
				for (var i = 0; i < jsonData.BoomeditData.length; i++) {
				//for(var i = 0; i < response.body.bomNameList.length; i++) {
					var div = '<div class="rolestxt">'+'<span class="highlight">'+jsonData.BoomeditData[i].boomId+'</span>'+'('+jsonData.BoomeditData[i].boomName+') </div>';
		            $(".roletxtsec").append(div);
				}
			//	boomOptions.api.deselectAll();
			var jsonData = JSON.parse(response.body);
				 var bomData = jsonData.BoomeditData;
				
				    var datas = [];
				    boomOptions.api.forEachNode(function(rowNode, index) {
						for (var i = 0; i < jsonData.BoomeditData.length; i++) {
							if (rowNode.data.boomId === jsonData.BoomeditData[i].boomId) { 
								boomOptions.api.selectNode(rowNode, true);
							}
						}
					}); 
                   console.log(datas)
					
					/* $("#empId").val(response.body.empId);	
				  
				    $("#itemIdBoom").text(response.body.empId+" - "+response.body.name); */
			}
		},
		error : function(e) {
		}
	});
}


var boomOptions  = {
	    columnDefs: [
	    	{	headerName: '',
	            field: 'boomId',
	            width : 80,
	           // hide : true,
	        },
	    	{
	    	headerName: '',
	        field: 'boomName',
	        width : 750,
	        cellClass : function(params) {
				return (params.data.statusData === '1' ? 'ag-row-selected'
						: '');
			}
	    }, ],
	    
	 /*    defaultColDef: {
	        flex: 1,
	        minWidth: 100,
	    }, */
	    rowSelection: 'multiple',
	    rowMultiSelectWithClick: true
	};
	

function submitBomData(dataset) {
	var planid = $('#planId').val()

	console.log(dataset)
                $.ajax({
                	
						type : "POST",
						url : "uploaded-plan-save-bomdata",
						contentType : "application/json",
						data : JSON.stringify(dataset),
						success : function(response) {
						if (response.code == "success") {
							
						$("#messageParagraph").text("Data Saved Successfully");
						$("#msgOkModal").removeClass("btn3");
						$("#msgOkModal").addClass("btn1");
						$("#msgModal").modal('show');
						$('.loader').hide();
						$("body").removeClass("overlay");
						$("#boomAllocation").attr("disabled", true);
						$("#deleteChild").attr("disabled", true);
						$("#newchild").attr("disabled", true);
						closeNavBoom();
						agGrid.simpleHttpRequest(
								{
									url : 'uploaded-plan-edit?id='+ planid
								}).then(function(data) {
									var jsonData = JSON.parse(data.body[0]);
									var allData=jsonData.Plan;
									activityOptions.api.setRowData(allData);
								
								});
						
						var selectedNodes = activityOptions.api.getSelectedNodes();
						var selectedData = selectedNodes.map(node => node.data);
						 var itemId= selectedData.map(node => node.itemId);
							
							agGrid.simpleHttpRequest({
						        url: 'uploaded-plan-boom-listing?itemId=' + itemId,
						    }).then(function(data) {
						    	var jsonData = JSON.parse(data.body);
						    	var allData=jsonData.BoomdataData;
						    	boomOptions.api.setRowData(allData);
						    }); 
							   
						
					} else {
						$('.loader').hide();
						$("body").removeClass("overlay");
					}
				},
				error : function(data) {
					console.log(data);
					$('.loader').hide();
					$("body").removeClass("overlay");
				}
			})
}


function manufactureProcess() {
	
	var selectedRows = activityOptions.api.getSelectedRows();
	
	var pId =$('#planId').val()
	var rowCount = 0;
	var selectedItem = [];
	selectedRows.forEach(function(selectedRow, index) {
		rowCount = rowCount + 1;
		selectedItem.push(selectedRow.itemId);
	});
	
	console.log(pId);
	console.log(selectedItem);
	
	 if (rowCount>0) {
			sessionStorage.setItem('activity', 'ACT0253');
			console.log(pId);
			console.log(selectedItem);
		
			localStorage.setItem('selectedItem', selectedItem);
			localStorage.setItem('pId', pId);
			//itemOptions.api.setRowData(data);
			window.location.href = "/production/processing"
			 
		} else {
			$("#messageParagraph").text("Please Select Atleast one Record !");
			$("#msgOkModal").removeClass("btn3");
			$("#msgOkModal").addClass("btn1");
			$("#msgModal").modal('show');
		} 
	
	
}
</script>

</head>
<body>

	<div layout:fragment="content" class="maincontent">

		<div class="container-fluid">
			<div class="row">
				<div class="maincontentsec">
					<div class="content_padding">

						<div class="d-flex justify-content-between" id="tdiv">
							<div class="btn-hs">
								<div class="font-design" id="totalReq">
									Uploaded Plan List(<span></span>)
								</div>
							</div>
							<div id="searchRowDiv">
								<div class="input-style">
									<input type="text" placeholder="Search.." name="search"
										class="searchboxinput" onkeyup="cancelBar()"
										oninput="onQuickFilterChanged()" id="quickFilter"
										autocomplete="off">
									<div class="searchicon">
										<a href="javascript:void(0)"><span
											style="display: none; border-right: 1px solid #ccc; padding-right: 5px;"
											id="closeKey"
											onclick="gridOptions.api.setQuickFilter(null);$('#quickFilter').val('');document.getElementById('closeKey').style.display='none';"
											class="close_i"><i class="ti-close srchicon"></i></span></a><a
											href="javascript:void(0)"><i class="ti-search srchicon"></i></a>
									</div>
								</div>
							</div>
							<div class="buttonsec btn-hs" id="ttbtn">
								<button class="download-btn" id="download"
									onclick="downloadDetails()">Download</button>
								<button class="delete-btn" id="reqDltBtn" onclick="deleteFun()">DELETE</button>
								<button class="new-btn" id="newBtn" onclick="newPlan()">NEW</button>
								<button class="approve-btn" id="approvebtn"
									onclick="approveOnclick()">APPROVE</button>
								<!-- <button class="approve-btn" id="rawMaterialRequired" onclick="rawMaterialRequired()">REQUIRED RM</button> -->
							</div>
						</div>

						<input type="hidden" id="sessionId" th:value="${userId}" /> <input
							type="hidden" id="sessionName" th:value="${userName}" /> <input
							type="hidden" id="hrRole" th:value="${hrRole}" /> <input
							type="hidden" id="sessionRole" th:value="${userRole}" /> <input
							type="hidden" id="adRole" th:value="${adRole}" />
						<div id="myGrid" style="width: 100%; height: 500px;"
							class="ag-theme-alpine"></div>

						<div class="collapse" id="demo">
							<div class="innercontent">
								<div class="innerstickybg">
									<div class="row">

										<div class="col-md-6">
											Plan Id: <span id="trReqId"></span>
										</div>

										<div class="col-md-6" align="right">
											<button class="cancel-btn" id="cancelBtn" onclick="cancel()">Cancel</button>
											<button class="approve-btn" id="save"
												onclick="masterSaveData()">Save</button>
										</div>
									</div>

								</div>
								<div class="row mt-3">
									<input type="hidden" id="planId">

									<div class="col-md-4">
										<div class="form-group">
											<label> Week </label>
											<div class="select" onchange="getYear()">
												<select id="week">
													<option value="">Select</option>
													<option th:each="c:${weekList}" th:value='${c.key}'
														th:text="${c.name}" th:attr="code=${c.code}"></option>
												</select> <span class="focus"></span>
											</div>
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
											<label> Year </label> <input type="text" class="form-control"
												id="year" readonly>
										</div>
									</div>

									<div class="col-md-4">
										<div class="form-group">
											<label> Description </label>
											<textarea class="form-control" id="description"
												onblur="removeValid(event)"></textarea>
										</div>
									</div>
								</div>
								<div id="main" class="mt-4">
									<div class="accordion-item">
										<h2 class="accordion-header" id="headingOne">
											<button class="accordion-button" type="button"
												data-bs-toggle="collapse" data-bs-target="#collapseOne"
												aria-expanded="false" aria-controls="collapseOne">
												Plan Details</button>
										</h2>

										<div id="collapseOne" class="accordion-collapse collapse show"
											aria-labelledby="headingOne"
											data-bs-parent="#accordionExample">
											<div class="accordion-body">

												<div id="mySidenav" class="sidenav">
													<div class="slidebox">
														<div class="row">
															<div class="col-md-10 edit">Plan Details</div>
															<div class="col-md-2">
																<div class="arrow">
																	<a href="javascript:void(0)" class="closebtn"
																		onclick="closeNav()"><i class="ti-arrow-right"></i></a>
																</div>
															</div>
														</div>
														<div style="clear: both;"></div>
														<div class="chartbtnsec">
															<div align="right">
																<button class="cancel-btn" onclick="closeNav()">CANCEL</button>
																<button class="approve-btn" id="save1"
																	onclick="saveTableData()">SAVE</button>
															</div>

														</div>
														<div class="clearfix"></div>
														<div class="row">
															<div class="col-lg-12">
																<div class="form-group">
																	<input type="hidden" class="form-control" id="rowEdit">
																</div>
															</div>

															<div class="col-lg-12">
																<div class="form-group">
																	<label>Item Name</label>
																	<div class="select" onchange="getItemId()">
																		<select id="itemName">
																			<option value="">Select</option>
																			<option th:each="c:${itemList}" th:value='${c.key}'
																				th:text="${c.name}"></option>
																		</select> <span class="focus"></span>
																	</div>
																</div>
															</div>
															<div class="col-lg-12">
																<div class="form-group">
																	<label>Item Id</label> <input type="text"
																		class="form-control" id="itemId" readonly>
																</div>
															</div>
															<div class="col-lg-12">
																<div class="form-group">
																	<label>Quantity</label> <input type="text"
																		class="form-control transparenttxtbox" id="quantity"
																		onblur="removeValid(event)">
																</div>
															</div>

															<div class="col-lg-12">
																<div class="form-group">
																	<label>Unit</label>
																	<div class="select">
																		<select id="unit" onblur="removeValid(event)">
																			<option value="">Select</option>
																			<option th:each="c,iter:${unitList}"
																				th:value="${c.key}" th:text="${c.name}"></option>
																		</select>
																	</div>
																</div>

															</div>

														</div>
													</div>
												</div>

												<div class="d-flex justify-content-between" id="tdiv">
													<div class="btn-hs">
														<div class="font-design" id="totalChildItem">
															TOTAL ITEM(<span></span>)
														</div>
													</div>
													<div id="searchRowDivChild">
														<div class="input-style">
															<input type="text" placeholder="Search.." name="search"
																class="searchboxinput" onkeyup="cancelBarChild()"
																oninput="onQuickFilterChangedChild()" id="quickFilterChild"
																autocomplete="off">
															<div class="searchicon">
																<a href="javascript:void(0)"><span
																	style="display: none; border-right: 1px solid #ccc; padding-right: 5px;"
																	id="closeKey"
																	onclick="activityOptions.api.setQuickFilter(null);$('#quickFilter').val('');document.getElementById('closeKey').style.display='none';"
																	class="close_i"><i class="ti-close srchicon"></i></span></a><a
																	href="javascript:void(0)"><i
																	class="ti-search srchicon"></i></a>
															</div>
														</div>
													</div>
													<div class="row btn-hs">
														<div class="col-md-12 buttonsec btn-hs">
															<button class="delete-btn" id="deleteChild"
																onclick="deleteDetails()">DELETE</button>
															<button class="new-btn" id="newchild" onclick="openNav()">NEW</button>
															<button class="new-btn" id="boomAllocation"
																onclick="boomAllocationOnclick()">BOM
																ALLOCATION</button>
																
																<button class="new-btn" id="processSFG"
																onclick="manufactureProcess()">Process SFG</button>
														</div>
												</div>
													</div>
													
													<div id="activity" style="width: 100%; height: 300px;"
															class="ag-theme-alpine"></div>

												<div id="mySidenavBoom" class="sidenav">
													<div class="slidebox">
														<div class="row">
															<div class="col-md-9">
																<div class="edit">
																	Item Id: <span id="itemIdBoom"></span>

																</div>
															</div>
															<div class="col-md-3">
																<div class="arrow">
																	<a href="javascript:void(0)" class="closebtn"
																		onclick="closeNavBoom()"><i class="ti-arrow-right"></i></a>
																</div>
															</div>
														</div>
														<div class="chartbtnsec">
															<div align="right">
																<button class="cancel-btn" onclick="closeNavBoom()">CANCEL</button>

																<button class="btn1" id="saveBomData">SAVE</button>
															</div>
														</div>
														<div class="clearfix"></div>
														<div class="row">
															<div class="col-md-6">
																<!-- <input type="hidden" id="boomitemId"> -->

															</div>


															<div class="col-lg-9">
																<div class="form-group">
																	<label>Bom</label>
																	<div class="roletxtsec"></div>
																</div>
															</div>
															<div class="col-lg-3 mrt_24">
																<div class="form-group">
																	<button id="browseBtn" onclick="selectBoom()" class="btn2">Select</button>
																</div>
															</div>

														</div>
													</div>
												</div>


											</div>
										</div>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>
				<!-- delete modal start -->
				<div id="delete" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column"></div>
							<div class="modal-body">
								<p>Do you really want to delete these records? This process
									cannot be undone.</p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: 0px;">

								<button type="button" class="cancel-btn" data-bs-dismiss="modal"
									onclick="cancelModalBtn();">Cancel</button>
								<button type="button" class="delete-btn"
									onclick="deleteOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>

				<!-- delete child modal start -->
				<div id="deleteDetails" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column"></div>
							<div class="modal-body">
								<p>Do you really want to delete these records? This process
									cannot be undone.</p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: -30px;">

								<button type="button" class="cancel-btn" data-bs-dismiss="modal"
									onclick="cancelModalBtn();">Cancel</button>
								<button type="button" class="delete-btn"
									onclick="deleteDetailsOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>
				<!-- alert modal start -->
				<div id="alert" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column">
								<button type="button" class="close" data-bs-dismiss="modal"
									aria-hidden="true" onclick="cancelModalBtn()">
									<i class="ti-close modal-close"></i>
								</button>
							</div>
							<div class="modal-body">
								<p id="textId"></p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: 0px;">

								<button type="button" class="btn1" data-bs-dismiss="modal">SELECT</button>
								<button type="button" class="btn3" onclick="deleteOnclick()">Delete</button>
							</div>
						</div>
					</div>
				</div>

				<!-- 	Approve Modal Start -->

				<div id="approveModel" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-confirm">
						<div class="modal-content">
							<div class="modal-header flex-column"></div>
							<div class="modal-body">
								<p>Do you want to Approve this.</p>
							</div>
							<div class="modal-footer justify-content-center"
								style="margin-top: -30px;">
								<button type="button" class="cancel-btn" data-dismiss="modal"
									onclick="cancelApprove();">No</button>
								<button type="button" class="approve-btn"
									onclick="approveModelOnclick()">Yes</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Browse Modal -->
				<div id="browseModal" class="modal fade show" aria-modal="true">
					<div class="modal-dialog modal-md" style="margin-top: 130px;">
						<div class="modal-content" style="width: 170%;">
							<div class="modal-header">
								<h4 class="modal-title md-color">Select Boom</h4>
								<button type="button" class="close cp" onclick="closeModal();"
									data-dismiss="modal">&times;</button>
							</div>
							<div class="modal-body" style="height: 300px;">
								<div id="myBoomGrid" style="width: 100%; height: 90%;"
									class="ag-theme-alpine"></div>
							</div>
							<div class="modal-footer">
								<button class="cancel-btn" data-dismiss="modal"
									onclick="closeModal();">Cancel</button>
								<button class="btn1" id="selectBoom">Select</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>